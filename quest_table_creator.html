<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Habitica Wiki Quest Table Creator</title>

<!--

This page outputs the wikia code for creating tables displaying quest information in Habitica's official wiki.

It's primarily written for the English language wiki (http://habitica.fandom.com/wiki/)
but can also be used for other languages by specifying the language code in the URL like this:
    https://oldgods.net/habitrpg/quest_table_creator.html?language=en
That will cause Habitica's official content translations to be used.

For texts inserted by this page (e.g., table headers), additional
translations need to be added to these objects in this file:
 - stringsForLanguage
 - regexpsForLanguage
 - templateNamesForLanguage
 - rewardPageUrls
For some languages, `wikiPageNameCorrections` and `reverseTextForLanguage` might also need to be edited.
Contact Alys (details below) if you'd like to provide translations for your language.

This code is licenced under the same terms as Habitica:
    https://raw2.github.com/HabitRPG/habitrpg/develop/LICENSE

https://github.com/Alys/tools-for-habitrpg/blob/master/quest_table_creator.html

https://oldgods.net/habitrpg/quest_table_creator.html

Contributors:
    Alys (Alice Harris), lady_alys@oldgods.net
    Jazzis (Yuri Mashukov), jazzis18@gmail.com (Russian translation and code improvements)

-->

    <meta name="description" content="Habitica Wiki Quest Table Creator" />
    <meta name="author" content="Alys (Alice Harris) lady_alys@oldgods.net" />

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="//cdn.datatables.net/1.10.10/js/jquery.dataTables.min.js"></script>
    <link href="//cdn.datatables.net/1.10.10/css/jquery.dataTables.min.css" rel="stylesheet" type="text/css" />


<script type="text/javascript">
$(function() { // wraps around all our code to not pollute global namespace
var TEST_MODE = false; // causes extra text to be printed in the web page
// TEST_MODE = true;

//////////////////////////////////////////////////////////////////////
////   TRANSLATED STRINGS                              ///////////////
////                                                   ///////////////
////   Add strings that this page uses (not strings    ///////////////
////   that are found in Habitica).                    ///////////////
////                                                   ///////////////
//////////////////////////////////////////////////////////////////////
var stringsForLanguage = {
    // not used yet: wiki_name:        "Habitica Wiki", // the name of the wiki (it must contain "Habitica" and that word must not be translated)
    'en': {
        wiki_url:              "https://habitica.fandom.com/wiki/", // the part of the URL that appears in all wiki pages for this language

        checkins:              "Check-Ins", // an abbreviated name for the language-specific version of the http://habitica.fandom.com/wiki/Daily_Check-In_Incentives page
        checkins_page:         "Daily_Check-In_Incentives", // link to the page itself above

        level:                 "level",
        equipment:             "equipment",
        scroll:                "scroll", // as in quest scroll
        quest_scroll:          "quest scroll",
        pet:                   "pet",
        mount:                 "mount",
        egg:                   "egg",
        food:                  "food",
        hatching_potion:       "hatching potion",
        pet_and_mount:         "pet &amp; mount",
        GP:                    "GP", // abbreviation for Gold / Gold Points
        XP:                    "XP", // abbreviation for Experience / Experience Points
        gems:                  "Gems",
        hourglasses:           "Hourglasses",
        world_boss:            "world boss", // as in 'world boss quest'
        collection:            "collection", // as in 'collection quest'
        boss:                  "boss",       // as in 'boss quest'
        rage:                  "rage",       // some bosses have a 'rage' meter
        unknown:               "unknown",    // used when we don't know the quest type (world boss/boss/collection) or the reward type

        name:                  "name",               // table header for the quest name column
        availability:          "availability",       // table header: how / when to obtain the scroll
        type:                  "type",               // table header: type of quest (world boss or boss or collection)
        rewards:               "rewards",            // table header: rewards that the quest gives
        boss_HP:               "boss<br />HP",       // table header: starting health of boss
        boss_strength:         "boss<br />strength", // table header: strength of boss

        rage_name:                "rage<br />name",          // table header: name of boss rage mechanism
        rage_effects:             "rage<br />effects",       // table header: effects of boss rage
        rage_bar_size:            "rage<br />bar<br />size", // table header: size of rage bar
        rageEffect_mpDrain:       "When the Rage bar is full, the Boss will remove the party's Mana.",
        rageEffect_progressDrain: "When the Rage bar is full, the Boss will set back the party's attack progress.",
        rageEffect_healing_30:    "When the Rage bar is full, the Boss will heal 30% of its remaining health.",

        length:                "length",       // table header (HTML only): the length of time generally taken to complete a quest
        difficulty:            "difficulty",   // table header (HTML only): how difficult a quest is in terms of having to be consistent with your Dailies
        rating:                "rating",       // table header (HTML only): a merge of the length and difficulty
        release_date:          "release date", // table header (HTML only): quest release date

        previous_part:         "previous part",   // this text indicates that you can get the quest scroll when you complete the previous quest in the chain
        invite_to_party:       "invite to party", // used to indicate that you get the quest scroll when you invite someone to your party and they accept
        create_account:        "Create Account",  // this must be identical to Habitica's `createAccountReward` translated string
        finished:              "finished", // indicates that the World Boss quest has finished and is no longer available
        only_during:           "only during",  // used to indicate availability for quests that can be bought only during a specific Grand Gala

        spring_fling:          "Spring Fling", // the name of the spring Grand Gala (if the wiki page is named differently, add to wikiPageNameCorrections)
        winter_wonderland:     "Winter Wonderland", // the name of the winter Grand Gala (if the wiki page is named differently, add to wikiPageNameCorrections)
        XP_GP_only:            "XP, GP<br />only", // the reward type for quests that give only XP and GP
        various:               "various", // used to indicate the quest rewards when there's a variety of them
        etc:                   "etc", // added to the end of the quest's reward type when the quest gives multiple types
        one_of_each_food:      "one of each food", // a type of quest reward
        not_applicable:        "n/a", // an abbreviation meaning 'not applicable' (recommended to use a short word)

        weeks:                 "wk",   // 'weeks' or a shorter word for it (as short as possible is best)
        short:                 "short",  // describes the length of time generally taken to complete a quest
        medium:                "medium", // as above
        long:                  "long",   // as above

        very_hard:             "very hard", // describes how difficult a quest is in terms of having to be consistent with your Dailies
        hard:                  "hard",      // as above
        medium:                "medium",    // as above
        easy:                  "easy",      // as above
        trivial:               "trivial",   // as above

        million:               "M",  // an abbreviation for 'million' to indicate the strength of world boss or his rage
        or:                    "or",
        or_earlier:            "or earlier",

        new_quest:             "Quest released this month", // used only within this page's instructions; will not appear on the wiki
        tables_to_edit:        "update the tables for", // used only within this page's instructions; will not appear on the wiki
        all_quests_heading:    "All Quests", // subsection heading used only within this page's instructions
        quest_lines_heading:   "Quest Lines", // subsection heading used only within this page's instructions
        easy_quests_heading:   "Easy Quests", // subsection heading used only within this page's instructions
        medium_quests_heading: "Medium Quests", // subsection heading used only within this page's instructions
        hard_quests_heading:   "Hard Quests", // subsection heading used only within this page's instructions
        rage_quests_heading:   "Rage Quests", // subsection heading used only within this page's instructions

        textarea_intro:        "This textarea contains code to produce a Wikia table showing",
        all_quests:            "all quests",
        quest_lines:           "only quests that are in quest lines",
        easy_quests:           "only easy quests",
        medium_quests:         "only medium quests",
        hard_quests:           "only hard quests",
        textarea_paste:        "Paste this code into this template:",
    },
    'ru': {
        wiki_url:              "https://habitica.fandom.com/ru/wiki/", // the part of the URL that appears in all wiki pages for this language

        checkins:              "вх. в игру", // an abbreviated name for the language-specific version of the http://habitica.fandom.com/wiki/Daily_Check-In_Incentives page
        checkins_page:         "Ежедневное_вознаграждение", // link to the page itself above

        level:                 "ур.",
        equipment:             "снаряжение",
        scroll:                "свиток", // as in quest scroll
        quest_scroll:          "квестовый свиток",
        pet:                   "питомец",
        mount:                 "скакун",
        egg:                   "яйцо",
        food:                  "еда",
        hatching_potion:       "инкубационный эликсир",
        pet_and_mount:         "питомец и скакун",
        GP:                    "золота", // abbreviation for Gold / Gold Points
        XP:                    "опыт",   // abbreviation for Experience / Experience Points
        gems:                  "самоцв.",
        hourglasses:           "песочные часы",
        world_boss:            "мировой босс",
        collection:            "собираемый",    // as in 'collection quest'
        boss:                  "босс",          // as in 'boss quest'
        rage:                  "ярость",        // some bosses have a 'rage' meter
        unknown:               "неизвестно",    // used when we don't know the quest type (world boss/boss/collection) or the reward type

        name:                  "название",            // table header for the quest name column
        availability:          "доступность",         // table header: how / when to obtain the scroll
        type:                  "тип",                 // table header: type of quest (world boss or boss or collection)
        rewards:               "награды",             // table header: rewards that the quest gives
        boss_HP:               "здоровье<br />босса", // table header: starting health of boss
        boss_strength:         "сила<br />босса",     // table header: strength of boss
        rage_name:                "rage<br />name",          // table header: name of boss rage mechanism
        rage_effects:             "rage<br />effects",       // table header: effects of boss rage
        rage_bar_size:            "rage<br />bar<br />size", // table header: size of rage bar
        rageEffect_mpDrain:       "When the Rage bar is full, the Boss will remove the party's Mana.",
        rageEffect_progressDrain: "When the Rage bar is full, the Boss will set back the party's attack progress.",
        rageEffect_healing_30:    "When the Rage bar is full, the Boss will heal 30% of its remaining health.",

        length:                "длительность",
        difficulty:            "сложность",
        rating:                "рейтинг",
        release_date:          "дата выпуска",

        previous_part:         "пред. часть", // this text indicates that you can get the quest scroll when you complete the previous quest in the chain
        invite_to_party:       "пригласить кого-нибудь в команду", // used to indicate that you get the quest scroll when you invite someone to your party and they accept
        create_account:        "Создать учетную запись",            // this must be identical to Habitica's `createAccountReward` translated string
        finished:              "завершен", // indicates that the World Boss quest has finished and is no longer available
        only_during:           "только во время",  // used to indicate availability for quests that can be bought only during a specific Grand Gala
        spring_fling:          "Весенней веселухи", // the name of the spring Grand Gala (if the wiki page is named differently, add to wikiPageNameCorrections)
        winter_wonderland:     "Зимней страны чудес", // the name of the winter Grand Gala (if the wiki page is named differently, add to wikiPageNameCorrections)
        XP_GP_only:            "только<br />опыт и золото", // the reward type for quests that give only XP and GP
        various:               "разное", // used to indicate the quest rewards when there's a variety of them
        etc:                   "и др.", // added to the end of the quest's reward type when the quest gives multiple types
        one_of_each_food:      "по одной ед. еды каждого вида", // a type of quest reward
        not_applicable:        "н/д", // an abbreviation meaning 'not applicable' (recommended to use a short word)

        weeks:                 "нед.",  // 'weeks' or a shorter word for it (as short as possible is best)
        short:                 "короткая",  // describes the length of time generally taken to complete a quest
        medium:                "средняя",   // as above
        long:                  "длинная",   // as above

        very_hard:             "очень сложно", // describes how difficult a quest is in terms of having to be consistent with your Dailies
        hard:                  "сложно",       // as above
        medium:                "средне",       // as above
        easy:                  "легко",        // as above
        trivial:               "пустяк",       // as above

        million:               " млн.",  // an abbreviation for 'million' to indicate the strength of world boss or his rage
        or:                    "или",
        or_earlier:            "или раньше",

        new_quest:             "В этом месяце был выпущен квест", // used only within this page's instructions; will not appear on the wiki
        tables_to_edit:        "обновите следующие таблицы:", // used only within this page's instructions; will not appear on the wiki
        all_quests_heading:    "Все квесты", // subsection heading used only within this page's instructions
        quest_lines_heading:   "Квестовые линии", // subsection heading used only within this page's instructions
        easy_quests_heading:   "Легкие квесты", // subsection heading used only within this page's instructions
        medium_quests_heading: "Средние квесты", // subsection heading used only within this page's instructions
        hard_quests_heading:   "Сложные квесты", // subsection heading used only within this page's instructions
        rage_quests_heading:   "Rage Quests", // subsection heading used only within this page's instructions

        textarea_intro:        "Эта текстовая область содержит код для создания вики-таблицы, показывающей",
        all_quests:            "все квесты",
        quest_lines:           "только квесты из квестовых линий",
        easy_quests:           "только легкие квесты",
        medium_quests:         "только средние квесты",
        hard_quests:           "только сложные квесты",
        textarea_paste:        "Вставьте этот код в шаблон:",
    }
};


//////////////////////////////////////////////////////////////////////
////   TRANSLATED REGULAR EXPRESSIONS                  ///////////////
////                                                   ///////////////
////   Add regular expressions that this page uses.    ///////////////
////                                                   ///////////////
//////////////////////////////////////////////////////////////////////
var regexpsForLanguage = {
    'en': {
        gear:            / +\((Shield-hand Weapon|Armor|Headgear|Weapon|Shield-Hand Item)\)/i,
        part:            /.*Part [0-9]: /i,
        part_url:        /.*Part_[0-9]:_/,
    },
    'ru': {
        gear:            / +\((оружие для защитной руки|оружие|для защитной руки|доспехи|головной убор|двуручное оружие)\)/i,
        part:            /.*[Чч]асть [0-9]: /i,
        part_url:        /.*[Чч]асть_[0-9]:_/,
    }
};


//////////////////////////////////////////////////////////////////////
////   TRANSLATED TEMPLATE NAMES                       ///////////////
////                                                   ///////////////
////   Add template names that the specific wiki uses. ///////////////
////                                                   ///////////////
//////////////////////////////////////////////////////////////////////
var templateNamesForLanguage = {
    'en': {
        all_quests:    "Quest Table All",
        quest_lines:   "Quest Table Quest Lines",
        easy_quests:   "Quest Table Easy",
        medium_quests: "Quest Table Medium",
        hard_quests:   "Quest Table Hard",
        rage_quests:   "Quest Table Rage",
    },
    'ru': {
        all_quests:    "Таблица квестов",
        quest_lines:   "Таблица квестов/Квестовые линии",
        easy_quests:   "Таблица квестов/Легкие квесты",
        medium_quests: "Таблица квестов/Средние квесты",
        hard_quests:   "Таблица квестов/Сложные квесты",
    }
};


//////////////////////////////////////////////////////////////////////
////   LINKS FOR REWARDS (GEAR, ETC)                   ///////////////
////                                                   ///////////////
////   Add new entries here (in any order) when        ///////////////
////   a quest rewards you with equipment AND when     ///////////////
////   that equipment has its own wiki page.           ///////////////
////                                                   ///////////////
////   The left-hand side of each line is the 'key'    ///////////////
////   for an equipment piece. The right-hand side     ///////////////
////   is the wiki page name.                          ///////////////
////                                                   ///////////////
////   DO NOT PUT SPACES IN THESE PAGE NAMES!          ///////////////
////                                                   ///////////////
//////////////////////////////////////////////////////////////////////
var rewardPageUrls = {
    'en': {
        shield_special_goldenknight: "Mustaine%27s_Milestone_Mashing_Morningstar",
        weapon_special_2: "Stephen_Weber%27s_Shaft_of_the_Dragon",
        head_special_2: "Nameless_Helm",
        armor_special_2: "Jean_Chalard%27s_Noble_Tunic",
    },
    'ru': {
        shield_special_goldenknight: 'Моргенштерн_Мастейна,_сминающий_мильные_метки',
        weapon_special_2: 'Посох_дракона_Стивена_Уэбера',
        head_special_2: 'Безымянный_шлем',
        armor_special_2: 'Благородная_туника_Жана_Шалара',
    },
};


//////////////////////////////////////////////////////////////////////
////   WIKI LINKS FOR **SOME** WIKI PAGES              ///////////////
////                                                   ///////////////
////   Add new entries here only when you find that    ///////////////
////   an automatically-created link to a wiki page    ///////////////
////   is not correct.
////   I.e., this is necessary only if the wiki page   ///////////////
////   filename does not match the filename that can   ///////////////
////   be created automatically from a name that       ///////////////
////   appears in Habitica's 'content' data.           ///////////////
////                                                   ///////////////
////   Translation support is NOT needed for every     ///////////////
////   English entry here! Include non-English link    ///////////////
////   names ONLY if you discover that the links are   ///////////////
////   not automatically created correctly.            ///////////////
////                                                   ///////////////
////   The left-hand side of each line is the page     ///////////////
////   name that was automatically created. The        ///////////////
////   right-hand side is the correct page name.       ///////////////
////                                                   ///////////////
////   DO NOT PUT SPACES IN THESE PAGE NAMES!          ///////////////
////                                                   ///////////////
//////////////////////////////////////////////////////////////////////
var wikiPageNameCorrections = {
    'en': { // see comments above before adding data here
        'Dish_Disaster!': "Dish_Disaster",
        Find_The_Cub: "Find_the_Cub", // needed because quest is 'Find The Cub' but wiki page name uses 'the'
        'Mysterious_Mechanical_Marvels!': "Mysterious_Mechanical_Marvels",
    },
    'ru': { // see comments above before adding data here
        "Весенней_веселухи": "Весенняя_веселуха", // spring_fling
        "Зимней_страны_чудес": "Зимняя_страна_чудес", // winter_wonderland
    },
};


//////////////////////////////////////////////////////////////////////
////   TRANSLATED TEXT ORDER                           ///////////////
////                                                   ///////////////
////   Some data+text phrases in some languages need   ///////////////
////   to be reversed compared to English. Specify     ///////////////
////   them here.                                      ///////////////
////                                                   ///////////////
//////////////////////////////////////////////////////////////////////
var reverseTextForLanguage = {
    'checkins' : {
    },
    'level' : {
        'ru': true,
    },
};


var translationInstructions =    // Do not translate this into other languages. It's displayed only in the English version of the page.
    '<h3>Translations for Non-English Wikis</h3>' +
    '<p>If you would like to use this tool to create the tables for your own language\'s version of the wiki, add your language\'s code to the URL. For example, for the Russian ("ru") version you would use this URL:<br /><a href="https://oldgods.net/habitrpg/quest_table_creator.html?language=ru">https://oldgods.net/habitrpg/quest_table_creator.html?<strong>language=ru</strong></a><br />Habitica\'s official translations will then be used by this page. Some additional strings will need to be translated too (e.g., for the table headings) so contact Alys at lady_alys@oldgods.net to discuss that.</p>'
    // '<p>So far support exists for the languages below but others can be added!</p>' +
    // '<ul><li><a href="https://oldgods.net/habitrpg/quest_table_creator.html?language=ru">Russian</a></li></ul>'
    ;

//////////////////////////////////////////////////////////////////////
////   Determine Langauge from URL Parameter         /////////////////
//////////////////////////////////////////////////////////////////////
const urlParams = new URLSearchParams(window.location.search);

// Get the language specified in the URL if any:
const language = urlParams.get('language') || 'en';
// That language(will be used to choose the appropriate official
// Habitica translations when fetching/ the Habitica content data.

// If that language exists in the stringsForLanguage object, then
// this file contains additional translations specifically for this
// page (e.g., for table headers). Otherwise, English will be used
// for those strings.
const inPageLanguage = (stringsForLanguage[language]) ? language : 'en';

var wikiaBaseUrl = getString('wiki_url');


//////////////////////////////////////////////////////////////////////
////   RELEASE DATES FOR QUEST SCROLLS                 ///////////////
//////////////////////////////////////////////////////////////////////
var startOfTime = '2015-11';
var releaseDates = {
    'dilatory': startOfTime,
    'stressbeast': startOfTime,
    'burnout': startOfTime,
    'evilsanta': startOfTime,
    'evilsanta2': startOfTime,
    'gryphon': startOfTime,
    'hedgehog': startOfTime,
    'ghost_stag': startOfTime,
    'vice1': startOfTime,
    'vice2': startOfTime,
    'vice3': startOfTime,
    'egg': startOfTime,
    'rat': startOfTime,
    'octopus': startOfTime,
    'dilatory_derby': startOfTime,
    'atom1': startOfTime,
    'atom2': startOfTime,
    'atom3': startOfTime,
    'harpy': startOfTime,
    'rooster': startOfTime,
    'spider': startOfTime,
    'moonstone1': startOfTime,
    'moonstone2': startOfTime,
    'moonstone3': startOfTime,
    'goldenknight1': startOfTime,
    'goldenknight2': startOfTime,
    'goldenknight3': startOfTime,
    'basilist': startOfTime,
    'owl': startOfTime,
    'penguin': startOfTime,
    'trex': startOfTime,
    'trex_undead': startOfTime,
    'rock': startOfTime,
    'bunny': startOfTime,
    'slime': startOfTime,
    'sheep': startOfTime,
    'kraken': startOfTime,
    'whale': startOfTime,
    'dilatoryDistress1': startOfTime,
    'dilatoryDistress2': startOfTime,
    'dilatoryDistress3': startOfTime,
    'cheetah': startOfTime,
    'horse': startOfTime,
    'frog': startOfTime,
    'snake': startOfTime,
    'unicorn': '2015-12',
    'sabretooth' : '2016-01',
    'monkey' : '2016-02',
    'snail' : '2016-03',
    'falcon' : '2016-04',
    'bewilder' : '2016-04',
    'treeling' : '2016-05',
    'axolotl' : '2016-06',
    'turtle' : '2016-07',
    'armadillo' : '2016-08',
    'cow' : '2016-09',
    'beetle' : '2016-10',
    'taskwoodsTerror1' : '2016-10',
    'taskwoodsTerror2' : '2016-10',
    'taskwoodsTerror3' : '2016-10',
    'ferret' : '2016-11',
    'dustbunnies' : '2016-11',
    'moon1' : '2016-11',
    'moon2' : '2016-11',
    'moon3' : '2016-11',
    'sloth' : '2016-12',
    'triceratops' : '2017-01',
    'stoikalmCalamity1' : '2017-01',
    'stoikalmCalamity2' : '2017-01',
    'stoikalmCalamity3' : '2017-01',
    'guineapig' : '2017-02',
    'peacock' : '2017-03',
    'butterfly' : '2017-04',
    'mayhemMistiflying1' : '2017-04',
    'mayhemMistiflying2' : '2017-04',
    'mayhemMistiflying3' : '2017-04',
    'nudibranch' : '2017-06',
    'hippo' : '2017-08',
    'lostMasterclasser1' : '2017-10',
    'lostMasterclasser2' : '2017-10',
    'lostMasterclasser3' : '2017-10',
    'lostMasterclasser4' : '2017-10',
    'yarn' : '2017-11',
    'pterodactyl' : '2018-01',
    'badger' : '2018-02',
    'dysheartener' : '2018-02',
    'squirrel' : '2018-04',
    'seaserpent' : '2018-07',
    'kangaroo' : '2018-08',
    'alligator' : '2018-10',
    'velociraptor' : '2019-01',
    'bronze' : '2019-05',
    'dolphin' : '2019-07',
    'silver' : '2019-08',
    'robot' : '2019-08',
    'amber' : '2019-11',
    'ruby' : '2020-05',
    'waffle' : '2020-05',
    'fluorite' : '2020-06',
    'windup' : '2020-08',
    'turquoise' : '2020-09',
    'blackPearl' : '2020-11',
    'stone' : '2021-05',
};
// get the current month's date in case the latest quest
// hasn't been added above yet:
var d = new Date();
var month = d.getMonth() + 1;
var thisMonth = d.getFullYear() + '-' + ((month < 10) ? '0' : '') + month;


//////////////////////////////////////////////////////////////////////
////   SCROLL IMAGE FILE NAMES FOR EACH QUEST          ///////////////
////                                                   ///////////////
////   Add new entries here (in any order) when a new  ///////////////
////   quest becomes available.                        ///////////////
////   This is necessary only if the wiki image links  ///////////////
////   for the quest scroll do not match the file      ///////////////
////   names from Habitica.                            ///////////////
////                                                   ///////////////
////   DO NOT PUT SPACES IN THESE FILE NAMES!          ///////////////
//////////////////////////////////////////////////////////////////////
var images = {
    'evilsanta':    'Inventory_quest_scroll_evilsanta.png',
    'burnout':      'image_not_applicable',
    'stressbeast':  'image_not_applicable',
    'dilatory':     'image_not_applicable',
    'bewilder':     'image_not_applicable',
    'dysheartener': 'image_not_applicable',
};

//////////////////////////////////////////////////////////////////////
////   AVAILABILITY TEXT FOR **SOME** QUESTS           ///////////////
////                                                   ///////////////
////   Add new entries here (in any order) when        ///////////////
////   a new quest becomes available if and only if    ///////////////
////   its availability is not the standard            ///////////////
////   "permanent".                                    ///////////////
//////////////////////////////////////////////////////////////////////
var questAvailability = {
    'basilist':     getString('invite_to_party'),
    'egg':          getString('only_during') + ' ' + makeUrl(getString('spring_fling'),      {type:'placeholder'}),
    'waffle':       getString('only_during') + ' ' + makeUrl(getString('spring_fling'),      {type:'placeholder'}),
    'evilsanta':    getString('only_during') + ' ' + makeUrl(getString('winter_wonderland'), {type:'placeholder'}),
    'evilsanta2':   getString('only_during') + ' ' + makeUrl(getString('winter_wonderland'), {type:'placeholder'}),
    'burnout':      getString('finished'),
    'stressbeast':  getString('finished'),
    'dilatory':     getString('finished'),
    'bewilder':     getString('finished'),
    'dysheartener': getString('finished'),
};

//////////////////////////////////////////////////////////////////////
////   Global Variables                              /////////////////
//////////////////////////////////////////////////////////////////////
var content; // holds site-wide content (gear names and stats, quests, etc)
var serverUrl = 'https://habitica.com:443/api/v3';
var clientId  = 'd904bd62-da08-416b-a816-ba797c9ee265-QuestTableCreator';

//////////////////////////////////////////////////////////////////////
////   Data Fetch Function   /////////////////////////////////////////
//////////////////////////////////////////////////////////////////////
fetchData();
function fetchData() {
    $('#loading .good').show();
    $('#loading .bad' ).hide();

    // fetch the site-wide content (quest names and stats, etc):
    $.ajax({
        url: serverUrl + '/content',
        type: 'GET',
        data: { language: language },
        dataType: 'json',
        cache: true,
        beforeSend: function(xhr){
                xhr.setRequestHeader('x-client', clientId);
            },
        success: fetchContentSuccess,
        error: fetchFailure
    });

    function fetchFailure() {
        $('#loading .good').hide();
        $('#loading .bad' ).show();
    }
    function fetchContentSuccess(data) {
        content = data.data;
        parseData();
    }
}

function parseData() {
    var allQuests = content.quests;
    var allQuestsStringified = JSON.stringify(allQuests, null, 4);

    // Get quest IDs and sort them in the desired display order
    // (world bosses at end because of least interest):
    var questIds    = [];
    var questIdsEnd = [];
    for (var questId in allQuests) {
        var quest = allQuests[questId];
        if (quest.category && quest.category === 'world') {
            questIdsEnd.push(questId);
        }
        else {
            questIds.push(questId);
        }
    }
    questIds = questIds.concat(questIdsEnd);

    // Find the first quest in each quest line:
    var questLineStartIds = {};
    for (var questId in allQuests) {
        var quest = allQuests[questId];
        if (quest.previous) {
            questLineStartIds[quest.previous] = true;
        }
    }

    var warnings = '';

    var headers = [ ' class="unfilterable" | ' + getString('name'), // also scroll image
                    ' class="unfilterable" | ' + getString('availability'),
                    ' class="unsortable"   | ' + getString('type'),
                    ' class="unfilterable" | ' + getString('rewards'),
                    ' class="unfilterable" | ' + getString('GP'),
                    ' class="unfilterable" | ' + getString('XP'),
                    ' class="unfilterable" | ' + getString('boss_HP'),
                    ' class="unfilterable" | ' + getString('boss_strength')
                  ];
    var headersRageExtra = [ ' class="unfilterable" | ' + getString('name'), // also scroll image
                             ' class="unfilterable" | ' + getString('rage_name'),
                             ' class="unfilterable" | ' + getString('rage_bar_size'),
                             ' class="unfilterable" | ' + getString('rage_effects')
                           ];

    var headersHtml = [ getString('name'), getString('availability'), getString('type'), getString('rewards'), getString('GP'), getString('XP'), getString('boss_HP'), getString('boss_strength') ];
    headersHtml.push('<em>' + getString('length') + '</em>', '<em>' + getString('difficulty') + '</em>', '<em>' + getString('rating') + '</em>', '<em>' + getString('release_date') + '</em>');

    // table row for each quest:
    var releaseDateNeeded = '';
    var rageEffectCodeNeeded = '';
    var tableRows    = { 'all':        [],
                         'easy':       [],
                         'medium':     [],
                         'hard':       [],
                         'rage':       [],
                         'rageExtra':  [],
                         'questLines': [],
                       };
    var tableRowsHtml    = [];
    var devData = '';
    var latestQuestUpdatesNeeded = '';
    for (var index = 0; index < questIds.length; index++) {
        var questId = questIds[index];
        var quest = allQuests[questId];
        // devData += "    '" + questId + "': startOfTime,\n";
        var row          = [];
        var rowRageExtra = [];
        var rowHtml      = [];

        var questName = quest.text;
        if (language === 'en') {
            questName = questName.replace(/^The /, ''); // doing this for other languages might be difficult, especially for gendered languages
        }

        var imageLocation = images[questId] || 'Inventory_quest_scroll_' + questId + '.png';

        var cellValue = [ makeUrl(quest.text) + '<br />' + makeImage(imageLocation, questId), 'data-sort-value="' + questName + '"' ];
        row.push(cellValue);
        rowRageExtra.push(cellValue);
        rowHtml.push(makeUrl(quest.text, {type:'html'}) + '<br />' + makeImage(imageLocation, questId, {html:true}));

        var availability = '';
        var displayLevelRestriction = false;
        if (quest.category && quest.category === 'unlockable') {
            if (quest.unlockCondition && quest.unlockCondition.text &&
                quest.unlockCondition.text === getString('create_account')
               ) {
                availability = quest.unlockCondition.text.toLowerCase();
            }
            else if (quest.unlockCondition && quest.unlockCondition.incentiveThreshold) {
                var text = (reverseTextForLanguage['checkins'][inPageLanguage])
                         ? getString('checkins') + ': ' + quest.unlockCondition.incentiveThreshold
                         : quest.unlockCondition.incentiveThreshold + ' ' + getString('checkins');
                availability = makeUrl(text, {url: getString('checkins_page'), type:'placeholder'} );
            }
            else if (quest.previous) {
                availability = getString('previous_part');
                displayLevelRestriction = quest.lvl; // true
            }
            else if (quest.lvl) {
                availability = (reverseTextForLanguage['level'][inPageLanguage])
                             ? quest.lvl + ' ' + getString('level')
                             : getString('level') + ' ' + quest.lvl;
            }
        }
        if (quest.unlockCondition && quest.unlockCondition.condition &&
            quest.unlockCondition.condition === 'party invite'
           ) {
            delete quest.value; // Habitica's config lies
        }
        var cost = (quest.goldValue)                    ? quest.goldValue + ' ' + getString('GP') :
                   (quest.category === 'timeTravelers') ? quest.value + ' ' + getString('hourglasses') :
                   (quest.value)                        ? quest.value + ' ' + getString('gems')
                                                        : '';
        if (cost) {
            if (availability) {
                availability += ' ' + getString('or') + '<br />';
            }
            availability += cost;
        }
        if (questAvailability[questId]) {
            if (availability) {
                availability += '<br />';
            }
            availability += questAvailability[questId];
        }
        if (displayLevelRestriction) {
            availability += '<br />(';
            availability += (reverseTextForLanguage['level'][inPageLanguage])
                         ? quest.lvl + ' ' + getString('level')
                         : getString('level') + ' ' + quest.lvl;
            availability += ')';
        }
        row.push(    replacePlaceholderLink(availability, {type:'wiki'}));
        rowHtml.push(replacePlaceholderLink(availability, {type:'html'}));

        var objectiveType =
            (quest.category && quest.category === 'world') ? getString('world_boss') :
            (quest.collect) ? getString('collection') :
            (quest.boss)    ? getString('boss') :
                              getString('unknown');
        row.push(objectiveType);
        rowHtml.push(objectiveType);

        var droppedGP = quest.drop.gp || 0;
        var droppedXP = quest.drop.exp || 0;
        delete quest.drop.gp;
        delete quest.drop.exp;
        var XPandGPonly = jQuery.isEmptyObject(quest.drop);

        delete quest.drop.unlock;

        var items = {};
        if (quest.drop.items) {
            for (var i in quest.drop.items) {
                var obj = quest.drop.items[i];
                if (!items[obj.type]) {
                    items[obj.type] = {}; // e.g., "eggs", "gear"
                }
                if (!items[obj.type][obj.key]) {
                    items[obj.type][obj.key] = {}; // e.g., Potatoe
                }
                items[obj.type][obj.key]['text'] = obj.text; // e.g., Potato
                if (!items[obj.type][obj.key]['count']) {
                    items[obj.type][obj.key]['count'] = 0;
                }
                items[obj.type][obj.key]['count']++;
                delete obj.type;
                delete obj.key;
                delete obj.text;
                delete obj.onlyOwner;
                if (Object.keys(obj).length) {
                    console.log('"obj" object has other contents:');
                    console.log(obj);
                }
            }
        }
        delete quest.drop.items;
        if (Object.keys(quest.drop).length) {
            console.log('"quest.drop" object has other contents:');
            console.log(quest.drop);
        }

        var petName   = '';
        var mountName = '';
        var equipment = [];
        var other     = [];
        for (var type in items) {
            if (type === 'food' && quest.category === 'world') {
                other.push(getString('one_of_each_food')); // ASSUME this happens for each world quest
            }
            else {
                for (var key in items[type]) {
                    var text = items[type][key]['text'];
                    if (type === 'pets') {
                        // ASSUME there's no more than one pet
                        petName = text.replace(new RegExp(' +\\(' + getString('pet') + '\\)','i'), '');
                    }
                    else if (type === 'mounts') {
                        // ASSUME there's no more than one mount
                        mountName = text.replace(new RegExp(' +\\(' + getString('mount') + '\\)','i'), '');
                    }
                    else {
                        if (type === 'gear') {
                            text = text.replace(getRegexp('gear'), '');
                        }
                        else if (type === 'eggs') {
                            // this and the similar code below is just used for lower-casing less important strings like "egg",
                            // otherwise nearly every word in the table is mixed case, which makes it harder to see the important
                            // strings like the pet names
                            text = text.replace(new RegExp('\\(' + getString('egg') + '\\)','i'), '('+ getString('egg') +')');
                        }
                        else if (type === 'hatchingPotions') {
                            text = text.replace(new RegExp(getString('hatching_potion'),'i'), getString('hatching_potion'));
                        }
                        else if (type === 'food') {
                            text = text.replace(new RegExp('\\(' + getString('food') + '\\)','i'), '('+ getString('food') +')');
                        }
                        if (rewardPageUrls[inPageLanguage][key]) {
                            text = makeUrl(text, {url: rewardPageUrls[inPageLanguage][key], type:'placeholder'} );
                        }
                        if (items[type][key]['count'] > 1) {
                            text += ' x ' + items[type][key]['count'];
                        }
                        if (type === 'gear') {
                            equipment.push(text);
                        }
                        else {
                            other.push(text);
                        }
                    }
                }
            }
        }

        if (petName && mountName && petName === mountName) {
            var pets = petName + ' (' + getString('pet_and_mount') + ')';
            other.unshift(pets);
        }
        else {
            if (petName) {
                other.unshift(petName + ' (' + getString('pet') + ')');
            }
            if (mountName) {
                other.unshift(mountName + ' (' + getString('mount') + ')');
            }
        }
        var rewardItems = equipment.concat(other);

        var specialRewardType = getString('unknown');
        var etcPossible = false;
        if (XPandGPonly) {
            specialRewardType = getString('XP_GP_only');
        }
        if (items['gear']) {
            specialRewardType = getString('equipment');
            etcPossible = true;
            delete items['gear'];
        }
        if (items['quests']) {
            specialRewardType = getString('scroll');
            etcPossible = true;
            delete items['quests'];
        }
        if (etcPossible && Object.keys(items).length) {
            specialRewardType += ', ' + getString('etc');
        }
        var rewardType =
            (!quest.category)                     ? specialRewardType            :
            (quest.category === 'world')          ? getString('various')         :
            (quest.category === 'gold')           ? specialRewardType            :
            (quest.category === 'unlockable')     ? specialRewardType            :
            (quest.category === 'timeTravelers')  ? getString('pet')             : // XXX_later fix this - it works for Robot but maybe not future quests
            (quest.category === 'hatchingPotion') ? getString('hatching_potion') :
                                                    getString(quest.category); // e.g., pet

        // add list of rewards to reward type, with some abbreviations:
        var itemsString = rewardItems.join(';<br />');
        if (rewardType === getString('hatching_potion')) {
            itemsString = itemsString.replace(new RegExp(' +' + getString('hatching_potion'),'i'), '');
        }
        if (rewardType === getString('scroll')) {
            itemsString = itemsString.replace(new RegExp(' +\\(' + getString('scroll') + '\\)','i'), '');
            itemsString = itemsString.replace(new RegExp(' +\\(' + getString('quest_scroll') + '\\)','i'), '');
            itemsString = itemsString.replace(getRegexp('part'), '');
        }

        if (itemsString) {
            rewardType += ':<br />' + itemsString;
        }

        row.push(    replacePlaceholderLink(rewardType, {type:'wiki'}));
        rowHtml.push(replacePlaceholderLink(rewardType, {type:'html'}));

        row.push(droppedGP);
        rowHtml.push(droppedGP);
        row.push(droppedXP);
        rowHtml.push(droppedXP);

        var bossHP              = getString('not_applicable');
        var bossHPSort          = 0;
        var bossStr             = getString('not_applicable');
        var bossHasRage         = false; // NB does not become true for World Bosses
        var bossRage            = '';
        var questLength         = getString('not_applicable');
        var questLengthDetailed = getString('not_applicable');
        var questDifficulty     = getString('not_applicable');
        if (quest.boss) {
            bossHP     = quest.boss.hp || 0;
            bossHPSort = bossHP;
            bossStr  = quest.boss.str  || 0;
            bossHasRage = quest.boss.rage && (!quest.category || quest.category !== 'world');
            bossRage = (quest.boss.rage && quest.boss.rage.value) ? +quest.boss.rage.value : 0;
            if (!quest.category || quest.category !== 'world') {
                if (bossHP > 999) {
                    questLength = '3. ' + getString('long');
                }
                else if (bossHP > 499) {
                    questLength = '2. ' + getString('medium');
                }
                else {
                    questLength = '1. ' + getString('short');
                }

                if (bossHP > 1200) {
                    questLengthDetailed = '> 4 ' + getString('weeks');
                }
                else if (bossHP > 1000) {
                    questLengthDetailed = '~ 4 ' + getString('weeks');
                }
                else if (bossHP > 900) {
                    questLengthDetailed = '3-4 ' + getString('weeks');
                }
                else if (bossHP > 799) {
                    questLengthDetailed = '~ 3 ' + getString('weeks');
                }
                else if (bossHP > 500) {
                    questLengthDetailed = '2-3 ' + getString('weeks');
                }
                else if (bossHP > 400) {
                    questLengthDetailed = '~ 2 ' + getString('weeks');
                }
                else if (bossHP > 300) {
                    questLengthDetailed = '< 2 ' + getString('weeks');
                }
                else {
                    questLengthDetailed = '~ 1 ' + getString('weeks');
                }

                if (bossStr > 2.5) {
                    questDifficulty = '5. ' + getString('very_hard');
                }
                else if (bossStr === 2.5) {
                    questDifficulty = '4. ' + getString('hard');
                }
                else if (bossStr >= 2) {
                    questDifficulty = '3. ' + getString('medium');
                }
                else if (bossStr >= 1.5) {
                    questDifficulty = '2. ' + getString('easy');
                }
                else {
                    questDifficulty = '1. ' + getString('trivial');
                }
            }

            var divisor = 1000 * 1000;
            if (bossHP > divisor) {
                bossHP = bossHP / divisor;
                bossHP += getString('million');
            }
            if (bossRage && bossRage > divisor/10) {
                bossRage = bossRage / divisor;
                bossRage += getString('million');
            }
        }
        else if (quest.collect) {
            var count = 0;
            for (var i in quest.collect) {
                if (quest.collect[i].count) {
                    count += quest.collect[i].count;
                }
            }

            if (count > 300) {
                questDifficulty = '5. ' + getString('very_hard');
                questLength = '3. ' + getString('long');
                questLengthDetailed = '';
            }
            else if (count > 100) {
                questDifficulty = '4. ' + getString('hard');
                questLength = '3. ' + getString('long');
                questLengthDetailed = '';
            }
            else if (count > 30) {
                questDifficulty = '3. ' + getString('medium');
                questLength = '2. ' + getString('medium');
                questLengthDetailed = '';
            }
            else {
                questDifficulty = '2. ' + getString('easy');
                questLength = '1. ' + getString('short');
                questLengthDetailed = '';
            }
        }

        var rating = getString('unknown');
        if (quest.category && quest.category === 'world') {
            rating = '4. ' + getString('not_applicable');
        }
        else if ((questDifficulty === '1. ' + getString('trivial') ||
              questDifficulty === '2. ' + getString('easy')) && questLength === '1. ' + getString('short')
            ) {
            rating = '1. ' + getString('easy');
        }
        else if ( questDifficulty >= '4. ' + getString('hard') ||
                 (questDifficulty === '3. ' + getString('medium') && questLength === '3. ' + getString('long'))
                ) {
            rating = '3. ' + getString('hard');
        }
        else {
            rating = '2. ' + getString('medium');
        }

        row.push([ bossHP + ((bossRage) ? '<br />' + getString('rage') + ':'+bossRage : ''),
                   'data-sort-value="' + bossHPSort + '"' ]);
        rowHtml.push(bossHP + ((bossRage) ? '<br />' + getString('rage') + ':'+bossRage : ''));
        row.push(bossStr);
        rowHtml.push(bossStr);

        if (bossHasRage) {
            rowRageExtra.push(quest.boss.rage.title);
            rowRageExtra.push(quest.boss.rage.value);

            var effect = '';
            if (quest.boss.rage.mpDrain) {
                effect = getString('rageEffect_mpDrain');
            }
            if (quest.boss.rage.progressDrain) {
                effect = getString('rageEffect_progressDrain');
            }
            if (quest.boss.rage.healing && quest.boss.rage.healing === 0.3) {
                effect = getString('rageEffect_healing_30');
            }
            if (!effect) {
                rageEffectCodeNeeded = 'The Quest Table Creator says it needs new code for Rage for "' + quest.key + '".';
                effect = '&nbsp;';
            }
            rowRageExtra.push(effect);
        }

        // So far, `row` contains the table cells for a Wikia table and
        // `rowHtml` contains the same cells for the HTML table.
        // We now add more fields to `rowHtml` to help with analysing the quests (difficulty, etc).
        rowHtml.push(questLength + ((questLengthDetailed) ?
                    '<br />(' + questLengthDetailed + ')' : ''));
        rowHtml.push(questDifficulty);
        rowHtml.push(rating);

        var releaseDate       = '';
        var releaseDatePretty = '';
        if (! releaseDates[questId]) {
            releaseDateNeeded += "'" + questId +"' : '"+ thisMonth + "',<br />";
        }
        releaseDate = releaseDates[questId] || thisMonth;
        if (releaseDate === startOfTime) {
            releaseDatePretty = releaseDate + '<br />'+ getString('or_earlier');
        }
        else {
            releaseDatePretty = releaseDate;
        }
        rowHtml.push(releaseDatePretty);

        // We now have the `row` array which contains Wikia code for
        // this quest, and the `rowHtml` array which contain HTML code.
        // We save the `row` array into one or more sets of
        // quests, depending on the parameters of this quest.
        // For the HTML table, there is only one set.

        if (releaseDate === thisMonth) {
            latestQuestUpdatesNeeded += getString('new_quest') + ': <strong>' + questName + '</strong> -- ' +
                                        getString('tables_to_edit') + ' ' + getString('all_quests_heading');
        }

        if (quest.previous || questId.match(/evilsanta/) || questLineStartIds[questId]) {
            tableRows.questLines.push( convertRow(row) );
            if (releaseDate === thisMonth) { latestQuestUpdatesNeeded += ', ' + getString('quest_lines_heading'); }
        }

        tableRowsHtml.push(rowHtml);
        tableRows.all.push( convertRow(row) );

        if (rating === '1. ' + getString('easy')) {
            tableRows.easy.push( convertRow(row) );
            if (releaseDate === thisMonth) { latestQuestUpdatesNeeded += ', ' + getString('easy_quests_heading'); }
        }
        else if (rating === '2. ' + getString('medium')) {
            tableRows.medium.push( convertRow(row) );
            if (releaseDate === thisMonth) { latestQuestUpdatesNeeded += ', ' + getString('medium_quests_heading'); }
        }
        else if (rating === '3. ' + getString('hard')) {
            tableRows.hard.push( convertRow(row) );
            if (releaseDate === thisMonth) { latestQuestUpdatesNeeded += ', ' + getString('hard_quests_heading'); }
        }

        if (bossHasRage) {
            tableRows.rage.push( convertRow(row) );
            tableRows.rageExtra.push( convertRow(rowRageExtra) );
            if (releaseDate === thisMonth) { latestQuestUpdatesNeeded += ', ' + getString('rage_quests_heading'); }
        }

        if (releaseDate === thisMonth) {
            latestQuestUpdatesNeeded += ".<br />";
        }
    }
    if (rageEffectCodeNeeded) {
        latestQuestUpdatesNeeded += '<strong>IMPORTANT: Please go to the <a href="https://habitica.com/groups/guild/9a163b28-ebcf-4e52-87de-5c040ed0f8f8">Wizards of the Wiki</a> guild and post this message:</strong><br /><blockquote>@alys ' + rageEffectCodeNeeded + '</blockquote><br /><br /><br />';
    }

    var questTableHeader = '' +
'\n{| class="filterable sortable generated-table" border="1" cellpadding="2" cellspacing="0" style="width: 100%; text-align: center;"' +
'\n|- style="background: #284C6D; color: #FFFFFF; white-space: nowrap;"';

    var questTableHeaderRageExtra = questTableHeader;

    questTableHeader          += convertRow(headers,          'th');
    questTableHeaderRageExtra += convertRow(headersRageExtra, 'th');

    var questTableFooter = '' +
'\n|- class="sortbottom"' +
'\n| colspan="10" style="height: 0px; border-bottom: 3px solid #284C6D;"|' +
'\n|}\n';


    // create HTML table showing production data and development data:
    var columns = [];
    for (var i in headersHtml) {
        columns.push({'title': headersHtml[i]});
    }
    $(document).ready(function() {
        $('#theTable').DataTable( {
            'data': tableRowsHtml,
            'columns': columns,
            'bPaginate': false,
            'aaSorting': [], // no default sorting
        } );
    } );

    var htmlEnd = '';
    if (releaseDateNeeded) {
        htmlEnd  += '<p>NOTES FOR ALYS:<br />Need release date:<br />' + releaseDateNeeded + '</p>';

    }
    if (warnings) htmlEnd += '<p>WARNING:<br />' + warnings + '</p>';
    if (false) { // FOR TESTING
        htmlEnd += "<p>The material below here is Habitica's JSON data that" +
                " was used to make the wikia code above. You can ignore it" +
                " unless you are interested in it. You do not need to" +
                " copy it to the wiki.</p>" +
                "<pre>" + allQuestsStringified + "</pre>";
    }
    if (devData) {
        htmlEnd += '<pre>' + devData + '</pre>';
    }


    //////////////////////////////////////////////////////////////////////
    ////   Display the HTML    ///////////////////////////////////////////
    //////////////////////////////////////////////////////////////////////

    $('#loading .good').hide();
    $('#output').html(
        '<p>' + latestQuestUpdatesNeeded + '</p>' +
        '<h2>Notes:</h2>' +
        '<ul>' +
        '<li>This page outputs the wikia code for creating tables that display quests on the <a href="http://habitica.fandom.com/">Habitica wiki</a> and translated wikis.</li>' +
        '<li>Don\'t edit the code in the textarea boxes. Any edits you make will not be saved for future use.</li>' +
        '<li>Post to the Wizards of the Wiki guild if you have questions or suggestions for improving this.</li>' +
        '<li>The <strong>length</strong>, <strong>difficulty</strong>, and <strong>rating</strong> columns do not appear on the wiki but are included in the table below to help us categorise the quests into pages.</li>' +
        '<li>The <strong>release date</strong> column does not appear on the wiki. It is used here only to help us work out which pages need to be updated when a new quest is released, and so exact release dates for most of the quests are not included.</li>' +

        '<li>Quest scroll images will always look broken in the HTML table here, but will work on the wiki.</li>' +
        '<li>Sorting won\'t always work correctly in the HTML table here, but will work on the wiki.</li>' +

        '<li>Any information pulled straight from Habitica should be correct. Any information that Alys had to write code to calculate might be wrong. Any bugs can be easily fixed.</li>' +

        '</ul>' +

        '<h3>Length, Difficulty, and Rating</h3>' +
        '<ul>' +
        '<li>For a boss quest, if the boss\'s HP is 1000 or above, it\'s "long"; 500 and up is "medium"; others are "short".  If the boss strength is greater than 2.5, it\'s "very hard"; exactly 2.5 is "hard"; 2 or above is "medium"; 1.5 or above is "easy"; others are "trivial".</li>' +
        '<li>For a collection quest, needing more than 300 items is "very hard" and "long"; more than 100 is "hard" and "long"; more than 30 is "medium" for both; others are "easy" and "short".</li>' +
        '<li>The rating is a merge of the length and difficulty. Any quest with a trivial / easy difficulty AND a short length is rated "easy". Any quest with a hard difficulty or a long quest with a medium difficulty is rated "hard". The others are rated "medium".</li>' +
        '</ul>' +

        ((inPageLanguage === 'en') ? translationInstructions : '') +

        '<h2>' + getString('all_quests_heading') + '</h2>' +
        '<p>' + getString('textarea_intro') + ' ' + getString('all_quests') + '. ' + getString('textarea_paste') + ' ' +
        makeUrl('all_quests', {template:true, type:'html'}) +
        '</p><textarea rows="5" cols="100" wrap="off">' +
        questTableHeader +
        tableRows.all.join("") +
        questTableFooter +
        '</textarea>' +

        '<h2>' + getString('quest_lines_heading') + '</h2>' +
        '<p>' + getString('textarea_intro') + ' ' + getString('quest_lines') + '. ' + getString('textarea_paste') + ' ' +
        makeUrl('quest_lines', {template:true, type:'html'}) +
        '</p><textarea rows="5" cols="100" wrap="off">' +
        questTableHeader +
        tableRows.questLines.join("") +
        questTableFooter +
        '</textarea>' +

        '<h2>' + getString('easy_quests_heading') + '</h2>' +
        '<p>' + getString('textarea_intro') + ' ' + getString('easy_quests') + '. ' + getString('textarea_paste') + ' ' +
        makeUrl('easy_quests', {template:true, type:'html'}) +
        '</p><textarea rows="5" cols="100" wrap="off">' +
        questTableHeader +
        tableRows.easy.join("") +
        questTableFooter +
        '</textarea>' +

        '<h2>' + getString('medium_quests_heading') + '</h2>' +
        '<p>' + getString('textarea_intro') + ' ' + getString('medium_quests') + '. ' + getString('textarea_paste') + ' ' +
        makeUrl('medium_quests', {template:true, type:'html'}) +
        '</p><textarea rows="5" cols="100" wrap="off">' +
        questTableHeader +
        tableRows.medium.join("") +
        questTableFooter +
        '</textarea>' +

        '<h2>' + getString('hard_quests_heading') + '</h2>' +
        '<p>' + getString('textarea_intro') + ' ' + getString('hard_quests') + '. ' + getString('textarea_paste') + ' ' +
        makeUrl('hard_quests', {template:true, type:'html'}) +
        '</p><textarea rows="5" cols="100" wrap="off">' +
        questTableHeader +
        tableRows.hard.join("") +
        questTableFooter +
        '</textarea>' +

        '<h2>' + getString('rage_quests_heading') + '</h2>' +
        '<p>' + getString('textarea_intro') + ' ' + getString('rage_quests') + '. ' + getString('textarea_paste') + ' ' +
        makeUrl('rage_quests', {template:true, type:'html'}) +
        '</p><textarea rows="5" cols="100" wrap="off">' +
        questTableHeader +
        tableRows.rage.join("") +
        questTableFooter +
        '\n' +
        '<div class="mw-customtoggle-RageDetailsTable wikia-menu-button">Show/Hide the Rage details table.<br /></div>\n' +
        '<div class="mw-collapsible mw-collapsed" id="mw-customcollapsible-RageDetailsTable">\n' +
        questTableHeaderRageExtra +
        tableRows.rageExtra.join("") +
        questTableFooter +
        '</textarea>' +
        '</div>' +

        '<p>This is an HTML version of the table that shows all quests (but with some differences to the tables you\'ll find on the wiki):</p>' +
        ((TEST_MODE) ? 'START OF HTML TABLE ' + new Date() : '') +
        htmlEnd
    );
}


function convertRow(rowArray, cellType = 'td') {  // cellType can also be 'th'
    var row = (cellType === 'td') ? '\n|-' : '';
    for (var i in rowArray) {
        var valueObj = rowArray[i];
        var value  = '';
        var config = '';
        if (Object.prototype.toString.call(valueObj) === '[object Array]') {
            value  = valueObj[0];
            config = valueObj[1] + ' | ';
        }
        else {
            value = valueObj;
        }
        row += '\n' +
               ((cellType === 'td') ? '|' : '!') +  // Wikia versions of td and th
               config +
               value;
    }
    return row;
}


function makeUrl(visibleText, options = {}) {
    var linkText = visibleText; // visibleText is what the user sees; linkText will be used to make the URL if needed
    var urlType = options['type'] || 'wiki'; // wiki or html or placeholder (for later converting to either using replacePlaceholderLink function)

    if (options['template']) { // the URL being linked to is a wiki Template
        visibleText = getTemplateName(visibleText);
        linkText = 'Template:' + visibleText;
    }

    var wikiPageName; // e.g., Jacko_of_the_Lantern
    var fullUrl; // e.g., https://habitica.fandom.com/wiki/Jacko_of_the_Lantern or a link to any other site

    var url = options['url'] || '';
    if (url.indexOf('://') > -1) {
        // A full URL was provided (e.g., https://example.com/whatever/). We assume it's not a wiki link.
        wikiPageName = ''; // this will remain empty
        fullUrl = url;
    }
    else if (url) {
        // A wiki page name was supplied as the URL, with or without underscores (e.g., "Jacko_of_the_Lantern" or "Jacko of the Lantern")
        wikiPageName = url; // might need changes later (e.g., to insert underscores)
    }
    else {
        // No URL was supplied so we create one from the visible text which we assume is a wiki page name.
        wikiPageName = linkText;
    }

    if (wikiPageName) {
        // Ensure the wiki page name is correct and create the full URL.
        wikiPageName = wikiPageName.replace(/ /g, '_');
        wikiPageName = wikiPageName.replace(getRegexp('part_url'), ''); // e.g., convert ...Taskwoods,_Part_3:_Jacko_of_the_Lantern to Jacko_of_the_Lantern
        // apply manual fixes to URLs that aren't correct when automatically created:
        if (wikiPageNameCorrections[inPageLanguage] && wikiPageNameCorrections[inPageLanguage][wikiPageName]) {
            wikiPageName = wikiPageNameCorrections[inPageLanguage][wikiPageName];
        }
        fullUrl = wikiaBaseUrl + wikiPageName;
    }

    var linkHtml = '<a href="' + fullUrl + '">' + visibleText + '</a>';
    if (TEST_MODE) linkHtml += ' ' + fullUrl;

    var linkWiki;
    if (wikiPageName === visibleText.replace(/ /g, '_')) {
        linkWiki = '[[' + visibleText + ']]';
    }
    else {
        linkWiki = '[[' + wikiPageName + '|' + visibleText + ']]';
    }

    if (urlType === 'html') {
        return linkHtml;
    }
    else if (urlType === 'placeholder') {
        return ':::' + linkWiki + ':::' + linkHtml + ':::';
    }
    else {
        return linkWiki;
    }
}


function replacePlaceholderLink(text, options = {}) {
    // text contains four array elements:
    // initial text (not part of link); link in wiki format; wiki link in html format; final text (not part of link)
    var elements = text.split(':::');
    if (! elements[1]) { // ::: didn't appear in the text; nothing to replace
        return elements[0];
    }
    var link = (options['type'] && options['type'] === 'html') ? elements[2] : elements[1];
    return elements[0] + link + elements[3];
}


function makeImage(image, hoverText, options = {}) {
    if (image === 'image_not_applicable') {
        return '';
    }
    if (options['html']) {
        // for the HTML table on the page, it's too hard to get a working link to a wikia image, so we display a broken image
        return '<img src="fake_broken_image" /><br />' + hoverText;
    }
    else {
        return '[[File:' + image + '|' + hoverText + ']]';
    }
}


function getString(key) {
    if (stringsForLanguage[inPageLanguage] && stringsForLanguage[inPageLanguage][key]) {
        return stringsForLanguage[inPageLanguage][key];
    }
    else if (stringsForLanguage['en'][key]) {
        return stringsForLanguage['en'][key];
    }
    else {
        return key;
    }
}

function getRegexp(key) {
    if (regexpsForLanguage[inPageLanguage] && regexpsForLanguage[inPageLanguage][key]) {
        return regexpsForLanguage[inPageLanguage][key];
    }
    else if (regexpsForLanguage['en'][key]) {
        return regexpsForLanguage['en'][key];
    }
    else {
        return key;
    }
}

function getTemplateName(key) {
    if (templateNamesForLanguage[inPageLanguage] && templateNamesForLanguage[inPageLanguage][key]) {
        return templateNamesForLanguage[inPageLanguage][key];
    }
    else if (templateNamesForLanguage['en'][key]) {
        return templateNamesForLanguage['en'][key];
    }
    else {
        return key;
    }
}


});
</script>

<style>
/*********************************************************************
****   Page-wide   ***************************************************
*********************************************************************/
body {
    font-family: Helvetica, Arial, sans-serif;
    font-size: 14px;
    background-color: rgb(173, 208, 215);
}
#innerBody {
    margin: 20px;
    padding: 5px 20px 30px 20px;
    background-color: rgb(242, 242, 230);
}
#loading {
    margin-right: 30px;
    margin-left: 30px;
    color: orange;
    font-size: 1.5em;
    font-weight: bold;
}
#loading ul {
    font-size: 0.8em;
}
#loading ul a {
    color: orange;
}


hr {
    width: 95%;
}
hr.padded {
    margin-top:    1em;
    margin-bottom: 2em;
}

.show {
    display: block;
}
.hide {
    display: none;
}
.clear {
    clear: both;
}

.subheading {
    font-weight: bold;
}
.highlight {
    font-weight: bold;
}
.lowlight { /* like highlight but less so */
    font-style: italic;
}
.explanation {
    font-style: italic;
}
abbr {
    border-bottom: 1px dashed black;
}
img.emoji {
    margin-bottom: -0.25em;
}
.forCopyPaste {
    /* used to add blank lines that we want when copying text to clipboard,
       but we don't want to see extra whitespace on the screen */
    margin-top: -1em;
}
ul.padded > li {
    padding: 3px 0;
}

.gearList .item .stats {
    font-variant: small-caps;
}
.gearList .item .key {
    display: none;
}


.coloured {
    display: inline-block;
    width: 5.5em;
    height: 3em;
    padding-top: .7em;
}
.colourBrightBlue { background-color: rgb(209,226,248); }
.colourBlueGrey   { background-color: rgb(216,230,232); }
.colourGreen      { background-color: rgb(222,237,219); }
.colourYellow     { background-color: rgb(255,244,216); }
.colourOrange     { background-color: rgb(254,234,216); }
.colourRed        { background-color: rgb(250,214,214); }
.colourDarkRed    { background-color: rgb(240,197,190); }

.neutral {
    background-color: #fffbd0; /* yellow */
}
.danger {
    background-color: #ffcccc; /* red */
}
.safe {
    background-color: #ccffcc; /* green */
}


/*********************************************************************
****   Header   ******************************************************
*********************************************************************/
h1 {
    float: left;
}
h1>a:first-child { /* "Habitica" link in header */
    color: black;
    text-decoration: none;
}
h1>a:first-child:hover { /* "Habitica" link in header */
    text-decoration: underline;
}
h1 span {
    font-size: 0.5em;
}


/*********************************************************************
****   Header   ******************************************************
*********************************************************************/
table {
    width: 100%;
    border-collapse: collapse;
}
table, th, td {
   border: 1px solid black;
}
th em {
    font-weight: normal;
}


</style>
</head>
<body><div id="innerBody">

<h1><a href="https://habitica.fandom.com/">Habitica Wiki</a> Quest Table Creator
    <span>(last updated 2021-05-31)</span></h1><!-- VERSION -->
<hr class="clear" />

<div id="loading">
    <div class="good hide">
        <p>Please wait. Fetching data from Habitica...</p>
    </div>
    <div class="bad hide">
        <p>There was an error obtaining the data.</p>
        <ul class="padded">
            <li>Please reload the page (but perhaps wait half an hour first in case Habitica is under heavy load).</li>
            <li>If you're using Internet Explorer, try another browser. <a href="https://www.google.com/intl/en/chrome/browser/">Chrome</a> or <a href="https://www.mozilla.org/en-US/firefox/new/">Firefox</a> will be more reliable.</li>
            <li>If neither of those help, <a href="mailto:lady_alys@oldgods.net">contact me</a>!</li>
        </ul>
    </div>
</div>

<div id="output">
</div>


<br />
<table id="theTable"></table>

<!--
== Table of All Quests in Quest Lines ==
{{:Template:Quest_Table_Quest_Lines}}

<noinclude>
Do not edit this table by hand. Instead, use the "Quest Lines" section in the [https://oldgods.net/habitrpg/quest_table_creator.html Quest Table Creator], which will read the latest "content" data from Habitica and create all the required wikia code. Delete everything below this "noinclude" tag and replace it with that code.
[[Category:Template Tables| ]][[Category:Habitica Templates]]
</noinclude>
-->

</div><!-- end of div id="innerBody" -->
</body>
</html>
