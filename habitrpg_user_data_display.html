<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>HabitRPG Unofficial User Data Display</title>

<!--

This code is licenced under the same terms as HabitRPG:
    https://raw2.github.com/HabitRPG/habitrpg/develop/LICENSE

https://github.com/Alys/tools-for-habitrpg/blob/master/habitrpg_user_data_display.html
AND required JavaScript libraries:
https://github.com/Alys/tools-for-habitrpg/blob/master/js--for--habitrpg_user_data_display.tar.gz

https://oldgods.net/habitrpg/habitrpg_user_data_display.html
    or http://is.gd/hrpguserdata

Contributors:
    Alys (Alice Harris), lady_alys@oldgods.net
    thepeopleseason (James Hsiao)

-->


<!-- ---------------------------------------------------------------
/////
/////
///// IMPORTANT NOTE TO PROGRAMMERS EDITING THIS PAGE:
/////
///// Do not add ANY features to this page which can modify a user's
///// account (at least not without making large changes to
///// "Privacy and security notes" and "Suspected Bugs", both of
///// which currently promise users that their accounts will not
///// be changed by this page).
/////
/////
--------------------------------------------------------------- -->


    <meta name="description" content="HabitRPG Unofficial User Data Display" />
    <meta name="author" content="Alys (Alice Harris) lady_alys@oldgods.net" />


    <script src="//code.jquery.com/jquery-latest.min.js"></script>
    <link href="js/DataTables/media/css/jquery.dataTables.css" rel="stylesheet" type="text/css" />
    <script src="js/DataTables/media/js/jquery.dataTables.js"></script>
    <link href="js/DataTables/extras/ColumnFilterWidgets/media/css/ColumnFilterWidgets.css" rel="stylesheet" type="text/css" />
    <script src="js/DataTables/extras/ColumnFilterWidgets/media/js/ColumnFilterWidgets.js"></script>
    <!-- These are a widely used and trusted third-party libraries that contain no code directly related to HabitRPG. They do not contain anything that could cause damage to your HabitRPG account. -->



    <script type="text/javascript">
var content; // hold site-wide content (gear names and stats, quests, etc)
var user;    // hold user's data
var dataFetchStatus = 'not attempted'; // also "succeeded" and "failed"
var knownTags = [];
var collectionDrops = false; // control Drops + Quest Progress opening

var serverName        = 'HabitRPG'; // used in "loading" message
var serverUrl         = 'https://habitrpg.com:443/api/v2';
var serverPathContent = '/content';
var serverPathUser    = '/user';
var userId            = '';
var apiToken          = '';

/* TST - FOR TESTING:
serverName        = 'localhost';
serverUrl         = 'http://localhost';
serverPathContent = '/cgi-bin/hrpg_content.pl';
serverPathUser    = '/cgi-bin/hrpg_user.pl';
apiToken          = 'null';
userId            = 'test';
userId            = 'work';
userId            = 'home';
*/

function d(msg) { console.log(msg) } /* laziness FTW! */

var entityMap = {
    "&": "&amp;",
    "<": "&lt;",
    ">": "&gt;",
    '"': '&quot;',
    "'": '&#39;',
    "/": '&#x2F;'
};
function escapeHtml(string) {
    return String(string).replace(/[&<>"'\/]/g, function (s) {
        return entityMap[s];
    });
}


$(document).ready(function() {
    $('#serverName').text(serverName);

    toggleVisibilityForStuff(); // hide some elements for initial page view
                                // (we have not yet fetched data)

    if ($('#userId').is(':visible')) { // need because of IE bug
        $("#userId").focus();
    }

    if (userId && apiToken) {
        /* This is only executed if the user has edited this file
           to hard-code their User ID and API Token into the variable
           declarations above. It fetches the user's data (no need to
           manually submit the API connection form), and also inserts the
           uid and token into the form, in case the user later
           chooses to view the form.
        */
        $('#userId').val(userId);
        $('#apiToken').val(apiToken);
        fetchData();
    }

    $('#userApiDetailsForm').submit(function(event){
        /* The user manually submitted the API connection form. */
        userId   = $('#userId').val();
        apiToken = $('#apiToken').val();
        fetchData();
    });

    // After data fetched, let the user hide/show the explanations and form:
    $('.explanationToggle').click(function(event){
        event.preventDefault();
        $('.separator'         ).toggleClass('show').toggleClass('hide');
        $('#introduction'      ).toggleClass('show').toggleClass('hide');
        $('#userApiDetailsForm').toggleClass('show').toggleClass('hide');
        $('#outroduction'      ).toggleClass('show').toggleClass('hide');
        toggleApiDetailsFormLinkText();
    });

    // After data fetched, let the user clear the fetched data:
    $('#clearData').click(function(){
        window.scrollTo(0, 0);
        window.location.reload(true);
    });


    // Version Changes hide/show:
    $('.versionToggle').click(function(event){
        event.preventDefault();
        $('#versionChanges').toggle();
        window.scrollTo(0, 0); // for closing with link under version history
    });

    // Task Overview explanation hide/show:
    $('.taskOverviewExplanationToggle').click(function(event){
        event.preventDefault();
        $('#taskOverviewSection .longExplanation').toggle();
        var linkText = 'explanation';
        if ($('#taskOverviewSection .longExplanation').is(':visible')) {
            $('.taskOverviewExplanationToggle a').text('hide ' + linkText);
        } else {
            $('.taskOverviewExplanationToggle a').text('show ' + linkText);
        }
    });

    // Damage from Dailies explanation hide/show:
    $('.damageDailiesExplanationToggle').click(function(event){
        event.preventDefault();
        $('#damageDailiesSection .longExplanation').toggle();
        var linkText = 'explanation';
        if ($('#damageDailiesSection .longExplanation').is(':visible')) {
            $('.damageDailiesExplanationToggle a').text('hide ' + linkText);
        } else {
            $('.damageDailiesExplanationToggle a').text('show ' + linkText);
        }
    });

    // Table of Contents (TOC) hide/show:
    $('#tableOfContents a').click(function(event){
        event.preventDefault();
        var sectionId = this.parentNode.id + 'Section';
        var wantToShow = true;
        if ($('#' + sectionId).is(':visible')) {
            // The ToC item that the user clicked on is already open,
            // so the user wants to close it.
            wantToShow = false;
        }
        $('.tocSection').hide();
        $('#tocClose').hide();
        if (wantToShow) {
            $('#' + sectionId).toggle();
            if ($('#' + sectionId).hasClass("longContent")) {
                $('#tocClose').show();
            }
            if ($('#damageDailiesSection').is(':visible') &&
                $('#dailiesIncomplete').is(':visible')) {
                $('#dailiesIncompleteSection').show();
            }
            if ($('#dropsTodaySection').is(':visible')) {
                $('#dashDrop').show();
                if (collectionDrops) {
                    // The user is on a collection quest and has viewed the
                    // Drops Received Today section, so also show them the
                    // Quest Progress section (collection quests have drops):
                    $('#questProgressSection').show();
                }
            }
            // if ($('#questProgressSection').is(':visible') && quest
                // && quest.content.boss
               // ) {    /////   Doesn't work - quest not defined yet, duh.
                // // The user is on a boss quest and has viewed the
                // // Quest Progress section, so also show them the
                // // Daily Damage section (dailies cause bosses to do damage):
                // $('#damageDailiesSection').show();
            // }
        }
    });
    $('#tocClose').click(function(event){
        event.preventDefault();
        $('.tocSection').hide();
        $('#tocClose'  ).hide();
        window.scrollTo(0, 0);
    });

    $('#dashIncompleteContainer').click(function() {
        $('#dailiesIncompleteSection').show();
    });
    $('#dashDamageContainer').click(function() {
        $('#damageDailiesSection').show();
    });
    $('#dashBossContainer').click(function() {
        $('#damageDailiesSection').show();
    });
    $('#dashQuestProgressDamage').click(function() {
        $('#questProgressSection').show();
    });
});

function toggleApiDetailsFormLinkText() {
    // change text for the hide/show link (for the intro, API form, etc)
    // based on the form's visibility
    var linkText = 'documentation and Fetch My Data form';
    if ($('#userApiDetailsForm').is(':visible')) {
        $('#versionChanges').hide();
        $('.tocSection'    ).hide();
        $('#tocClose'      ).hide();
        $('.explanationToggle').text('hide ' + linkText);
    } else {
        $('.explanationToggle').text('show ' + linkText);
    }
}

function toggleVisibilityForStuff() {
    $("#loading").hide();
    if (dataFetchStatus == 'succeeded') {
        $('.showOnlyIfHave_Not_FetchedData').removeClass('show')
                                               .addClass('hide');
        $('.showOnlyIfHaveFetchedData').removeClass('hide')
                                          .addClass('show');
    } else {
        // dataFetchStatus is 'not attempted' or 'failed' or anything else
        $('.showOnlyIfDataExists').removeClass('show')
                                  .addClass('hide');
        $('.showOnlyIfHave_Not_FetchedData').removeClass('hide')
                                               .addClass('show');
        $('.showOnlyIfHaveFetchedData').removeClass('show')
                                          .addClass('hide');
        $('.output').html(''); // wipe any data inserted from a previous run
    }

    // special case for errors:
    if (dataFetchStatus == 'failed') {
        $("#errors").show();
    }
    else {
        $("#errors").hide();
    }

    toggleApiDetailsFormLinkText();
}

function fetchData() {
    dataFetchStatus = 'not attempted'; // but is about to be...
    toggleVisibilityForStuff();
    $("#loading").show();
    // first fetch the site-wide content (gear names and stats, etc):
    $.when($.ajax({
        url: serverUrl + serverPathContent,
        type: 'GET',
        dataType: 'json',
        })).then(
    saveContentAndFetchUserData,
    fetchFailure
    );
}
function saveContentAndFetchUserData(data) {
    content = data;
    // now fetch the user's own content (tasks, gear owned, etc):
    $.when($.ajax({
        url: serverUrl + serverPathUser,
        type: 'GET',
        dataType: 'json',
        beforeSend: function(xhr){
                xhr.setRequestHeader('x-api-user', userId);
                xhr.setRequestHeader('x-api-key',  apiToken);
            }
        })).then(
    displayData,
    fetchFailure
    );
}
function fetchFailure() {
    $('#errors').html("There was an error obtaining your data."
            + " Please check that your User ID and API Token"
            + " are correct and then try again."
            + "<br />"
            + "<br />"
            + " If problems persist see"
            + " <strong>Suspected Bugs</strong> and"
            + " <strong>Contact Details</strong> at the bottom"
            + " of this page."
            + " It might help to upgrade your browser to its"
            + " latest version, if not already done.");
    dataFetchStatus = 'failed';
    toggleVisibilityForStuff();
}

function displayData(data) {
    user = data;
    dataFetchStatus = 'succeeded';
    toggleVisibilityForStuff();

    user.computedStat = [];
    user.computedStat['con'] = computeStat('con');
    user.computedStat['int'] = computeStat('int');
    user.computedStat['per'] = computeStat('per');
    user.computedStat['str'] = computeStat('str');


    // get some basic details about the user:
    $('#userNameDisplay').text(user.profile.name); // user's name in header
    var sleeping = user.preferences.sleep; // true if resting in the inn

    var quest;
    if (user.party.quest.key) {
        quest = $.extend({}, user.party.quest);
        quest.content = $.extend({}, content.quests[ user.party.quest.key ] );
    }


    //////////////////////////////////////////////////////////////////////
    ////   Unallocated Points        /////////////////////////////////////
    //////////////////////////////////////////////////////////////////////
    if (user.stats.points > 0 && user.stats.lvl >= 10) {
        var points = (user.stats.points == 1) ? "point" : "points";
        var them   = (user.stats.points == 1) ? "it"    : "them";
        $('#unallocatedPoints .output').html('<span class="highlight">You have '
            + user.stats.points
            + ' unallocated ' + points + '.</span>'
            + ' Go to <a href="https://habitrpg.com/#/options/profile/stats">'
            + 'your Profile -&gt; Stats page</a> to allocate ' + them + '. '
            + '<a href="http://habitrpg.wikia.com/wiki/Character_Attributes">'
            + 'Learn more.</a>');
        $('#unallocatedPoints.showOnlyIfDataExists').removeClass('hide')
                                                    .addClass('show');
    }
    if (data.stats.points) {
        $('#dashUnallocPoints').text(data.stats.points);
        $('#dashUnallocated').show(); // needed for re-fetch - XXX see if still needed after entire dashboard refetch has been implemented
    }
    else {
        $('#dashUnallocated').hide();
    }


    //////////////////////////////////////////////////////////////////////
    ////   Missing Equipment         /////////////////////////////////////
    //////////////////////////////////////////////////////////////////////
    var missing = [];
    $.each(user.items.gear.owned, function(key, value){
        if (value === false) {
            missing.push( prettyPrintKey(key, 'gear',
                            {'includeStats':true, 'includeGold':true, }) );
        }
    });
    if (missing.length > 0) {
        var missingHtml = '<p>You are missing this equipment: ';
        if (missing.length > 1) {
            missingHtml += '</p><ul><li>'
                         + missing.join('</li><li>')
                         + '</li></ul><p>';
        }
        else {
            missingHtml += missing.join(', ') + '. ';
        }
        missingHtml += '<a href="http://habitrpg.wikia.com/wiki/'
                     + 'Death_Mechanics#Lost_Equipment">Learn more.</a></p>';
        if (user.achievements.rebirths > 0 && missing.length > 6) {
            // We show the message below when rebirthers are missing
            // lots of gear, but not when they've bought back most of it,
            // because by that time, they're unlikely to be confused by
            // a long list of missing items, and the items are more and
            // more likely to be missing due to actual, recent deaths.
            missingHtml += '<p>You have used an Orb of Rebirth'
                + ' so this list will include all the equipment you owned'
                + ' in your previous life that you have not yet repurchased.'
                + ' Unfortunately it is not currently possible to limit'
                + ' this list to recent death-induced losses - but'
                + ' I have some interesting ideas to work on...</p>';
        }
        $('#missingEquipmentSection .output').html(missingHtml);
        $('#missingEquipment.showOnlyIfDataExists').removeClass('hide')
                                                   .addClass('show');
    }


    $('#currentGearSection .output').html(
            createCurrentGearSection() );


    var dropsExtra = ''; // normally leave this blank!
    // FOR TESTING (this does NOT contain all code for most drop chances):
    var dropChance = 1/150+0.2  // assume new task
                   * 1          // assume task priority easy
                   * 1          // assume no streak
                   * (1 + user.computedStat['per'] / 100)
                   * (1 + user.achievements.streak / 200);
    if (user.contributor.level) {
        dropChance *= (1 + user.contributor.level / 20);
    }
    dropChance = diminishingReturns(dropChance, 0.75);
    // dropsExtra=' ('+ user.computedStat['per'] +', '+ dropChance +')'; // TST


    $('#dropsTodaySection .output').html(
        'Drops received so far today: <span class="highlight">'
        + user.items.lastDrop.count + '</span>.' + dropsExtra);
    $('#dashDropCount').text(user.items.lastDrop.count||0);

    // Quest Progress section:
    if (quest) {
        // on a quest:
        // "quest":{"completed":null,"key":"ghost_stag",
        //          "progress":{"collect":{},"down":0,"up":13.780066986139815}},
        //
        // on a collection quest but found nothing yet:
        // "quest":{"completed":null,"key":"vice2","progress":{"collect":
        //          {"lightCrystal":0},"down":0,"up":0}},
        //
        // on a collection quest and found stuff:
        // "quest":{"completed":null,"key":"vice2","progress":{"collect":
        //          {"lightCrystal":2},"down":0,"up":2.4434153558001794}},
        //
        // not on a quest:
        // "quest":{"progress":{"collect":{},"down":0,"up":0}},
        //
        // before the user has ever joined a party or started a quest:
        // "party":{"current":null,"invitation":null,"quest":
        // {"progress":{"collect":{},"down":0,"up":0}},"order":"level"},
        //
        var msg = '';
        var qProgress = 0;
        if (quest.content.boss) {
            qProgress = Math.floor(quest.progress.up * 100) / 100;
            // user is on a boss quest
            msg = 'So far today you have done an estimated '
                + '<span class="highlight">'
                + qProgress
                + '</span>'
                + ' points of damage to '
                + quest.content.boss.name
                + '.';
            // We round DOWN with floor because we must never let the user
            // think they have even slightly more progress than they really
            // have. Imagine if they missed ending a quest overnight by 0.1
            // health because this page exaggerated their progress!
            $('#dashQuestProgressDamage').text(qProgress);
        }
        else if (quest.content.collect) {
            // user is on a collection quest
            collectionDrops = true; // Quest Progress will open when Drops opens
            var total = 0;
            var stuff = '';
            var uniqueItemsCount = 0;
            $.each(quest.progress.collect, function(tagId, value){
                uniqueItemsCount++;
                total += value;
                var itemName = quest.content.collect[tagId].text;
                if (uniqueItemsCount > 1) { // we have stuff already
                    stuff += ", ";
                }
                stuff += value + " " + itemName;
                if (value != 1) {
                    // pluralise itemName (possibly badly - XXX_LATER fix)
                    stuff += "s";
                }
            });
            var replaceStr = (uniqueItemsCount > 2) ? ", and" : " and";
            stuff = stuff.replace(/(.+),/, "$1" + replaceStr);
            msg = 'So far today you have found ' + '<span class="highlight">';
            if (total == 0) {
                msg += 'no items';
            }
            else {
                msg += stuff;
            }
            msg += '</span> for the '
                 + quest.content.text
                 + ' quest.';
        }
        $('#questProgressSection .output').html(msg);
        $('#questProgress.showOnlyIfDataExists').removeClass('hide')
                                                .addClass('show');
    }



    // Get an array of all of the user's tags so that when we are
    // examining a task's tags, we can ignore any tags that don't appear
    // in that array (e.g., tags the user has deleted but that weren't
    // removed from the task).
    $.each(user.tags, function(index, obj){
        knownTags.push(obj.id);
    });


    //////////////////////////////////////////////////////////////////////
    ////   Cycle through each task to pull out data //////////////////////
    ////   for Task Overview and other purposes     //////////////////////
    //////////////////////////////////////////////////////////////////////
    var allTasksArray = [];
    var numberHabits            = 0;
    var numberDailys            = 0;
    var numberTodos             = 0;
    var numberRewards           = 0;
    var countHabitsDailysTodos  = 0;
    var untaggedTasks = {'habits':[], 'dailys':[], 'todos':[], 'rewards':[]};

    ////// Habits:
    var habitHistory            = '';
    $.each(user.habits, function(index, obj){
        obj.text = escapeHtml(obj.text);
        numberHabits++;
        countHabitsDailysTodos++;
        allTasksArray.push(createTaskTableCellObj(obj, countHabitsDailysTodos));
        if (! taskIsTagged(obj.tags)) { untaggedTasks['habits'].push(obj); }
        habitHistory += collateHistoryForOneHabit(obj);
    });
    $("#habitHistorySection .output").html(habitHistory);

    ////// Dailies:
    var dailiesIncomplete       = [];
    var dailiesIncompleteGrey   = [];
    var dailysDamage = 0;
    var questDamage  = 0;
    var valueMin = -47.27; // task values are capped ...
    var valueMax =  21.27; // ... for some purposes
    var today = ["su","m","t","w","th","f","s"][(new Date()).getDay()];
    var conBonus = 1 - (user.computedStat['con'] / 250);
    if (conBonus < 0.1) { conBonus = 0.1; }
    var stealth = user.stats.buffs.stealth; // user avoids damage from dailies
    $.each(user.dailys, function(index, obj){
        obj.text = escapeHtml(obj.text);
        numberDailys++;
        countHabitsDailysTodos++;
        // obj.streak, obj.repeat..., obj.completed, obj.dateCompleted  XXX_SOON use them?
        // "streak":107,"checklist":[],"collapseChecklist":false,"repeat":{"su":true,"s":true,"f":true,"th":true,"w":true,"t":true,"m":true}
        allTasksArray.push(createTaskTableCellObj(obj, countHabitsDailysTodos));
        if (! taskIsTagged(obj.tags)) { untaggedTasks['dailys'].push(obj); }

        if (! sleeping) {
            // calculate cron damage if daily not actioned:
            if (! obj.completed && obj.repeat[today]) {
                // this Daily has not been completed but is due today, so
                // record its text and calculate HP damage:
                if (stealth > 0) {
                    // user evades this daily
                    stealth--;
                }
                else {
                    dailiesIncomplete.push(obj.text);
                    var currVal = obj.value; // task value
                    if (currVal < valueMin) { currVal = valueMin; } // capped
                    if (currVal > valueMax) { currVal = valueMax; } // capped
                    var nextDelta = Math.abs(Math.pow(0.9747, currVal));
                    var checklist = describeChecklist(obj);
                    if (checklist.exists) {
                        nextDelta *= (1 - checklist.proportionDone);
                        // NOTE: If you tick off all the items in a Daily
                        // checklist but don't tick off the Daily itself,
                        // you take zero damage (confirmed by testing).
                    }
                    var delta = nextDelta; // Change this if we ever take
                                           // account of multiple missed days.
                    questDamage += delta;
                    var hpMod = delta * conBonus * obj.priority * 2;
                    // priority is easy (1), medium (1.5), hard (2)
                    hpMod = Math.round(hpMod * 10) / 10; // HabitRPG uses round
                    dailysDamage += hpMod; // note this is NOT a negative number
                }
            }
            else if (! obj.completed && ! obj.repeat[today]) {
                // this Daily has not been completed and is NOT due today,
                // but we record its text in case the user cares:
                dailiesIncompleteGrey.push(obj.text);
            }
        }
    });
    if (quest && quest.content.boss) {
        questDamage = questDamage * quest.content.boss.str;
        questDamage = Math.ceil(questDamage * 10) / 10;
    }
    else {
        questDamage = 'n/a'; // need if we permanently show damage on dashboard
    }
    dailysDamage = Math.ceil(dailysDamage * 10) / 10;
    // We round UP with ceil because we must never let the user
    // think they will take even slightly less damage than they really
    // will. Imagine if they died from an extra 0.1 damage that this
    // page didn't tell them they had!
    // But for the total, rounding is safe, since excess decimals are
    // just due to float arithmetic weirdness:
    var totalDamage = Math.round((dailysDamage + questDamage) * 10) / 10;

    ////// Todos:
    $.each(user.todos, function(index, obj){
        obj.text = escapeHtml(obj.text);
        numberTodos++;
        countHabitsDailysTodos++;
        // obj.priority, obj.dateCompleted   XXX_SOON use them?
        if (obj.completed == true) {
            return true; // currently we don't display completed to-dos
        }
        allTasksArray.push(createTaskTableCellObj(obj, countHabitsDailysTodos));
        if (! taskIsTagged(obj.tags)) { untaggedTasks['todos'].push(obj); }
    });

    ////// Rewards:
    $.each(user.rewards, function(index, obj){
        obj.text = escapeHtml(obj.text);
        if (! taskIsTagged(obj.tags)) { untaggedTasks['rewards'].push(obj); }
    });


    //////////////////////////////////////////////////////////////////////
    ////   Task Overview starts here   ///////////////////////////////////
    //////////////////////////////////////////////////////////////////////

    $('#taskOverviewSection').show(); // need so table is laid out correctly
    // https://datatables.net/usage/columns
    $('#taskOverviewTable').dataTable({
        'aaData': allTasksArray,
        'aoColumns': [
    { 'mData' : 'order', // needed to ensure correst starting sort
      'sTitle': '#',    'bVisible': false,
    },
    { 'mData' : 'type',       'sClass': 'center',
      'sTitle': 'type',       'sWidth': '10%',
    },
    { 'mData' : 'attribute',  'sClass': 'center',
      'sTitle': 'attr.',       'sWidth': '10%',
    },
    { 'mData' : 'colour.label',
      'sTitle': 'colour',     'sClass': 'center', 'bVisible': false,
    },
    { 'sTitle': 'value',  'sClass': 'center',       'sWidth': '10%',
      'mData': function ( source, type, val ) {
        if (type === 'set') {
          return; // http://datatables.net/ref#mData
        }
        else if (type === 'display') {
          return '<span class="coloured ' + source.colour.id + '">'
               + source.value + '<br />' + source.colour.nameNoSpace
               + '</span>';
        }
        else if (type === 'filter') {
          return source.colour.name;
        }
        // 'sort', 'type' and undefined all just use the integer
        return source.value;
      }
    },
    { 'mData' : 'magnitude',      'sClass': 'center',       'sWidth': '10%',
                                  'asSorting': ['desc','asc'],
      'sTitle': '<abbr title="magnitude (the value, but with negative'
                + ' signs removed)">mag.</abbr>',
    },
    { 'sTitle': '<abbr title="creation date">added</abbr>',
                                 'sClass': 'center',       'sWidth': '10%',
                                 'asSorting': ['desc','asc'],
      'mData': function ( source, type, val ) {
        if (type === 'set') {
          return;
        }
        else if (type === 'display') {
          return '<abbr title="'
               + source.creation.dateAndTime + '">'
               + source.creation.shortDate
               + '</abbr>';
        }
        else if (type === 'filter') {
          return source.creation.dateAndTime;
        }
        return source.creation.dateAndTime;
      }
    },
    { 'sTitle': 'task',       'sWidth': '*',
      'mData': function ( source, type, val ) {
        if (type === 'set') {
          return;
        }
        else if (type === 'display') {
          return source.text.full;
        }
        else if (type === 'filter') {
          return source.text.full;
        }
        return source.text.full;
        // this routine made a lot more sense when I was
        // experimenting with different text for
        // display, filter, sort
      }
    },
        ],
        // 'scrollY': 300,
        // 'bInfo': false,
        // 'sDom': 'W<"clear"><"top"if>rt<"bottom"iflp><"clear">',
        'sDom': 'W<"clear"><"top"if>rt<"bottom"><"clear">',
        'bAutoWidth': false,
        'bPaginate': false,
        'bDeferRender': true,
        // 'bSortClasses': false,
        "sScrollX": "100%",
        // "sScrollXInner": "200%",
        "bDestroy": true, // allows table to recreate if Fetch Data is repeated
        'oColumnFilterWidgets': {
            'aiExclude': [ 0, 4, 5, 6, 7, 8 ],
        }
    });

    $('#taskOverviewSection').hide(); // table has now been laid out correctly


// XXX_SOON add age column - hidden? https://datatables.net/examples/basic_init/hidden_columns.html
// XXX_SOON cookies to save state https://datatables.net/examples/basic_init/state_save.html
// XXX_SOON (too slow?)  show/hide notes: https://datatables.net/examples/server_side/row_details.html
// XXX_SOON strikethrough for completed? Include dailies?
// XXX_SOON totals for filtered data in footer? https://datatables.net/examples/advanced_init/footer_callback.html

    //////////////////////////////////////////////////////////////////////
    ////   Task Overview ends here   /////////////////////////////////////
    //////////////////////////////////////////////////////////////////////


    //////////////////////////////////////////////////////////////////////
    ////   Untagged Tasks            /////////////////////////////////////
    //////////////////////////////////////////////////////////////////////
    var untaggedHtml = formatUntaggedTasks('Habits',  untaggedTasks['habits'])
                     + formatUntaggedTasks('Dailys',  untaggedTasks['dailys'])
                     + formatUntaggedTasks('Todos',   untaggedTasks['todos'])
                     + formatUntaggedTasks('Rewards', untaggedTasks['rewards']);
    if (untaggedHtml) {
        $('#untaggedTasksSection .output').html(untaggedHtml);
        $('#untaggedTasks.showOnlyIfDataExists').removeClass('hide')
                                                .addClass('show');
    }


    //////////////////////////////////////////////////////////////////////
    ////   Dailies Incomplete        /////////////////////////////////////
    //////////////////////////////////////////////////////////////////////
    var uncomplHtml = '';
    if (dailiesIncomplete.length > 0) {
        uncomplHtml += '<p>';
        uncomplHtml += (dailiesIncomplete.length > 1)
                     ? 'These dailies are due today and have'
                     : 'This daily is due today and has';
        uncomplHtml += ' not been completed:</p><ul><li>'
                     + dailiesIncomplete.join('</li><li>')
                     + '</li></ul>';
    }
    if (dailiesIncompleteGrey.length > 0) {
        var wordThis  = 'This';
        var wordDaily = 'daily';
        var wordIs    = 'is';
        var wordIt    = 'it';
        if (dailiesIncompleteGrey.length > 1) {
            wordThis  = 'These';
            wordDaily = 'dailies';
            wordIs    = 'are';
            wordIt    = 'them';
        }
        uncomplHtml += '<p>' + wordThis
                     + ' <a href="http://habitrpg.wikia.com/wiki/Dailies#'
                     + 'Grey_Dailies">grey '
                     + wordDaily
                     + '</a> ' + wordIs
                     + ' <span class="highlight">not</span> due today but'
                     + ' you can still complete '
                     + wordIt + ' for extra rewards:</p><ul><li>'
                     + dailiesIncompleteGrey.join('</li><li>')
                     + '</li></ul>';
    }
    if (uncomplHtml) {
        $('#dailiesIncompleteSection .output').html(uncomplHtml);
        $('#dailiesIncomplete.showOnlyIfDataExists').removeClass('hide')
                                                    .addClass('show');
    }
    $('#dashIncompleteDailies').text(dailiesIncomplete.length);
    if (dailiesIncomplete.length == 0) { // XXX fix this for data re-fetch
        $('#dashIncompleteContainer').removeClass('danger')
                                     .addClass('safe');
    }


    //////////////////////////////////////////////////////////////////////
    ////   Damage from Dailies       /////////////////////////////////////
    //////////////////////////////////////////////////////////////////////
    var damageDailiesHtml = '';
    var currentHealth = Math.round(user.stats.hp * 10) / 10;
    $('#dashCurrentHealth').text(currentHealth);
    if (sleeping) {
        damageDailiesHtml = '<p>You are'
            + ' <a href="http://habitrpg.wikia.com/wiki/Tavern">resting'
            + ' in the inn</a> so you will not take any damage from'
            + ' your uncompleted dailies.</p>';
        if (quest && quest.content.boss) {
            damageDailiesHtml += '<p>'
                + ' However, you are also on a'
                + ' <a href="http://habitrpg.wikia.com/wiki/Boss">boss</a>'
                + ' <a href="http://habitrpg.wikia.com/wiki/Quests">quest</a>'
                + ' so you <span class="highlight">will</span> still take'
                + ' damage from the uncompleted dailies of other quest'
                + ' participants.</p>';
        }
    }
    else {
        if (quest && quest.content.boss) {
            if (dailysDamage == 0) {
                damageDailiesHtml += '<p>You and your fellow'
                    + ' <a href="http://habitrpg.wikia.com/wiki/Quests">'
                    + 'quest</a> participants will take an'
                    + ' <span class="highlight">estimated '
                    + dailysDamage
                    + '</span> damage from your own dailies.</p><p>However you'
                    + ' <span class="highlight">will</span> still take'
                    + ' damage from the uncompleted dailies of other quest'
                    + ' participants.</p>';
            }
            else {
                damageDailiesHtml += '<p>If you do no more dailies today,'
                    + ' you will take an <span class="highlight">estimated '
                    + dailysDamage
                    + '</span> damage from your dailies directly.</p>'
                    + '<p>In addition, you are on a'
                    + ' <a href="http://habitrpg.wikia.com/wiki/Quests">'
                    + 'quest</a>, so the'
                    + ' <a href="http://habitrpg.wikia.com/wiki/Boss">boss</a>'
                    + ' will inflict an <span class="highlight">estimated '
                    + questDamage
                    + '</span> damage to you and to your fellow quest'
                    + ' participants because of your uncompleted dailies.</p>'
                    + '<p>Thus your total damage due to your own'
                    + ' uncompleted dailies will be '
                    + ' <span class="highlight">approximately '
                    + totalDamage
                    + '</span>. Your current health is <span class="highlight">'
                    + currentHealth
                    + '</span>.</p>'
                    + '<p>You will also take damage from the uncompleted'
                    + ' dailies of other quest participants.</p>';
            }
        }
        else {
            damageDailiesHtml += '<p>If you do no more dailies today,'
                + ' you will take an <span class="highlight">estimated '
                + dailysDamage
                + '</span> damage. Your current health is'
                + ' <span class="highlight">'
                + currentHealth
                + '</span>.</p>';
        }
    }
    $('#damageDailiesSection .output').html(damageDailiesHtml);
    $('#dashDamage'    ).text(dailysDamage);
    $('#dashBossDamage').text(questDamage);
    if (questDamage == 0) { // XXX fix this for data re-fetch?
        $('#dashDamageContainer').removeClass('danger')
                                 .addClass('safe');
        $('#dashBossContainer'  ).removeClass('danger')
                                 .addClass('safe');
    }
}


function formatUntaggedTasks(title, tasks) {
    var html = '';
    $.each(tasks, function(index, obj){
        html += '<li>' + obj.text + '</li>';
    });
    if (html) {
        return '<h3>' + title + '</h3><ul>\n'
             + html
             + '</ul>';
    }
    else {
        return '';
    }
}


function collateHistoryForOneHabit (obj){
    //// The commented out code below is only useful if ALL recent habit
    //// clicks are recorded in the user's data.
    //// Currently they are not:
    ////    https://github.com/HabitRPG/habitrpg/issues/3079
    ////    "habit history condenses current day's data"

    //// var canDoDown = obj.down;
    //// var canDoUp   = obj.up;
    //// var canDoBoth = canDoDown && canDoUp;

    // Here we take each history item, convert its date to a
    // standard format (my histories have varying formats,
    // presumably from different apps I've used), and store
    // it in an array; then we sort the array by date:
    var historyItems = [];
    $.each(obj.history, function(index, histObj){
        var value = histObj.value;
        var date = new Date(histObj.date); // ASSUME 'date' is a real date!
        historyItems.push({"date":date, "value":value});
    });
    historyItems.sort(function(a,b) {
        return a.date - b.date;
    });

    //// var previousValue; // used to work out if user hit + or -
    var historyList = [];
    $.each(historyItems, function(index, histObj){
        var value = histObj.value;
        var date  = myDateConverter(histObj.date);
        //// var buttonUsed = '?up/down?'; // default value
        //// if (canDoBoth) {
            //// if (previousValue != undefined) {
                //// buttonUsed = (value > previousValue) ? 'up' : 'down';
            //// }
        //// }
        //// else {
            //// buttonUsed = (canDoUp) ? 'up' : 'down';
        //// }
        value = Math.round(value * 100) / 100;
        historyList.push('<li>'
                + date
                //// + ': ' + ' <span class="buttonUsed">'
                //// + buttonUsed
                //// + '</span>'
                + ' <span class="historyValue">(value: '
                + value + ')</span>'
                + '</li>');
        //// previousValue = value;
    });
    var habitText = obj.text;
    var noHistoryClass = '';
    if (historyList.length == 0) {
        noHistoryClass = 'noHistory';
        habitText += ' <span>(no history)</span>';
    }
    else {
        historyList.reverse(); // put most recent at top (we couldn't
               // do this earlier when we sorted the items because the
               // 'buttonUsed' code needed them in chronological order
        habitText += "<ul>" + historyList.join("") + "</ul>";
    }
    return '<li class="' + noHistoryClass + '">' + habitText + '</li>';
}


function createCurrentGearSection() {
    var pastels = ['pblue','pgreen','porange','ppink','ppurple','pyellow'];
    var basicSkins = {'ddc994':'palest brown (1st)','f5a76e':'pink (2nd)',
            'ea8349':'orange (3rd)','c06534':'light brown (4th)',
            '98461a':'medium brown (5th)','915533':'dark brown (6th)',
            'c3e1dc':'blue (7th)','6bd049':'green (8th)'};
    var rainbowSkins = {'eb052b':'red','f69922':'orange','f5d70f':'yellow',
                        '0ff591':'green','2b43f6':'blue','d7a9f7':'pink',
                        '800ed0':'violet','rainbow':'rainbow'};
    var spookySkins=['monster','pumpkin','skeleton','zombie','ghost','shadow'];

    var klass = (user.stats.class == 'healer' ) ? 'Healer'
              : (user.stats.class == 'rogue'  ) ? 'Rogue'
              : (user.stats.class == 'wizard' ) ? 'Mage'
              : (user.stats.class == 'warrior') ? 'Warrior'
              :  user.stats.class;
    var currentGearEtcHtml = '';
    var appearance = [ 'class: <span class="attributeValue">'
                      + klass + '</span>' ];
    if (user.stats.buffs.snowball) {
        appearance.push('<span class="attributeValue">Snowball!</span>');
    }
    $.each([
        ['',      'size',         'build'                     ],
        ['',      'shirt',        'shirt'                     ],
        ['hair',  'color',        'hair colour'               ],
        ['hair',  'bangs',        'bangs',     'convertNumber'],
        ['hair',  'base',         'hair base', 'convertNumber'],
        ['hair',  'flower',       'flower',    'convertNumber'],
        ['hair',  'mustache',     'mustache',  'convertNumber'],
        ['hair',  'beard',        'beard',     'convertNumber'],
        ['',      'skin',         'skin colour'               ],
    ], function(index,obj) {
        var value;
        if (obj[0]) { value = user.preferences[obj[0]][obj[1]]; }
        else        { value = user.preferences[obj[1]];         }
        if (obj[1] == 'color' && ($.inArray(value, pastels) !== -1)) {
            value = value.replace(/^p/, "pastel ");
        }
        if (obj[3] == 'convertNumber') {
            value = convertCardinalToOrdinal(++value); // start from 1 not 0
            if (value == '1st') { value += ' (none)'; }
        }
        if (obj[1] == 'skin') {
            if ($.inArray(value, spookySkins) !== -1) {
                value = 'spooky: ' + value;
            }
            else if (rainbowSkins[value]) {
                value = 'rainbow: ' + rainbowSkins[value];
            }
            else if (basicSkins[value]) {
                value = 'basic: ' + basicSkins[value];
            }
            // if no match, we use the skin key (e.g., f133ee)
        }
        if (value) {
            appearance.push(obj[2] + ': <span class="attributeValue">'
                                   + value + '</span>');
        }
    });
    if (appearance.length > 0) {
        currentGearEtcHtml += '<div class="subsection">'
                            + '<p class="forCopyPaste">&nbsp;</p>'
                            + '<h3>Avatar</h3>'
                            + '<ul><li>'
                            + appearance.join('</li><li>')
                            + '</li></ul>'
                            + '</div>';
    }

    var equipped = prettyPrintGear(user.items.gear.equipped);
    if (equipped) {
        currentGearEtcHtml += '<div class="subsection">'
                            + '<p class="forCopyPaste">&nbsp;</p>'
                            + '<h3>Battle Gear</h3>'
                            + equipped
                            + '</div>';
    }

    var costume = '';
    if (user.preferences.costume) {
        costume = prettyPrintGear(user.items.gear.costume);
    }
    if (costume) {
        currentGearEtcHtml += '<div class="subsection">'
                            + '<p class="forCopyPaste">&nbsp;</p>'
                            + '<h3>Costume</h3>'
                            + costume
                            + '</div>';
    }

    var beasts = [];
    $.each([ 'currentMount', 'currentPet' ], function(index,type) {
        var value = user.items[type];
        if (value) {
            // improve display of pets/mounts (BearCub-Red -> Red Bear Cub):
            var speciesAndColour = value.split('-');
            value = speciesAndColour[1] + speciesAndColour[0];
            value = value.replace(/([A-Z])/g, " $1"); // spaces before Caps
            value += (type == 'currentPet') ? ' pet' : ' mount';
            beasts.push(value);
        }
    });
    if (beasts.length > 0) {
        currentGearEtcHtml += '<div class="subsection">'
                            + '<p class="forCopyPaste">&nbsp;</p>'
                            + '<h3>Beasts</h3>'
                            + '<ul><li>'
                            + beasts.join('</li><li>')
                            + '</li></ul>'
                            + '</div>';
    }
    return currentGearEtcHtml;
}


function prettyPrintKey(key, itemType, options) {
    // Takes a "key" (e.g., weapon_warrior_0) from HabitRPG's "content" data
    // and returns the name of the item (and sometimes other info).
    // If the name can't be found, it treats the key as the name.
    var name  = key;
    var extra = '';  // e.g., for gear: klass and type (weapon/armour/etc)
    if (itemType == 'gear') {
        var obj = content.gear.flat[key];
        name = obj.text
        if (name == 'Mustaine\'s Milestone Mashing Morning Star') {
            name = '<abbr title="Mustaine\'s Milestone Mashing Morning Star">'
                 + 'Mashing Morning Star</a>';
        }
        if (name == 'Stephen Weber\'s Shaft of the Dragon') {
            name = '<abbr title="Stephen Weber\'s Shaft of the Dragon">'
                 + 'Shaft of the Dragon</a>';
        }
        var type = obj.type;
        if (type == 'head') { type = 'headwear'; }
        extra = obj.klass;
        if (obj.klass == 'special' && obj.specialClass) {
            extra += " " + obj.specialClass;
        }
        extra += " " + type;
        if (options && options.includeStats) {
            extra += '; <span class="stats">'
                   + prettyPrintStats(obj,
                        {'includeGold':(options.includeGold || false)} )
                   + '</span>';
        }
    }
    var html = '<span class="item">'
             + '<span class="name">' + name + '</span>';
    if (extra) {
        html += ' <span class="extra">(' + extra + ')</span>';
    }
    html += ' <span class="key">{' + key + '}</span>';
    html += '</span>';
    return html;
}
function prettyPrintStats(obj, options) {
    var stats = [];
    if (options && options.includeGold) {
        stats.push(obj.value + " gp");
    }
    if (obj.con) { stats.push(obj.con + " con"); }
    if (obj.int) { stats.push(obj.int + " int"); }
    if (obj.per) { stats.push(obj.per + " per"); }
    if (obj.str) { stats.push(obj.str + " str"); }
    return stats.join(", ");
}
function prettyPrintGear(origObj, nakedMessage) {
    var obj = $.extend({}, origObj);
    var result = [];
    // Go through gear in a specific order, and then handle any gear we
    // missed (e.g., if there's a new type of gear):
    $.each([ 'head', 'headAccessory', 'armor', 'weapon', 'shield', 'back'
    ], function(index,gearType){
        if (obj[gearType]) {
            var html = prettyPrintOneGear(obj[gearType]);
            if (html) { result.push(html); }
            delete obj[gearType];
        }
    });
    $.each(obj, function(index,value){
        var html = prettyPrintOneGear(value);
        if (html) { result.push(html); }
    });

    if (result.length > 0) {
        return '<ul><li>'
             + result.join('</li><li>')
             + '</li></ul>';
    }
    else if (nakedMessage) {
        return '<p>' + nakedMessage + '</p>';
    }
    else {
        return false;
    }
}
function prettyPrintOneGear(key) {
    if (key.match(/_base_0$/)) { return false; } // ignore "No Helm/Armour/etc"
    var html = prettyPrintKey(key, 'gear');
    return html;
}


function computeStat(stat) {
    var computed = user.stats[stat]
                 + user.stats.buffs[stat]
                 + ((user.stats.lvl - 1) / 2);
    // get appropriate stat for each piece of Battle Gear:
    $.each(user.items.gear.equipped, function(index,key){
        var obj = content.gear.flat[key];
        var value = obj[stat];
        if (obj.klass        == user.stats.class ||
            obj.specialClass == user.stats.class
           ) {
            value *= 1.5;
        }
        computed += value;
    });
    return computed;
}


function describeChecklist(task) {
    // Takes a task object. Returns an object describing aspects of the
    // task object's checklist (including whether it exists or not).
    if (! task.checklist || task.checklist.length == 0) {
        return {'exists': false};
    }
    var countDone   = 0;
    $.each(task.checklist, function(index, obj){
        if (obj.completed == true) { countDone++; };
    });
    return {
        'exists': true,
        'proportionDone': (countDone / task.checklist.length),
        // 'numberOfItems': task.checklist.length,
        };
}


function createTaskTableCellObj(obj, orderNumber) {
    var date = new Date(obj.dateCreated); // ASSUME 'date' is a real date!
    var formattedDate = myDateConverter(date);
    var shortDate = formattedDate.replace(/^20/, "")  // remove century
                                 .replace(/ .*/, ""); // remove time
    // formattedDate = formattedDate.replace(/ /, "<br />");

    var shortValue = Math.round(obj.value * 100) / 100;

    return {'type':      obj.type,
            'attribute': obj.attribute.toUpperCase(),
            'text':      {'full':  obj.text,
                          'short': obj.text.replace(/(^.{80}).+/, "$1 ..."),
                         },
            'colour':    chooseColour(obj.value),
            'value':     shortValue,
            'magnitude': Math.abs(shortValue),
            'creation':  {'dateAndTime': formattedDate,
                          'shortDate': shortDate,
                         },
            'order':     orderNumber,
        };
}

function chooseColour(value) {
    // XXX_LATER create full Obj for each colour, then merely assign Obj here
    //
    // from http://habitrpg.wikia.com/wiki/Task_Value :
    // Bright Blue  Greater than 10
    // Blue Grey    Between 5 and 10
    // Green        Between 1 and 5
    // Yellow       Between -1 and 1
    // Orange       Between -10 and -1
    // Red          Between -20 and -10
    // Dark Red     Less than -20
    var colourObj; // "u" is your friend and is not to be feared
    if        (value >  10) { colourObj = {'order':1, 'name':'Bright Blue'};
    } else if (value >   5) { colourObj = {'order':2, 'name':'Blue Grey'};
    } else if (value >   1) { colourObj = {'order':3, 'name':'Green'};
    } else if (value >  -1) { colourObj = {'order':4, 'name':'Yellow'};
    } else if (value > -10) { colourObj = {'order':5, 'name':'Orange'};
    } else if (value > -20) { colourObj = {'order':6, 'name':'Red'};
    } else                  { colourObj = {'order':7, 'name':'Dark Red'};
    }

    colourObj.label       = colourObj.order + ") " + colourObj.name;
    colourObj.nameNoSpace = colourObj.name.replace(/ /, '');
    colourObj.id          = 'colour' + colourObj.nameNoSpace;
    return colourObj;
}


function taskIsTagged(tagObj) { // returns true if tagged, false otherwise
    tagFound = false; // we have not yet found any valid tags for this task
    $.each(tagObj, function(tagId, value){
        if (value === false) {
            // this tag was once applied to the task, but no longer
            return true; // go to next iteration
        }
        if ($.inArray(tagId, knownTags) >= 0) {
            tagFound = true;
            return false; // break out of the loop
        }
    });
    return tagFound;
}


function convertCardinalToOrdinal(num) {
    var numStr = num.toString();
    var last   = numStr.slice(-1);
    var len    = numStr.length;
    var ord    = '';
    switch (last) {
        case '1':
            ord = numStr.slice(-2) === '11' ? 'th' : 'st';
            break;
        case '2':
            ord = numStr.slice(-2) === '12' ? 'th' : 'nd';
            break;
        case '3':
            ord = numStr.slice(-2) === '13' ? 'th' : 'rd';
            break;
        default:
            ord = 'th';
            break;
    }
    return num.toString() + ord;
}


function diminishingReturns(bonus, max) {
    var halfway = max/2;
    var diminished = max * bonus / (bonus + halfway);
    return diminished;
}


var myDateConverter = function(date) {
    var y = date.getFullYear();
    var m = date.getMonth() + 1;
    var d = date.getDate();
    var H = date.getHours();
    var M = date.getMinutes();
    var S = date.getSeconds();
    var dateStr = y
         + '-' + (m<=9 ? '0'+m : m)
         + '-' + (d<=9 ? '0'+d : d)
         + ' ' + (H<=9 ? '0'+H : H)
         + ':' + (M<=9 ? '0'+M : M)
         + ':' + (S<=9 ? '0'+S : S);
    return dateStr;
    // return dateStr + " (" + date.toLocaleString() + ")" + " (" + value + ")";
};

    </script>



    <style>


/* classes to control show/hide for blocks of content */
.showOnlyIfHave_Not_FetchedData { /* e.g., show API form before data fetch */
    /* no styles go here - this class is just for jquery to act on */
}
.showOnlyIfHaveFetchedData { /* e.g., show "main" div when we have data */
    /* no styles go here - this class is just for jquery to act on */
}
.showOnlyIfDataExists { /* e.g., show ToC link when optional section has data */
    /* no styles go here - this class is just for jquery to act on */
}
.show {
    display: block;
}
.hide {
    display: none;
}
#loading { /* visible only during actual fetch attempt */
    display: none;
    color: orange;
    font-size: 1.5em;
    font-weight: bold;
}

body {
    font-family: Helvetica, Arial, sans-serif;
    font-size: 14px;
    background-color: rgb(173, 208, 215);
}
#innerBody {
    margin: 20px;
    padding: 5px 20px;
    background-color: rgb(242, 242, 230);
}
#main {
    padding-bottom: 30px;
}
hr {
    width: 95%;
}
hr.separator {
    margin-bottom: 30px;
}
abbr {
    border-bottom: 1px dashed black;
}
abbr.discrete {
    border-bottom: none;
}


.selfClear:after {
    content: "";
    clear: both;
    display: block;
}
.clear {
    clear: both;
}
.highlight {
    font-weight: bold;
}
.lowlight { /* like highlight but less so */
    font-style: italic;
}
.explanation {
    font-style: italic;
}
.longExplanation {
    display: none;
}
#errors {
    font-weight: bold;
    color: orange;
    margin: 30px;
}
.subheading {
    font-weight: bold;
}
.tip {
    font-style: italic;
}
.forCopyPaste {
    /* used to add blank lines that we want when copying text to clipboard,
       but we don't want to see extra whitespace on the screen */
    margin-top: -1em;
}


h1 {
    float: left;
}
h1>a:first-child { /* "HabitRPG" link in header */
    color: black;
    text-decoration: none;
}
h1 .versionToggle {
    font-size: 50%;
}
#versionChanges dl {
    margin-left: 30px;
}
#versionChanges dl dt {
    font-size: 115%;
    font-weight: bold;
}
#versionChanges dl dt .date {
    padding-left: 10px;
    font-size: 80%;
    font-weight: normal;
}
#versionChanges .versionToggle {
    padding-bottom: 15px;
    margin-bottom: 10px;
}


#userNameDisplay {
    text-align: right;
    font-weight: bold;
    font-size: 2em;
    margin-bottom: 10px;
}
#explanationAndClearLinks {
    text-align: right;
}
#explanationAndClearLinks  a {
    padding-left: 20px;
}
#end .explanationToggle {
    padding: 20px 0;
}

#userApiDetailsForm {
    margin: 30px;
}
#userApiDetailsForm fieldset {
    max-width: 40em;
}
#userApiDetailsForm fieldset label,
#userApiDetailsForm fieldset input[type="submit"] {
    display: block;
    float: left;
    clear: left;
    margin: 10px 0;
}
#userApiDetailsForm fieldset label span {
    display: block;
    float: left;
    width: 6em;
}
#userApiDetailsForm fieldset label input {
    float: left;
    width: 30em;
}
#userApiDetailsForm fieldset p {
    clear: both;
}
#userApiDetailsForm legend .highlight {
    font-size: 130%;
}
#userApiDetailsForm fieldset li {
    margin-bottom: 7px;
}

#outroduction {
    max-width: 700px;
}
#outroduction h2 {
    font-weight: bold;
    font-size: 130%;
}
#outroduction li {
    margin-bottom: 10px;
}

ul#tableOfContents,
ul#tableOfContents ul {
    list-style-type: none;
    margin-right: 20px;
}
ul#tableOfContents ul {
    margin-left: 1em;
    padding: 0;
}
#tableOfContents li {
    font-size: 110%;
    padding: 2px 0;
}
ul#tableOfContents > li {
    float: left;
    margin-right: 20px;
}

h2 {
    margin-top: 30px;
}
.tocSection {        /* each section of data is hidden by default */
    display: none;
}
.closer { /* as in "a thing that closes", not "nearer" */
    font-size: 90%;
    margin-top: 30px;
    padding-top: 15px;
    padding-bottom: 15px;
}
.closer:hover {
    border: 1px dashed lightgrey;
}

.narrowContent {       /* The DATA should be as wide as the user's window */
    max-width: 500px;  /* but explanatory paragraphs should be narrow.    */
}
.urgent {                     /* "urgent" is a bit of an exaggeration but */
    margin: 30px 0 30px 50px; /* we do want these messages to stand out   */
}

#taskOverviewSection > ul > li {
    padding: 3px 0;
}
.taskOverviewExplanationToggle {
    margin-bottom: 1em;
}
#taskOverviewTable {
    width: 100%;
    table-layout: fixed;
    word-wrap: break-word;
}
#taskOverviewTable .sorting_1,
#taskOverviewTable .sorting_2,
#taskOverviewTable .sorting_3,
#taskOverviewTable .even {
    background-color: #FAF9F9;
}
#taskOverviewTable .odd  {
    background-color: #FEFEFF;
}
#taskOverviewTable_filter input {
    width: 300px;
}
#taskOverviewTable th {
    text-align: left;
}
#taskOverviewTable tr th:nth-child(3),
#taskOverviewTable tr td:nth-child(3) {
    max-width: 60px !important;
}

.coloured {
    display: inline-block;
    width: 5.5em;
    height: 3em;
    padding-top: .7em;
}
.colourBrightBlue { background-color: rgb(209,226,248); }
.colourBlueGrey   { background-color: rgb(216,230,232); }
.colourGreen      { background-color: rgb(222,237,219); }
.colourYellow     { background-color: rgb(255,244,216); }
.colourOrange     { background-color: rgb(254,234,216); }
.colourRed        { background-color: rgb(250,214,214); }
.colourDarkRed    { background-color: rgb(240,197,190); }

#habitHistorySection .buttonUsed { /* which habit button (+ or -) was pressed */
    font-weight: bold;
}
#habitHistorySection .historyValue {
    font-size: .8em;
}
#habitHistorySection li {
    padding: 3px 0;
}
#habitHistorySection li li {
    padding: 1px 0;
}
#habitHistorySection .noHistory {
    font-weight: bold;
}
#habitHistorySection .noHistory span {
    font-size:  .8em;
    font-style: italic;
    font-weight: normal;
}

#damageDailiesSection li {
    padding: 3px 0;
}

.gearList .item .stats {
    font-variant: small-caps;
}
.gearList .item .key {
    display: none;
}

#missingEquipmentSection .gearList ul {
    list-style-type: none;
}
#missingEquipmentSection .gearList .item .name {
    font-weight: bold;
}
#missingEquipmentSection .gearList .item .extra {
}

#currentGearSection .subsection {
    float: left;
    margin-right: 2em;
}
#currentGearSection .gearList ul {
    list-style-type: none;
    margin: 0;
    padding: 0;
}
#currentGearSection .gearList .item .name {
}
#currentGearSection .gearList .item .extra {
    font-style: italic;
}
#currentGearSection .attributeValue {
    font-weight: bold;
}

#dailiesIncompleteSection ul {
    list-style-type: none;
}
#dailiesIncompleteSection ul li {
    padding: 3px 0;
}
#dailiesIncompleteSection p:nth-of-type(2) {
    margin-top: 2em;
}

#dashboardInner {
    float: left;
}
#dashboard li {
    text-align: center;
    width: 120px;
    background-color: #fffbd0;
    border: 1px;
    padding: 4px;
    margin-right: 4px;
    float: left;
    list-style-type: none;
}
#dashboard .danger {
    background-color: #ffcccc;
}
#dashboard .safe {
    background-color: #ccffcc;
}
#dashboard .stat {
    font-size: 30px;
    font-weight: bold;
    padding: 2px;
}
#dashboard .statLabel {
    font-size: 8pt;
    padding: 1px;
}
#dashboard .stats {
    box-shadow: 1px 1px 1px 1px #666666;
}
#dashboard #dashDrop { /* XXX when implementing dashboard re-fetch fix, do NOT reset the user's choice to show this */
    display: none;
}

    </style>
</head>
<body><div id="innerBody">

<h1><a href="https://habitrpg.com/">HabitRPG</a> Unofficial User Data Display
    <a class="versionToggle" href="">(v1.6.2)</a></h1>

<div id="userNameDisplay" class="showOnlyIfHaveFetchedData"></div>

<div id="explanationAndClearLinks" class="showOnlyIfHaveFetchedData">
    <a class="explanationToggle" href="">show documentation and the
                                        "Fetch My Data" form</a>
    <a id="clearData" href="">clear my data</a>
</div>
<hr class="clear" />


<div id="versionChanges" class="hide"><!-- VERSION -->
    <h2>Version History</h2>
    <dl>

        <dt>1.6.2 <span class="date">2014-04-13</span></dt>
        <dd><ul>
            <li>Code:
                <ul>
                    <li>Changes to the dashboard code, from thepeopleseason.</li>
                </ul>
            </li>
        </ul></dd>

        <dt>1.6.1 <span class="date">2014-04-13</span></dt>
        <dd><ul>
            <li>Features (minor):
                <ul>
                    <li><span class="subheading">Damage from Dailies</span> is now complete and seems to be accurate. But don't trust it with your life! Please read the warning in that section (click its "show explanation" link).</li>
                    <li><span class="subheading">Current Appearance and Gear</span> and <span class="subheading">Missing Equipment</span> now specify the class for special gear that has a class.</li>
                </ul>
            </li>
            <li>Documentation / Layout:
                <ul>
                    <li>Renamed <span class="subheading">Tasks that have not been Tagged</span> to <span class="subheading">Tasks Untagged</span>.</li>
                    <li><span class="subheading">Damage from Dailies</span>: Improved (I hope) wording to explain the two kinds of damage you can take (normal and boss), to help new users. Feedback welcome if it's actually become worse. You can just look at the bolded parts if you already understand what's going on.</li>
                </ul>
            </li>
            <li>Code:
                <ul>
                    <li>Initial code for a dashboard, thanks to thepeopleseason! The dashboard is currently hidden while development continues.</li>
                    <li>The page now erases generated HTML and hides optional ToC entries before data is (re-)fetched to prevent incorrect display of old data.</li>
                    <li>Various other code improvements.</li>
                </ul>
            </li>
        </ul></dd>

        <dt>1.6 <span class="date">2014-04-10</span></dt>
        <dd><ul>
            <li>Features:
                <ul>
                    <li><span class="subheading">Dailies Incomplete</span>: Lists the dailies scheduled for today that you have not yet completed. Also has a separate list of <a href="http://habitrpg.wikia.com/wiki/Dailies#Grey_Dailies">grey dailies</a> that have not been completed. This section won't appear if you have completed all of your dailies.</li>
                </ul>
            </li>
        </ul></dd>

        <dt>1.5 <span class="date">2014-04-08</span></dt>
        <dd><ul>
            <li>Features:
                <ul>
                    <li><span class="subheading">Current Appearance and Gear</span>: Lists the <a href="http://habitrpg.wikia.com/wiki/Equipment">equipment</a> you are wearing (battle gear and costume), your <a href="http://habitrpg.wikia.com/wiki/Profile#Avatar">avatar's appearance settings</a> (skin colour, hair, etc), and your <a href="http://habitrpg.wikia.com/wiki/Pets">pet</a> and <a href="http://habitrpg.wikia.com/wiki/Mounts">mount</a>. This lets you easily record an appearance that you especially like or a set of battle gear that gives you useful stats (e.g., you could copy and paste this section to a text file).</li>
                </ul>
            </li>
            <li>Code:
                <ul>
                    <li>Improvements to <span class="subheading">Damage from Dailies</span>. CON from gear (including class bonuses) is now included; Stealth buff is still NOT included (but will be soon). This seems pretty accurate now but there's still more testing to be done before it could be called reliable.</li>
                </ul>
            </li>
        </ul></dd>

        <dt>1.4.5 <span class="date">2014-04-06</span></dt>
        <dd><ul>
            <li>Features:
                <ul>
                    <li><span class="subheading">Damage from Dailies</span> now includes a (wildly inaccurate?) <span class="highlight">estimate</span> of how much damage you and your fellow quest participants will take from a quest boss if you do no more dailies today. This is experimental and still being tested.</li>
                </ul>
            </li>
        </ul></dd>
        <dt>1.4.4 <span class="date">2014-04-06</span></dt>
        <dd><ul>
            <li>Features:
                <ul>
                    <li><span class="subheading">Missing Equipment</span> contains the cost and stats for each item to help you work out if it's worth changing class to buy it back (also, layout is neater for several items)</li>
                </ul>
            </li>
            <li>Documentation / Layout:
                <ul>
                    <li>Table of Contents is split into Tasks and Other. It was threatening to become cluttered.</li>
                    <li>Table of Contents links will now hide their respective sections when clicked on a second time (consistent with all other hide/show links on the page)</li>
                    <li>Task Overview explanation is now hidden by default to save precious screen space.</li>
                </ul>
            </li>
            <li>Code:
                <ul>
                    <li>Inserted a slightly nasty hack to allow Chrome to save the User ID and API Token if the user chooses to do that. (<a href="http://www.zdnet.com/do-you-save-passwords-in-chrome-maybe-you-should-reconsider-7000019074/">Obligatory warning about problems with storing passwords in browsers</a> - be careful especially on shared computers).</li>
                    <li>HabitRPG's "content" json data is now fetched before the user data so that we can use it for displaying attractive gear names, and calculating stats from gear.</li>
                </ul>
            </li>
        </ul></dd>
        <dt>1.4.3 <span class="date">2014-04-05</span></dt>
        <dd><ul>
            <li>Features: none</li>
            <li>Code:
                <ul>
                    <li>Improvements to <span class="subheading">Damage from Dailies</span> but it's still experimental and not to be trusted. Damage reduction from checklists is now included; CON buffs are now included (but not CON gear nor Stealth)</li>
                </ul>
            </li>
        </ul></dd>
        <dt>1.4 <span class="date">2014-04-03</span></dt>
        <dd><ul>
            <li>Features:
                <ul>
                    <li><span class="subheading">Damage from Dailies</span>: an <span class="highlight">estimate</span> of how much damage you would take if you did no more dailies today. Be cautious about using this if you are low on health! Please read the warning in that section (click its "show explanation" link).</li>
                </ul>
            </li>
        </ul></dd>
        <dt>1.3.3 <span class="date">2014-03-31</span></dt>
        <dd><ul>
            <li>Features:
                <ul>
                    <li><span class="subheading">"show documentation and Fetch My Data form"</span>: now when you use that link, it hides any other sections that you had open, so that you can more easily get to the form. Tell me if that's inconvenient for you (Contact Details at bottom of documentation).</li>
                </ul>
            </li>
        </ul></dd>
        <dt>1.3.2 <span class="date">2014-03-31</span></dt>
        <dd><ul>
            <li>Features:
                <ul>
                    <li><span class="subheading">"show documentation and Fetch My Data form"</span> is back and the bug that prompted me to remove it has been fixed. Thanks to <a href="http://habitrpg.wikia.com/wiki/User:BrightBold">BrightBold</a> for <a href="http://habitrpg.wikia.com/wiki/User_blog:LadyAlys/HabitRPG_Unofficial_User_Data_Display#comm-11596">explaining</a> that it was an important feature for people who use the tool a lot.</li>
                </ul>
            </li>
        </ul></dd>
        <dt>1.3.1 <span class="date">2014-03-30</span></dt>
        <dd><ul>
            <li>Features:
                <ul>
                    <li><span class="subheading">Habit History</span> now has bolding when there's no history, as they could be habits that you need a bit more encouragement to do - thanks to <a href="http://habitrpg.wikia.com/wiki/User:Malkin">Malkin</a> for the <a href="http://habitrpg.wikia.com/wiki/User_blog:LadyAlys/HabitRPG_Unofficial_User_Data_Display#comm-11572">suggestion</a></li>
                </ul>
            </li>
            <li>Documentation:
                <ul>
                    <li>Added wiki blog post to Contact Details (you can comment on the post)</li>
                    <li><span class="subheading">show documentation</span> link (used to be "show explanations...") no longer unhides the Fetch My Data form because fetching new data over the top of old data was causing problems.</li>
                </ul>
            </li>
        </ul></dd>
        <dt>1.3 <span class="date">2014-03-30</span></dt>
        <dd><ul>
            <li>Features:
                <ul>
                    <li><span class="subheading">Task Overview</span></li>
                </ul>
            </li>
            <li>Code:
                <ul>
                    <li>To run this page locally, you must now install <a href="http://datatables.net/">Data Tables</a> and <a href="http://www.datatables.net/extras/thirdparty/ColumnFilterWidgets/DataTables/extras/ColumnFilterWidgets/">ColumnFilterWidgets</a>. A cut-down version of both (e.g., no documentation) can be found <a href="https://github.com/Alys/tools-for-habitrpg/blob/master/js--for--habitrpg_user_data_display.tar.gz">on github</a>.</li>
                </ul>
            </li>
        </ul></dd>
        <dt>1.2 <span class="date">2014-03-29</span></dt>
        <dd><ul>
            <li>Features:
                <ul>
                    <li><span class="subheading">Quest Progress</span> now works for <span class="subheading">Collection Quests</span>. While on a collection quest, opening Drops Received Today automatically opens Quest Progress too.</li>
                    <li><span class="subheading">Missing Equipment</span> now includes apologetic message for Orb of Rebirthers (feature is unhelpful for them but that might change).</li>
                </ul>
            </li>
            <li>Documentation:
                <ul>
                    <li>Updated Possible Future Features</li>
                    <li>Added Version History</li>
                </ul>
            </li>
        </ul></dd>
        <dt>1.1 - initial release <span class="date">2014-03-27</span></dt>
        <dd><ul>
            <li>Features:
                <ul>
                    <li class="subheading">Unallocated Points</li>
                    <li class="subheading">Habit History</li>
                    <li class="subheading">Quest Progress</li>
                    <li class="subheading">Missing Equipment</li>
                    <li class="subheading">Drops Received Today</li>
                    <li class="subheading">Tasks That Have Not Been Tagged</li>
                </ul>
            </li>
            <li>Documentation:
                <ul>
                    <li>Privacy and security notes (also related comments within the code)</li>
                    <li>What's On This Page? (descriptions of each feature)</li>
                    <li>Possible Future Features</li>
                    <li>Suspected Bugs (no support for old browsers; mobile support unknown)</li>
                    <li>Help and Contact Details</li>
                </ul>
            </li>
        </ul></dd>
    </dl>
    <div class="versionToggle closer"><a href="">close version history</a> <span class="tip">(or click the version number again to close)</span></div>
    <hr class="separator" />
</div>


<div id="errors" class="narrowContent">
</div>

<div id="loading">
    <p>Please wait. Your data is being fetched from
    <span id="serverName">HabitRPG</span>...</p>
</div>

<div id="main" class="showOnlyIfHaveFetchedData">

    <div id="dashboard" class="selfClear">
    <ul id="dashboardInner"><!-- XXX wipe data before refetch -->
        <li><div class="stats">
            <div id="dashCurrentHealth" class="stat"></div>
            <div class="statLabel">Current Health</div></div>
        </li>
        <li><div id="dashIncompleteContainer" class="stats danger">
            <div id="dashIncompleteDailies" class="stat"></div>
            <div class="statLabel">Incomplete Dailies</div></div>
        </li>
        <li><div id="dashDamageContainer" class="stats danger">
            <div id="dashDamage" class="stat"></div>
            <div class="statLabel">Est. Damage</div></div>
        </li>
        <li><div id="dashBossContainer" class="stats danger">
            <div id="dashBossDamage" class="stat"></div>
            <div class="statLabel">Est. Boss Damage</div></div>
        </li>
        <li><div class="stats">
            <div id="dashQuestProgressDamage" class="stat"></div>
            <div class="statLabel">Quest Damage</div></div>
        </li>
        <li id="dashDrop"><div class="stats">
            <div id="dashDropCount" class="stat"></div>
            <div class="statLabel">Drop Count</div></div>
        </li>
        <li id="dashUnallocated"><div class="stats">
            <div id="dashUnallocPoints" class="stat"></div>
            <div class="statLabel">Unallocated Points</div></div>
        </li>
    </ul>
    </div>

    <ul id="tableOfContents" class="selfClear"><!-- TOC ToC toc -->
        <!-- Some of these items are hidden by default so that they can
             be shown only if relevant (e.g., you see Quest Progress
             only if you are on a quest).
        -->
        <li>Tasks:<ul>
            <li id="habitHistory"><a href="">Habit History</a></li>
            <li id="taskOverview"><a href="">Task Overview</a></li>
            <li id="dailiesIncomplete" class="showOnlyIfDataExists"><a href="">Dailies Incomplete</a></li>
            <li id="untaggedTasks" class="showOnlyIfDataExists"><a href="">Tasks Untagged</a></li>
        </ul></li>
        <li>Other:<ul>
            <li id="damageDailies"><a href="">Damage from Dailies</a></li>
            <li id="dropsToday"><a href="">Drops Received Today</a></li>
            <li id="questProgress" class="showOnlyIfDataExists"><a href="">Quest Progress</a></li>
            <li id="missingEquipment" class="showOnlyIfDataExists"><a href="">Missing Equipment</a></li>
            <li id="currentGear"><a href="">Current Appearance and Gear</a></li>
        </ul></li>
    </ul>
    <hr />

    <div id="unallocatedPoints" class="showOnlyIfDataExists urgent">
        <!-- section is shown automatically if there are points -->
        <p class="output"></p>
    </div>

    <div class="tocSection longContent" id="taskOverviewSection">
        <h2>Task Overview</h2>
        <div class="taskOverviewExplanationToggle"><a href="">show explanation</a></div>
        <div class="longExplanation">
        <p class="lowlight">NOTE: This feature contains advanced JavaScript and layout options which will probably perform differently in different browsers. If you experience problems, send screenshots <a href="mailto:lady_alys@oldgods.net">to Alys</a> and tell her what browser you are using (browser name AND version e.g., "Firefox 28.0") and what operating system (e.g., Windows XP).</p>

        <p>The table below shows your tasks (habits, dailies, and to-dos), with their <a href="http://habitrpg.wikia.com/wiki/Advanced_Options">attributes</a> and <a href="http://habitrpg.wikia.com/wiki/Task_Value">colours, values, and magnitudes</a> (value and magnitude are useful for choosing tasks to cast skills on). Completed to-dos are not shown; completed dailies are.</p>
        <ul>
        <li><span class="subheading">Sorting:</span> Click on a column heading to sort the table by that column. Then, hold down your shift key and click on other column headings for a multi-column sort. The starting sort order is the order of your tasks in HabitRPG.</li>
        <li><span class="subheading">Filtering:</span> Use the drop-down menus ("type", "attribute", "colour") to filter the list. Select multiple items from one menu to filter for tasks matching <span class="highlight">any</span> of those items (widen the filter). Select items from a different menu to narrow the filter. Click on the blue links that you'll see after you've chosen a filter to remove that filter.</li>
        <li><span class="subheading">Searching:</span> Type words in the search box to show only tasks containing all of those words. This is <span class="highlight">not</span> just for task titles; you can search on any field. The words do not have to be consecutive. Examples:<ul><li>Search for "car wash" to find the task "wash the car"</li><li>Search for "balloon habit" to find all habits that contain the word "balloon".</li><li>Search for "14-01-30" (or "2014-01-30" or "01-30") to find tasks created on that day.</li></ul></li>
        <li><span class="subheading">What dark magic is this?</span> <a href="http://datatables.net/">Data Tables</a> (a plug-in for jQuery, which adds advanced interaction controls to any HTML table). <a href="http://www.datatables.net/extras/thirdparty/ColumnFilterWidgets/DataTables/extras/ColumnFilterWidgets/">ColumnFilterWidgets</a> (an add-on for DataTables, which creates filtering widgets based on the data in table columns).</li>
        </ul>
        <div class="taskOverviewExplanationToggle closer"><a href="">hide explanation</a></div>
        </div>
        <table id="taskOverviewTable" class="output"></table>
    </div>

    <div class="tocSection longContent" id="habitHistorySection">
        <h2>Habit History</h2>
        <p class="narrowContent">This shows your habits and <strong>some</strong> of the dates and times you clicked on them; there is <a href="https://github.com/HabitRPG/habitrpg/issues/3079">an issue</a> which prevents HabitRPG from showing all of your clicks.
<!-- IF THE ISSUE GOES AWAY: ... and the dates and times they were marked <span class="buttonUsed">up</span> (+ button) or <span class="buttonUsed">down</span> (- button). It does not include any archived history data that might have been saved for your account, so it contains only recent data. For up-and-down habits (where both + and - are active), most of the data points are marked with <span class="buttonUsed">up</span> or <span class="buttonUsed">down</span>, but for the oldest data point, it is not possible to tell whether + or - had been hit. -->
Habits with no history are highlighted in bold, in case you would like to consider them for greater focus.
</p>
        <ul class="output"></ul>
    </div>

    <div class="tocSection" id="missingEquipmentSection">
        <div class="output gearList"></div>
    </div>

    <div class="tocSection" id="currentGearSection">
        <h2>Current Appearance and Gear</h2>
        <div class="output gearList selfClear"></div>
    </div>

    <div class="tocSection" id="dropsTodaySection">
        <h2>Drops Received Today</h2>
        <p class="output"></p>
    </div>

    <div class="tocSection" id="questProgressSection">
        <h2>Quest Progress</h2>
        <p class="output"></p>
        <!-- hopefully everything's clear enough that this won't be needed:
        <p class="narrowContent explanation">This shows an estimate of
        the progress that you yourself have made so far today
        (not on previous days) towards the quest that your party is on.
        It does not include progress from other people in your party
        (it is not possible to show you data for other people).</p>
        -->
    </div>

    <div class="tocSection" id="damageDailiesSection">
        <h2>Damage from Dailies</h2>
        <p class="lowlight">Be cautious about using this to prevent death! &nbsp; <span class="damageDailiesExplanationToggle"><a href="">show explanation</a></span></p>
        <ul class="longExplanation">
        <li>These estimates have been accurate during testing but your usage of HabitRPG might involve factors that were not considered, and so this information can't be guaranteed to be correct.</li>
        <li>If your health is low, it is wise to protect yourself from death even if these estimates indicate that you won't die.</li>
        <li>If you have not logged in to HabitRPG for more than a day, the damage that you (and your fellow quest participants) will take will be <span class="highlight">much greater</span> than shown here.</li>
        <li class="damageDailiesExplanationToggle lowlight" style="list-style-type: none; padding: 8px 0 20px 0"><a href="">hide explanation</a></li>
        </ul>
        <div class="output"></div>
    </div>

    <div class="tocSection" id="dailiesIncompleteSection">
        <h2>Dailies Incomplete</h2>
        <div class="output"></div>
    </div>

    <div class="tocSection longContent" id="untaggedTasksSection">
        <h2>Tasks Untagged</h2>
        <div class="output"></div>
    </div>

    <div id="tocClose" class="closer hide"><a href="">close / back to top</a></div>
</div>


<div id="introduction" class="showOnlyIfHave_Not_FetchedData">
   <p>This page shows you certain information from your <a href="https://habitrpg.com/">HabitRPG</a> account. You can read the full list below, or just enter your details and try it out.</p>
</div>

<iframe src="null.htm" id="formPasswdSaveFix" name="formPasswdSaveFix" style="display:none"></iframe><!-- DAMN YOU CHROME!! DAMN YOU!!!! http://stackoverflow.com/a/9116737 -->
<form  id="userApiDetailsForm" method="POST" action="" class="showOnlyIfHave_Not_FetchedData" target="formPasswdSaveFix">
    <fieldset>
        <legend><span class="highlight">Enter your HabitRPG API details</span>
        (from the <a href="https://habitrpg.com/#/options/settings/api">Settings
         -&gt; API page</a>)
        </legend>
        <label for="userId"><span>User ID</span>
            <input type="text" name="userId" id="userId" />
        </label>
        <label for="apiToken"><span>API Token</span>
            <input type="password" name="apiToken" id="apiToken" />
        </label>
        <input type="submit" value="Fetch My Data">
        <p class="highlight">Privacy and security notes:</p>
        <ul>
        <li>Your API Token is a password - do not share it with anyone,
        not even the maintainer of this page if you are seeking help.</li>
        <li>When you enter your User ID and API Token here and click
        "Fetch My Data", your ID and Token are sent to HabitRPG's servers.
        They are not sent anywhere else.
        To confirm that, you can ask someone who knows the JavaScript
        programming language to examine the source of this page.</li>
        <li>This page does not save your User ID and API Token to any
        location, but your browser might, if it has been configured to
        save form and password information. If you are using this page
        on a shared computer, you should clear any data that the browser
        has saved.</li>
        <li>You cannot damage your HabitRPG account in any way by using
        this page. It fetches data from HabitRPG's servers but it
        does not make any other kind of request. Your account will not be
        changed by this.</li>
        <li>You cannot view anyone else's data by using this page.<!-- XXX_LATER:  add this if more party code is put in (and improve wording): "except the most basic details (e.g., name) that you can already see on the party page" --></li>
        </ul>
    </fieldset>
</form>



<div id="outroduction" class="showOnlyIfHave_Not_FetchedData">
   <h2>What's On This Page?</h2>
   <ul>
        <li><span class="subheading">Unallocated Points</span>: If you have any <a href="http://habitrpg.wikia.com/wiki/Character_Attributes">unallocated points</a>, you'll see how many and a link to the HabitRPG <a href="https://habitrpg.com/#/options/profile/stats">Profile -&gt; Stats page</a> so you can allocate them.</li>
        <li><span class="subheading">Habit History</span>: This shows some of the dates and times you recently clicked on your habits. But note the disclaimer you'll see at the top of the list! Most of your clicks can not be shown.</li>
        <li><span class="subheading">Task Overview</span>: A table listing your habits, dailies, and to-dos, with their <a href="http://habitrpg.wikia.com/wiki/Advanced_Options">attributes</a> and <a href="http://habitrpg.wikia.com/wiki/Task_Value">colours, values, and magnitudes</a> (value and magnitude are useful for choosing tasks to cast skills on). Completed to-dos are not shown; completed dailies are.</li>
        <li><span class="subheading">Dailies Incomplete</span>: A lists of dailies scheduled for today that you have not yet completed. It also has a separate list of <a href="http://habitrpg.wikia.com/wiki/Dailies#Grey_Dailies">grey dailies</a> that have not been completed (you don't need to do those today, but you might want to for extra rewards).</li>
        <li><span class="subheading">Tasks Untagged</span>: If you have any habits, dailies, to-dos, or rewards that have not been <a href="http://habitrpg.wikia.com/wiki/Tags">tagged</a> they will be listed. This will be useful to you only if you prefer to tag all your tasks and are looking for any you have missed.</li>
        <li><span class="subheading">Damage from Dailies</span>: This <span class="highlight">estimates</span> the amount of damage you will take at the end of the day if you do not complete any more dailies today. It includes additional damage from a <a href="http://habitrpg.wikia.com/wiki/Quests">quest</a> <a href="http://habitrpg.wikia.com/wiki/Boss">boss</a>. Be cautious about relying on these estimates if you are low on health! Please read the warning in that section (click its "show explanation" link).</li>
        <li><span class="subheading">Drops Received Today</span>: The number of <a href="http://habitrpg.wikia.com/wiki/Drops">drops</a> you have received so far today will be shown.</li>
        <li><span class="subheading">Quest Progress</span>: If you are on a boss or collection <a href="http://habitrpg.wikia.com/wiki/Quests">quest</a>, you'll see an estimate of how much progress you have made so far today.</li>
        <li><span class="subheading">Missing Equipment</span>: If you have <a href="http://habitrpg.wikia.com/wiki/Death_Mechanics">died</a> and lost equipment, that equipment will be listed, along with the class that it belongs to. This is to help you buy it back, if you choose to do so.</li>
        <li><span class="subheading">Current Appearance and Gear</span>: This lists the <a href="http://habitrpg.wikia.com/wiki/Equipment">equipment</a> you are wearing (battle gear and costume), your <a href="http://habitrpg.wikia.com/wiki/Profile#Avatar">avatar's appearance settings</a> (skin colour, hair, etc), and your <a href="http://habitrpg.wikia.com/wiki/Pets">pet</a> and <a href="http://habitrpg.wikia.com/wiki/Mounts">mount</a>. This lets you easily record an appearance that you especially like or a set of battle gear that gives you useful stats (e.g., you could copy and paste this section to a text file).</li>
   </ul>
<p>Those items will not be shown if they are not relevant to your account (e.g., if you have no untagged tasks, you will not see the untagged tasks section).</p>

   <h2>Possible Future Features</h2><!-- XXX_SOON look into this -->
   <ul>
        <li><span class="subheading">Recommended Equipment for Maximising Stats</span>: Some kind of tool (possibly similar to the wiki's <a href="http://habitrpg.wikia.com/wiki/Equipment_Table">Equipment Table</a>) that helps you choose the best items from the gear you own for maximising specific stats.</li>
        <li><span class="subheading">Task Counts</span>: Total number of each of your habits, dailies, to-dos, and rewards. Why? Just because. You can boast to your friends about how busy and successful you are. (You can get some of this data now by filtering in the Task Overview section.)</li>
        <li><span class="subheading">Task Attributes Percentages</span>: percentage of tasks assigned to each of CON, INT, PER, STR (<a href="http://habitrpg.wikia.com/wiki/Advanced_Options#Attributes">wiki</a> <a href="http://habitrpg.wikia.com/wiki/Automatic_Allocation">links</a>)</li>
        <li><em>Maybe:</em> <span class="subheading">Pie Charts</span>: <a href="http://habitrpg.wikia.com/wiki/Thread:11457">join the discussion</a></li>
        <li><em>Maybe:</em> <span class="subheading">Support for Emoji</span>: Currently, your tasks on this page look ugly if you use <a href="http://habitrpg.wikia.com/wiki/Emoji">emoji</a> - I apologise. I use many of them, so I know it's a bit nasty to read them here. However whether and when I implement this depends on how easy it is.</li>
        <li><em>Maybe:</em> <span class="subheading">Support for Markdown</span>: <a href="http://habitrpg.wikia.com/wiki/Markdown_Cheat_Sheet">Markdown</a> also looks bad, but support for it might not be easy to implement. Apologies again.</li>
        <li><em>Maybe:</em> <span class="subheading">Missing Equipment for Orb of Rebirthers</span>: do something to make the feature more useful for them.</li>
        <li><span class="subheading">Other Stuff?</span>: Send me ideas! Contact details are below.</li>
   </ul>

   <h2>Suspected Bugs</h2><!-- XXX_SOON look into this -->
   <p>This page will not work correctly on old browsers because it uses modern website features and relies on compliance to standards (both can be lacking in old browsers). <a href="http://browsehappy.com/">Updating your browser is important for general safety on the internet!</a> If you have upgraded your browser to the latest version and are still having problems, please tell me! Contact details are below.</p>
   <p>Regardless of what bugs there might be, this page cannot damage your account. It does not contain any code that could result in any changes being made on HabitRPG.</p>

   <h2>Help and Contact Details</h2>
   <p>This page has been created by <a href="http://habitrpg.wikia.com/wiki/User:LadyAlys">Alys</a> (a.k.a. Alice Harris). If you have questions, problems, or suggestions, you're welcome to contact me, although I cannot guarantee that I'll always be able to spend a lot of time on this. Email to <a href="mailto:lady_alys@oldgods.net">lady_alys@oldgods.net</a> is the best way to reach me, or you can comment on <a href="http://habitrpg.wikia.com/wiki/User_blog:LadyAlys/HabitRPG_Unofficial_User_Data_Display">this wiki blog post</a>.</p>

    <p>If you have general questions about HabitRPG, post them to <a href="https://habitrpg.com/#/options/groups/tavern">Tavern Talk</a> or <a href="http://habitrpg.wikia.com/wiki/Board:The_Quarters_-_Q_%26_A">The Quarters - Q & A board</a>.</p>
</div>

<div id="end">
    <a class="explanationToggle showOnlyIfHave_Not_FetchedData
              separator closer hide" href="">hide
                    documentation and Fetch My Data form</a>
</div>

</div></body>
</html>
