<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Habitica Task Tagger Tool</title>
    <base target="_blank">

<!--

This code is licenced under the same terms as Habitica:
    https://raw.githubusercontent.com/HabitRPG/habitrpg/develop/LICENSE

https://github.com/Alys/tools-for-habitrpg/blob/master/habitrpg_tagger.html

https://oldgods.net/habitrpg/habitica_tagger.html

Contributors:
    Alys (Alice Harris), lady_alys@oldgods.net https://github.com/Alys


-->


    <meta name="description" content="Habitica Task Tagger Tool" />
    <meta name="author" content="Alys (Alice Harris) lady_alys@oldgods.net" />

<!-- XXX purge below to script tag -->

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
	<script type="text/javascript" src="/fixed-table-rows-cols-master/js/fixed_table_rc.js"></script>
	<script type="text/javascript" src="/js/sorttable.js"></script>
	<link rel="stylesheet" type="text/css" href="/fixed-table-rows-cols-master/css/fixed_table_rc.css" />


    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/0.3.2/marked.min.js"></script> <!-- https://github.com/chjj/marked -->
    <script src="js/emoji-images/emoji-images.js"></script>

    <!-- TST - FOR TESTING
    For more information on using jquery-mockjax for simulating ajax requests, see https://github.com/jakerella/jquery-mockjax
    --><!--
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-mockjax/1.5.3/jquery.mockjax.min.js" type="text/javascript"></script>
    <script src="testdata/content.js" type="text/javascript"></script>
    <script src="testdata/habits-many.js" type="text/javascript"></script>
    <script src="testdata/habits-very-many.js" type="text/javascript"></script>
    <script src="testdata/tavern.js" type="text/javascript"></script>
    <script src="testdata/user.js" type="text/javascript"></script>
    -->


<script type="text/javascript">
$(function() { // wraps around all our code to not pollute global namespace

//////////////////////////////////////////////////////////////////////
////   Global Variables                              /////////////////
//////////////////////////////////////////////////////////////////////
var content; // holds site-wide content (gear names and stats, quests, etc)
var tavern;  // holds tavern data
var party;   // holds party data
var user;    // holds user's data


//////////////////////////////////////////////////////////////////////
////   Global Connection Variables      //////////////////////////////
//////////////////////////////////////////////////////////////////////
var serverName        = 'Habitica'; // used in "loading" message
var serverUrl         = 'https://habitica.com:443/api/v2';
var serverPathContent = '/content?language=en';
var serverPathTavern  = '/groups/habitrpg';
var serverPathParty   = '/groups/party';
var serverPathUser    = '/user';
var userId            = '';
var apiToken          = '';

/* TST - FOR TESTING:
// Use this section if you do not have a local webserver and want to use the provided test data.
// You can compose test data by doing things like:
//     var userJson = JSON.parse(userJsonString);
//     var habitsVeryManyJson = JSON.parse(habitsVeryManyJsonString);
//     userJson.habits = habitsVeryManyJson;
//     userJsonString = JSON.stringify(userJson);
$.mockjax({
  url: serverUrl + serverPathContent,
  dataType: 'json',
  responseText: contentJsonString,
});
$.mockjax({
  url: serverUrl + serverPathTavern,
  dataType: 'json',
  responseText: tavernJsonString,
});
$.mockjax({
  url: serverUrl + serverPathParty,
  dataType: 'json',
  responseText: partyJsonString,
});
$.mockjax({
  url: serverUrl + serverPathUser,
  dataType: 'json',
  responseText: userJsonString,
});
*/

// Use this section if you have a local webserver set up to handle the requests.
serverName        = 'localhost';
serverUrl         = 'http://localhost';
serverPathTavern  = '/cgi-bin/hrpg_tavern.pl';
serverPathParty   = '/cgi-bin/hrpg_party.pl';
serverPathContent = '/cgi-bin/hrpg_content.pl';
serverPathUser    = '/cgi-bin/hrpg_user.pl';
apiToken          = 'null';
userId            = 'test';
userId            = 'work';
userId            = 'home';
/* TST - FOR TESTING:
*/

$('body').css({'background-color':'#C4B4A4'});
$('#userApiDetailsForm #userId').val(userId);
$('#userApiDetailsForm #apiToken').val(apiToken);
fetchData();
/* TST - FOR TESTING:
*/

var sectionOpen = ''; // holds the ID attribute of a section of the page;
                      // persists through re-fetch of data so we can
                      // reopen that section when the new data arrives
var hideDropsInDashboard = true; // changes to false as soon as the user
                                 // looks at the drops section, then remains
                                 // false through all future re-fetches
var tellMe = '<a href="mailto:lady_alys@oldgods.net">tell me</a>';


//////////////////////////////////////////////////////////////////////
////   Allow Show/Hide Toggling to work    ///////////////////////////
//////////////////////////////////////////////////////////////////////
enableShowHideToggling(); // needed here to enable Version Changes link
function enableShowHideToggling() {
    // $('.showHideToggle').click(function(event)
    $('body').on('click', '.showHideToggle', function(event){
        var target = $(this).data("target");
        var wantToShow = (! $('#' + target).is(':visible')
                       || $(this).data("forceopen"));
            // wantToShow is false if the target is already open
            // (i.e., the user wants to close it)
            // unless the toggle's attributes force it to always be
            // opened (e.g., a link from the dashboard)
        var linktext = $(this).data("linktext") || false;
        if ($(this).data("closemainsections")) {
            $('#MAIN > *').hide();
        }
        if (wantToShow) {
            sectionOpen = target;
            $('#' + target).show();
            if (linktext) {
                $(this).text('hide ' + linktext);
            }
        }
        else {
            $('#' + target).hide();
            if (linktext) {
                $(this).text('show ' + linktext);
            }
            if ($(this).data("scrolltotop")) {
                window.scrollTo(0, 0);
            }
        }
        var toggleTarget = $(this).data("resettoggletext") || false;
        if (toggleTarget) {
            $('#' + toggleTarget).text('show '
                        + $('#' + toggleTarget).data("linktext"));
        }
    });
    $('body').on('click', '.mainSectionClose', function(event){
        $('#MAIN > *').hide();
        window.scrollTo(0, 0);
    });
}


//////////////////////////////////////////////////////////////////////
////   Get UUID from URL      ////////////////////////////////////////
//////////////////////////////////////////////////////////////////////
var url_vars = getUrlVars();
if (url_vars.uuid) {
    $("#userId").val(url_vars.uuid);
}
function getUrlVars() {
    // Function found at http://stackoverflow.com/questions/4656843/jquery-get-querystring-from-url#answer-4656873
    var vars = [], hash;
    var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
    for(var i = 0; i < hashes.length; i++)
    {
        hash = hashes[i].split('=');
        vars.push(hash[0]);
        vars[hash[0]] = hash[1];
    }
    return vars;
}


//////////////////////////////////////////////////////////////////////
////   Login events      /////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////
$('#userApiDetailsForm').submit(function(event){
    /* The user manually submitted the API connection form. */
    userId   = $('#userId').val();
    apiToken = $('#apiToken').val();
    fetchData();
});


//////////////////////////////////////////////////////////////////////
////   Login and Data Fetch Functions   //////////////////////////////
//////////////////////////////////////////////////////////////////////
function fetchData() {
    if (userId == '3e595299-3d8a-4a10-bfe0-88f555e4aa0c' || // AliceHarris
        userId == 'e7b5d1e2-3b6e-4192-b867-8bafdb03eeec'    // Ryan
    ) {
        $('#specialMessage').show();
    }
    else {
        $('#specialMessage').hide();
    }
    $('#loading #serverName').text(serverName);
    $('#loading .good').show();
    $('#loading .bad' ).hide();

    var ajaxRunningCount = 4; // drops to 0 when all calls have succeeded

    // fetch the user's own content (tasks, gear owned, etc):
    $.ajax({
        url: serverUrl + serverPathUser,
        type: 'GET',
        dataType: 'json',
        cache: false,
        beforeSend: function(xhr){
                xhr.setRequestHeader('x-api-user', userId);
                xhr.setRequestHeader('x-api-key',  apiToken);
            },
        success: fetchUserSuccess,
        error: fetchFailure
    });

    // fetch the site-wide content (gear names and stats, etc):
    $.ajax({
        url: serverUrl + serverPathContent,
        type: 'GET',
        dataType: 'json',
        cache: true,
        success: fetchContentSuccess,
        error: fetchFailure
    });

    // fetch tavern-specific content
    $.ajax({
        url: serverUrl + serverPathTavern,
        type: 'GET',
        dataType: 'json',
        cache: false,
        beforeSend: function(xhr){
                xhr.setRequestHeader('x-api-user', userId);
                xhr.setRequestHeader('x-api-key',  apiToken);
            },
        success: fetchTavernSuccess,
        error: fetchFailure,
    });

    // fetch party-specific content
    $.ajax({
        url: serverUrl + serverPathParty,
        type: 'GET',
        dataType: 'json',
        cache: false,
        beforeSend: function(xhr){
                xhr.setRequestHeader('x-api-user', userId);
                xhr.setRequestHeader('x-api-key',  apiToken);
            },
        success: fetchPartySuccess,
        error: fetchFailure,
    });


    function fetchFailure() {
        $('#loading .good').hide();
        $('#loading .bad' ).show();
        $('#documentationAndForm').show(); // in case user has done a re-fetch
        $('#documentationAndFormClose').hide();
    }
    function fetchContentSuccess(data) {
        content = data;
        ajaxRunningCount--;
        if (ajaxRunningCount === 0) { // all ajax calls have finished
            parseData();
        }
    }
    function fetchTavernSuccess(data) {
        tavern = data;
        ajaxRunningCount--;
        if (ajaxRunningCount === 0) { // all ajax calls have finished
            parseData();
        }
    }
    function fetchPartySuccess(data) {
        party = data;
        ajaxRunningCount--;
        if (ajaxRunningCount === 0) { // all ajax calls have finished
            parseData();
        }
    }
    function fetchUserSuccess(data) {
        user = data;
        ajaxRunningCount--;
        if (ajaxRunningCount === 0) { // all ajax calls have finished
            parseData();
        }
    }
}
function parseData() {
    // variables for storing the content:
    var MAIN = {}; // each element defines the HTML for one section on the page

    // save the fetch time early:
    var fetchtime = myDateConverter(new Date(), 'pretty');

    // extract some commonly-used data:
    var sleeping = user.preferences.sleep; // true if resting in the inn
    var userKlass = user.stats.class;
    var health = '';
    var quest = $.extend({}, user.party.quest);
    // user.party.quest.key='vice3'; party.quest.active=true; // FOR TESTING
    if (user.party.quest.key && party.quest && party.quest.active) {
        quest = $.extend({}, user.party.quest);
        quest.content = $.extend({}, content.quests[ party.quest.key ] );
    }
    var customDayStart = user.preferences.dayStart || 0; // CDS
    var timezoneOffset = user.preferences.timezoneOffset || 0;

    var tavernBoss = tavern.quest && tavern.quest.active; // true/false

    var bossesLabel = '';
    var bossesWord  = 'boss';
    if (quest.content && quest.content.boss) {
        bossesLabel = 'your quest boss';
        if (tavernBoss) {
            bossesLabel += ' and ';
            bossesWord  += 'es';
        }
    }
    if (tavernBoss) {
        bossesLabel += 'the World boss';
    }

    // put the user's equipped battle gear into an object, with all
    // details about each piece:
    var equippedKeys = {};
    for (var i in user.items.gear.equipped) {
        var key = user.items.gear.equipped[i];
        equippedKeys[key] = content.gear.flat[key];
    }

    var userIsOnCollectionQuest = false;

    // When calculating drop chance for a task, some of the user's stats
    // are used. We calculate those parts of the drop chance here since
    // they'll be identical for all tasks:
    var userStatsDropChance =
        (1 + ( (user.contributor.level     || 0) / 40 )) *
        (1 + ( (user.achievements.rebirths || 0) / 20 )) *
        (1 + ( (user.achievements.streak   || 0) / 200));

    userDataInHeader();


    // create the content, section by section:
    //
    // TO ADD NEW SECTION: add a function here, OR add it within one of the
    // functions that is already here if appropriate for correct scoping
    // (e.g., features related to tasks should have their function put
    // inside collateAndDisplayTaskData):
    collateAndDisplayTaskData();



    //////////////////////////////////////////////////////////////////////
    ////   Display the HTML that the functions have created   ////////////
    //////////////////////////////////////////////////////////////////////
    $('#loading .good').hide();
    $('#documentationAndFormClose').show();
    $('#documentationAndForm').hide();
    formatAndDisplayMAIN();

    // everything below here is functions used within this function


function formatAndDisplayMAIN() {
    // TO ADD NEW SECTION: To make your new section appear on the page,
    // add the unique identifier for the new section to this array (the array
    // elements are in the order that the sections would appear on the page
    // if they were all visible at once):
    var keys = ['taskOverview'];
    var html = '';
    var functions = []; // functions to run after HTML code has been loaded
    for (var i=0,ic=keys.length; i<ic; i++) {
        var data = MAIN[keys[i]];
        if (! data) {
            continue;
        }
        html += '<div id="' +
                data.id     + '"><h2>' +
                data.title  + '</h2>' +
                data.html   +
                ((data.longContent) ? '<div class="mainSectionClose closer">' +
                                      'close / back to top</div>' : '') +
                '</div>';
        if (data['function']) {
            functions.push(data['function']);
        }
    }
    $('#MAIN').html(html);
    // execute any functions that need to be run AFTER the bulk of the
    // HTML has been created:
    $.each(functions, function(index,fn){
        fn();
    });
    if (sectionOpen && sectionOpen != 'documentationAndForm'
                    && sectionOpen != 'versionChanges'
    ) {
        // reopen the section that the user had open before re-fetching
        // data (except for sections that don't display the user's own data):
        $('#' + sectionOpen).show();
    }
		
   $(document).ready(function() {
	$("#taggerTable").fxdHdrCol({
		fixedCols:  1,
		width:     "100%",
		height:    400,
		colModal: [
			   { width: 50, align: "center" },
			   { width: 110, align: "center" },
			   { width: 170, align: "left" },
			   { width: 250, align: "left" },
			   { width: 100, align: "left" },
			   { width: 70, align: "left" },
			   { width: 100, align: "left" },
			   { width: 100, align: "center" },
			   { width: 90, align: "left" },
			   { width: 400, align: "left" },
			   { width: 50, align: "center" },
			   { width: 50, align: "center" },
			   { width: 50, align: "center" },
			   { width: 50, align: "center" },
			   { width: 50, align: "center" },
			   { width: 110, align: "center" },
			   { width: 170, align: "left" },
			   { width: 250, align: "left" },
			   { width: 100, align: "left" },
			   { width: 70, align: "left" },
			   { width: 100, align: "left" },
			   { width: 100, align: "center" },
			   { width: 90, align: "left" },
			   { width: 400, align: "left" },
			   { width: 400, align: "left" },
		],
		sort: true
	});
   });
}


function myDateConverter(date, style) { // XXX_SOON replace with moment
    if (typeof date === 'string' || typeof date === 'number') {
        date = new Date(date);
    }
    if (!date || isNaN(date.getTime())) {
        // Either the object that was passed in is not a Date object,
        // OR the date string that was passed in could not be converted
        // to a Date object, presumably because it's in a non-standard
        // format. We handle this by using today's date. It's a nasty
        // hack, but it's unlikely to occur, and no one's paying for
        // anything better.
        date = new Date();
    }

    if (style === 'pretty') {
        // Format date as (weekday date month) and hh:mm:ss;
        // toDateString ordering might be locale-specific
        // var dateStr = date.toDateString().split(' ').slice(0,3).join(' ') +
        // ' ' + date.toTimeString().split(' ')[0];
        var dateStr = date.toLocaleString(undefined,
            { weekday: 'long', day: 'numeric', month: 'long',
              hour: '2-digit', minute: '2-digit' });
    }
    else {
        var y = date.getFullYear();
        var m = date.getMonth() + 1;
        var d = date.getDate();
        var H = date.getHours();
        var M = date.getMinutes();
        var S = date.getSeconds();
        var dateStr = y +
               '-' + (m<=9 ? '0'+m : m) +
               '-' + (d<=9 ? '0'+d : d);
        if (style === 'short') {
            dateStr = dateStr.replace(/^20/, ""); // remove century
        }
        if (style === 'long') {
            dateStr += ' ' + (H<=9 ? '0'+H : H) +
                       ':' + (M<=9 ? '0'+M : M) +
                       ':' + (S<=9 ? '0'+S : S);
        }
    }
    return dateStr;
}


function wiki(wikilink, pipelink) {
    // http://stackoverflow.com/a/1145525
    var wiki_link = wikilink.split(' ').join('_');
    return '<a href="http://habitica.wikia.com/wiki/' + wiki_link + '">' +
        ((typeof pipelink === "undefined") ? wikilink : pipelink) +
        '</a>';
}


function pluralise(word, number) {
    var lcWord = word.toLowerCase();
    var needUpperCase = (lcWord == word) ? false : true;
    if (number != 1) {
        var pluralWords = {
            'has':   'have',
            'it':    'them',
            'this':  'these',
            'is':    'are',
            'daily': 'dailies',
            'Daily': 'Dailies',
        };
        if   (pluralWords[lcWord]) { word = pluralWords[lcWord]; }
        else                       { word += 's';    }
    }
    if (needUpperCase) { // must improve this if ever need ALL upper case
        word = upperCaseFirst(word);
    }
    return word;
}


function upperCaseFirst(word) {
    return word.charAt(0).toUpperCase() + word.slice(1);
}

// This function decodes &nbsp; -> renders markdown -> escapes HTML entities -> and renders emoji
function renderFormattedText(text) {
    function renderMarkdown(text) {
        text = marked(text, {sanitize: true});
        text = String(text).replace(/^<p>|<\/p>\n$/g, ''); // The bonus paragraph around every text snippet is unnecessary
        return text;
    }

    function renderEmoji(text) {
        return emoji(text, 'js/emoji-images/pngs', 25);
    }

    return renderEmoji(
        renderMarkdown(
            String(text).replace(/\&nbsp;/g, ' ')
        )
    );
}

function userDataInHeader() {
    var displayName = renderFormattedText(user.profile.name);
    if (userId == '3e595299-3d8a-4a10-bfe0-88f555e4aa0c' || // AliceHarris
        userId == 'e7b5d1e2-3b6e-4192-b867-8bafdb03eeec'    // Ryan
    ) {
        // displayName = 'Slayer of Dailies... Eater of Toast';
        displayName = 'A valiant Github warrior';
    }
    $('#headerExtras').html('<div id="userNameDisplay">' +
            displayName +
            '</div>' +
            '<div id="explanationAndClearLinks">' +
            '<input id="refetch" type="submit" value="' +
            'Re-Fetch Data (last fetched ' + fetchtime + ')" />' +
            '<span id="documentationAndFormToggle" class="showHideToggle" data-target="documentationAndForm" data-linktext="documentation" data-closemainsections="true">show documentation</span>' +
            '</div>'
    );
    $('#refetch').click(function(event){
        /* The user clicked on the Re-Fetch My Data button. */
        fetchData();
    });
}


function collateAndDisplayTaskData() {
    // Set up data structures for storing task information:
    var taskOrder = 0; // default order of tasks in Habitica
    var allTasks = []; // except completed To-Dos
    var untaggedTasks = {'habits':[], 'dailies':[], 'todos':[], 'rewards':[]};
    var template = {'total':0, 'con':0, 'int':0, 'per':0, 'str':0};
    var countTasks = {
        'habits':          $.extend(true, {}, template),
        'dailiesDue':      $.extend(true, {}, template),
        'dailies':         $.extend(true, {}, template),
        'todosIncomplete': $.extend(true, {}, template),
        'todosComplete':   $.extend(true, {}, template),
        'todosAll':        $.extend(true, {}, template),
        'statsTotals':     $.extend(true, {}, template),
        'rewards':         {'total': 0}
    };
    var exampleTaskType  = '';    // Used to develop...
    var exampleAttribute = '';    // ... a useful customised example...
    var exampleFound     = false; // ... for the Task Statistics section.


    // Define some static stuff:
    var entityMap = {   "&": "&amp;",
                        "<": "&lt;",
                        ">": "&gt;",
                        '"': '&quot;',
                        "'": '&#39;',
                        "/": '&#x2F;'
                    };
    var colours = { 1: {'order':1, 'name':'Bright Blue',
                        'label':       '1) Bright Blue',
                        'nameNoSpace':    'BrightBlue',
                        'id':       'colourBrightBlue'
                       },
                    2: {'order':2, 'name':'Blue Grey',
                        'label':       '2) Blue Grey',
                        'nameNoSpace':    'BlueGrey',
                        'id':       'colourBlueGrey'
                       },
                    3: {'order':3, 'name':'Green',
                        'label':       '3) Green',
                        'nameNoSpace':    'Green',
                        'id':       'colourGreen'
                       },
                    4: {'order':4, 'name':'Yellow',
                        'label':       '4) Yellow',
                        'nameNoSpace':    'Yellow',
                        'id':       'colourYellow'
                       },
                    5: {'order':5, 'name':'Orange',
                        'label':       '5) Orange',
                        'nameNoSpace':    'Orange',
                        'id':       'colourOrange'
                       },
                    6: {'order':6, 'name':'Red',
                        'label':       '6) Red',
                        'nameNoSpace':    'Red',
                        'id':       'colourRed'
                       },
                    7: {'order':7, 'name':'Dark Red',
                        'label':       '8) Dark Red',
                        'nameNoSpace':    'DarkRed',
                        'id':       'colourDarkRed'
                       }
                  };


    // Get an array of all of the user's tags so that when we are
    // examining a task's tags, we can ignore any tags that don't appear
    // in that array (e.g., tags the user has deleted but that weren't
    // removed from the task).
    var knownTags = [];
    $.each(user.tags, function(index, obj){
        knownTags.push(obj.id);
    });

    var bluestTask   = {};
    var reddestTask  = {};
    var reddestHabit = {};
    var reddestDaily = {};
    var biggestTask  = {}; // task with greatest absolute magnitude
    var habits   = collateHabitsData();  // populates the...
    var dailies  = collateDailiesData(); // ... function's "global" variables...
    var todosAll = collateTodosData();   // ... defined above...
    var rewards  = collateRewardsData(); // ......
    var todos          = todosAll[0];
    var todosCompleted = todosAll[1];

    // TO ADD NEW SECTION: if the section is related specifically to tasks,
    // here is probably where you want to put its function.

    // display task data:
    taskOverview();

    function collateHabitsData() {
        var habits = [];
        $.each(user.habits, function(index, obj){
            modifyTaskProperties(obj);
            countTasks['habits']['total']++;
            countTasks['habits'][obj.attribute]++;
            countTasks['statsTotals'][obj.attribute]++;
            countTasks['statsTotals']['total']++;
            if (! exampleFound) {
                exampleTaskType  = 'habits';
                exampleAttribute = obj.attribute;
                if (obj.attribute != 'str') {
                    exampleFound = true; // We won't look for a better example
                    // later; we are happy with this one. We prefer to not use
                    // strength because a less-common attribute will probably
                    // provide a clearer example.
                }
            }
            habits.push(obj);
            allTasks.push(obj);
            if (! taskIsTagged(obj)) {
                untaggedTasks['habits'].push(obj);
            }

            if (typeof reddestHabit.value === "undefined" ||
                obj.value < reddestHabit.value) {
                reddestHabit = obj;
            }
            if (typeof reddestTask.value === "undefined" ||
                obj.value < reddestTask.value) {
                reddestTask = obj;
            }
            if (typeof bluestTask.value === "undefined" ||
                obj.value > bluestTask.value) {
                bluestTask = obj;
            }
            if (typeof biggestTask.value === "undefined" ||
                Math.abs(obj.value) > Math.abs(biggestTask.value)) {
                biggestTask = obj;
            }
        });
        return habits;
    }


    function collateDailiesData() {
        var dailies = [];
        var valueMin = -47.27; // task values are capped ...
        var valueMax =  21.27; // ... for some purposes
        var conBonus = 1;
        if (conBonus < 0.1) { conBonus = 0.1; }
        var stealth = user.stats.buffs.stealth; // user avoids Dailies' damage
        $.each(user.dailys, function(index, obj){
            modifyTaskProperties(obj);

            countTasks['dailies']['total']++;
            countTasks['dailies'][obj.attribute]++;
            countTasks['statsTotals'][obj.attribute]++;
            countTasks['statsTotals']['total']++;
            if (! exampleFound) {
                if (obj.attribute != 'str') {
                    exampleTaskType  = 'dailies';
                    exampleAttribute = obj.attribute;
                    exampleFound     = true;
                }
                else {
                    exampleTaskType  = exampleTaskType  || 'dailies';
                    exampleAttribute = exampleAttribute || obj.attribute;
                }
            }

            obj.orderDailies = countTasks['dailies']['total'];

            dailies.push(obj);
            allTasks.push(obj);
            if (! taskIsTagged(obj)) {
                untaggedTasks['dailies'].push(obj);
            }
            if (typeof reddestDaily.value === "undefined" ||
                obj.value < reddestDaily.value) {
                reddestDaily = obj;
            }
            if (typeof reddestTask.value === "undefined" ||
                obj.value < reddestTask.value) {
                reddestTask = obj;
            }
            if (typeof bluestTask.value === "undefined" ||
                obj.value > bluestTask.value) {
                bluestTask = obj;
            }
            if (typeof biggestTask.value === "undefined" ||
                Math.abs(obj.value) > Math.abs(biggestTask.value)) {
                biggestTask = obj;
            }
        });
        return dailies;

        function describeChecklist(task) {
            // Takes a task object. Returns an object describing aspects of the
            // task object's checklist (including whether it exists or not).
            if (! task.checklist || task.checklist.length == 0) {
                return {'exists': false};
            }
            var countDone = 0;
            $.each(task.checklist, function(index, obj){
                if (obj.completed == true) { countDone++; };
            });
            return {
                'exists': true,
                'proportionDone': (countDone / task.checklist.length),
                };
        }
    }


    function collateTodosData() {
        var todos = [];
        var todosCompleted = [];
        $.each(user.todos, function(index, obj){
            modifyTaskProperties(obj);
            if (obj.completed == true) {
                countTasks['todosComplete']['total']++;
                countTasks['todosComplete'][obj.attribute]++;
                countTasks['statsTotals'][obj.attribute]++;
                countTasks['statsTotals']['total']++;
                countTasks['todosAll']['total']++;
                countTasks['todosAll'][obj.attribute]++;
                todosCompleted.push(obj);
            }
            else {
                countTasks['todosIncomplete']['total']++;
                countTasks['todosIncomplete'][obj.attribute]++;
                countTasks['statsTotals'][obj.attribute]++;
                countTasks['statsTotals']['total']++;
                countTasks['todosAll']['total']++;
                countTasks['todosAll'][obj.attribute]++;
                if (! exampleFound) {
                    if (obj.attribute != 'str') {
                        exampleTaskType  = 'todosIncomplete';
                        exampleAttribute = obj.attribute;
                        exampleFound     = true;
                    }
                    else {
                        exampleTaskType  = exampleTaskType  ||'todosIncomplete';
                        exampleAttribute = exampleAttribute || obj.attribute;
                    }
                }
                todos.push(obj);
                allTasks.push(obj);
                if (! taskIsTagged(obj)) {
                    untaggedTasks['todos'].push(obj);
                }
            }
            if (obj.completed == false) {
                if (typeof reddestTask.value === "undefined" ||
                    obj.value < reddestTask.value) {
                    reddestTask = obj;
                }
                if (typeof bluestTask.value === "undefined" ||
                    obj.value > bluestTask.value) {
                    bluestTask = obj;
                }
                if (typeof biggestTask.value === "undefined" ||
                    Math.abs(obj.value) > Math.abs(biggestTask.value)) {
                    biggestTask = obj;
                }
            }
        });
        return [todos, todosCompleted];
    }


    function collateRewardsData() {
        var rewards = [];
        $.each(user.rewards, function(index, obj){
            modifyTaskProperties(obj);
            countTasks['rewards']['total']++;
            rewards.push(obj);
            if (! taskIsTagged(obj)) {
                untaggedTasks['rewards'].push(obj);
            }
        });
        return rewards;
    }


    function modifyTaskProperties(obj) {
        obj.text = renderFormattedText(obj.text);
        obj.notes = renderFormattedText(obj.notes);
        obj.attributePretty = obj.attribute.toUpperCase();
        obj.typePretty   = upperCaseFirst(
                (obj.type == 'todo') ? 'To-Do' : obj.type );
        obj.valueRounded = Math.round(obj.value * 100) / 100;
        obj.magnitude    = Math.abs(obj.valueRounded);
        obj.order        = ++taskOrder;
        obj.creation     = reformatDate(obj.dateCreated);
        obj.completion   = (obj.dateCompleted) ?
                           reformatDate(obj.dateCompleted) : {};
        obj.colour       = chooseColour(obj.value);
        obj.valueColourHtml = '<span class="coloured ' +
                              obj.colour.id + '">' +
                              obj.valueRounded + '<br />' +
                              obj.colour.nameNoSpace + '</span>';
        obj.difficulty = chooseDifficulty(obj.priority);
        obj.attributesHTML = '<div class="taskAttributes ' + obj.type + '">' +
                             attributesHTML() + '</div>';

        // calculate drop chance:
        if (obj.type === 'habit' && obj.up === false) {
            obj.dropChance = 0; // no drops from habits with + button disabled
        }
        else {
            var tempValue = Math.abs(obj.value - 21.27);
            if (tempValue > 37.5) tempValue = 37.5;
            var checklistChance = 0; //(_.reduce(obj.checklist, (function(m, i) {
                        // return m + (i.completed ? 1 : 0);
                      // }), 0) || 0); // XXX_SOON finish this
            var chance = tempValue / 150 + .02;
            chance *= obj.priority *
                      (1 + ((obj.streak || 0) / 100)) *
                      userStatsDropChance *
                      (1 + .5 * checklistChance);
            // var chanceBefore = Math.round(chance * 100); // TST
            obj.dropChance = Math.round(chance * 100) + '%';
                    // + ' (' + chanceBefore + ' %)'; // TST
            // drop chance is 0 for negative habits
        }

        function reformatDate(dateString) {
            var formattedDate = myDateConverter(dateString, 'long');
            var shortDate     = myDateConverter(dateString, 'short');
            return { 'dateAndTime': formattedDate,
                     'shortDate': shortDate };
        }

        function chooseColour(value) {
            // from http://habitica.wikia.com/wiki/Task_Value :
            // Bright Blue  Greater than 10
            // Blue Grey    Between 5 and 10
            // Green        Between 1 and 5
            // Yellow       Between -1 and 1
            // Orange       Between -10 and -1
            // Red          Between -20 and -10
            // Dark Red     Less than -20
            if      (value < -20){ return colours[7]; }
            else if (value < -10){ return colours[6]; }
            else if (value <  -1){ return colours[5]; }
            else if (value <   1){ return colours[4]; }
            else if (value <   5){ return colours[3]; }
            else if (value <  10){ return colours[2]; }
            else                 { return colours[1]; }
        }

        function chooseDifficulty(value) {
            if      (value == 0.1){ return 'trivial'; }
            else if (value == 1  ){ return 'easy'; }
            else if (value == 1.5){ return 'medium'; }
            else if (value == 2  ){ return 'hard'; }
            else                  { return 'unknown (' + value + ')'; }
        }

        function attributesHTML() {
            if (obj.type == 'habit') {
                return taskPartHTML(obj.up, '+') +
                       taskPartHTML(obj.down, '&ndash;');
            }
            else if (obj.type == 'todo') {
                return obj.date == null ?
                       '<span class="attributeOff">(no date)</span>' :
                       obj.date.substr(0, 10);
            }
            else {
                return '';
            }
        }

        function taskPartHTML(val, txt) {
            return ' <span class="' +
                   (val ? 'attributeOn' : 'attributeOff') + '">' +
                   txt + '</span>';
        }
    }


    function taskIsTagged(task) { // returns true if tagged, false otherwise. Also adds tags to task obj XXX improve description
        tagFound = false; // we have not yet found any valid tags for this task
        if (task.tags) {
            $.each(task.tags, function(tagId, value){
                if (value === false) {
                    // this tag was once applied to the task, but no longer
                    return true; // go to next iteration
                }
                if ($.inArray(tagId, knownTags) >= 0) {
                    tagFound = true;
                    return false; // break out of the loop
                }
            });
            task.knownTags = {};
            $.each(knownTags, function(tagId, value){
				if (task.tags.tagId) {
					task.knownTags[value] = true;
				}
				else {
					task.knownTags[value] = false;
				}
            });
        }
        return tagFound;
    }


    function taskOverview() { // Displays all tasks of all kinds.
        var title   = 'Task Overview';
        var id      = 'taskOverviewSection';
        var orderId =  'taskOverview';
		sectionOpen = id; // XXX_SOON make this unnecessary

		var tagTableHeaders = '';
		$.each(user.tags, function(index, tag){
			tagTableHeaders += '<th class="columnTag">'  +
							   renderFormattedText(tag.name) +
							   '</th>';
		});
		var table = '';
		table += '<div class="dwrapper">';
		table += '<table id="taggerTable" class="TSTdisplay">' + // XXX id, class needed?
				    '<thead><tr>' +
            			'<th class="columnTask">task</th>' +
            			'<th class="columnType">type</th>' +
						tagTableHeaders +
        			'</tr></thead><tbody>';

		$.each(allTasks, function(index, task){
			table += '<tr>' + 
						'<td class="columnTask">' + task.text + '</td>' +
						'<td class="columnType">' + task.type + '</td>';
			$.each(user.tags, function(index, tag){
				var tagName = renderFormattedText(tag.name); // XXX save elsewhere so don't have to run function each loop
				var checked = (task.tags[tag.id]) ? 'CHECKED' : '';
				var tdclass = (task.tags[tag.id]) ? 'tagOn' : 'tagOff';
				table += '<td class="columnTag ' + tdclass + '"><input type="checkbox"' + checked + ' />';
				table += tagName;
				table += '</td>';
			});
			table += '</tr>';
		});
		table += '</tbody><table>';
		table += '</div>';

        MAIN[orderId] = {'id': id, 'title': title, 'longContent': true,
                   'html':
'<div id="taskOverviewExplanationToggle" class="showHideToggle" data-target="taskOverviewExplanation" data-linktext="explanation">show explanation</div>' +
'<div id="taskOverviewExplanation" class="hide">' +
'   <p class="lowlight">NOTE: This feature contains advanced JavaScript and layout options which will probably perform differently in different browsers. If you experience problems, ' + tellMe + '.</p><p>The table below shows your tasks (Habits, Dailies, and To-Dos), with their ' + wiki('Advanced Options', 'attributes') + ' and ' + wiki('Task Value', 'colours, values, and magnitudes') + ' (value and magnitude are useful for choosing tasks to cast skills on). Completed To-Dos are not shown; completed Dailies are.</p><ul class="padded"><li><span class="subheading">Sorting:</span> Click on a column heading to sort the table by that column. Then, hold down your shift key and click on other column headings for a multi-column sort. The starting sort order is the order of your tasks in Habitica.</li><li><span class="subheading">Filtering:</span> Use the drop-down menus ("type", "attr.", "colour") to filter the list. Select multiple items from one menu to filter for tasks matching <span class="highlight">any</span> of those items (widen the filter). Select items from a different menu to narrow the filter. Click on the blue links that you\'ll see after you\'ve chosen a filter to remove that filter.</li><li><span class="subheading">Searching:</span> Type words in the search box to show only tasks containing all of those words. This is <span class="highlight">not</span> just for task titles; you can search on any field. The words do not have to be consecutive. Examples:<ul><li>Search for "car wash" to find the task "wash the car"</li><li>Search for "balloon habit" to find all Habits that contain the word "balloon".</li><li>Search for "14-01-30" (or "2014-01-30" or "01-30") to find tasks created on that day.</li></ul></li><li><span class="subheading">What dark magic is this?</span> <a href="http://datatables.net/">Data Tables</a> (a plug-in for jQuery, which adds advanced interaction controls to any HTML table). <a href="http://legacy.datatables.net/extras/thirdparty/ColumnFilterWidgets/DataTables/extras/ColumnFilterWidgets/">ColumnFilterWidgets</a> (an add-on for DataTables, which creates filtering widgets based on the data in table columns).</li></ul><p>Underneath this table, you will find one randomly-selected item from your To-Do list. Re-fetch your data to see a different random To-Do.</p>' +
'   <div class="showHideToggle closer" data-target="taskOverviewExplanation" data-resettoggletext="taskOverviewExplanationToggle">hide explanation</div>' +
'</div>' +
table
};
// XXX purge text above
    }
}

} // end of parseData() and its nested functions


});
</script>

<style>

/*********************************************************************
****   Page-wide   ***************************************************
*********************************************************************/
body {
    font-family: Helvetica, Arial, sans-serif;
    font-size: 14px;
    background-color: rgb(173, 208, 215);
}
#innerBody {
    margin: 20px;
    padding: 5px 20px 30px 20px;
    background-color: rgb(242, 242, 230);
}
#loading {
    margin-right: 30px;
    margin-left: 30px;
    color: orange;
    font-size: 1.5em;
    font-weight: bold;
}
#loading ul {
    font-size: 0.8em;
}
#loading ul a {
    color: orange;
}


.narrowContent {      /* The data should be as wide as the user's window   */
    max-width: 500px; /* but some explanatory paragraphs should be narrow. */
}


hr {
    width: 95%;
}
hr.padded {
    margin-top:    1em;
    margin-bottom: 2em;
}

.show {
    display: block;
}
.hide {
    display: none;
}
.clear {
    clear: both;
}

.subheading {
    font-weight: bold;
}
.highlight {
    font-weight: bold;
}
.lowlight { /* like highlight but less so */
    font-style: italic;
}
.explanation {
    font-style: italic;
}
abbr {
    border-bottom: 1px dashed black;
}
img.emoji {
    margin-bottom: -0.25em;
}
.forCopyPaste {
    /* used to add blank lines that we want when copying text to clipboard,
       but we don't want to see extra whitespace on the screen */
    margin-top: -1em;
}
ul.padded > li {
    padding: 3px 0;
}


.coloured {
    display: inline-block;
    width: 5.5em;
    height: 3em;
    padding-top: .7em;
}
.colourBrightBlue { background-color: rgb(209,226,248); }
.colourBlueGrey   { background-color: rgb(216,230,232); }
.colourGreen      { background-color: rgb(222,237,219); }
.colourYellow     { background-color: rgb(255,244,216); }
.colourOrange     { background-color: rgb(254,234,216); }
.colourRed        { background-color: rgb(250,214,214); }
.colourDarkRed    { background-color: rgb(240,197,190); }

.neutral {
    background-color: #fffbd0; /* yellow */
}
.danger {
    background-color: #ffcccc; /* red */
    /* background-color: #F5A9A9; */ /* darker red */
}
.safe {
    background-color: #bdd8fc; /* blue */
    /* green+red and green+yellow are not good for colour-blind people */
}


/*********************************************************************
****   Page-wide Show/Hide Toggling   ********************************
*********************************************************************/
.mainSectionClose,
.showHideToggle,     /* for toggling by id */
.showHideToggleClass /* for toggling by class */
{
    cursor: pointer;
    text-decoration: underline;
    color: purple;
}
.closer { /* as in "a thing that closes", not "nearer" */
    margin-top: 30px;
    padding-top: 15px;
    padding-bottom: 15px;
}
.closer:hover {
    border: 1px dashed lightgrey;
}
.developerData {
    font-family: monospace;
}


/*********************************************************************
****   Header   ******************************************************
*********************************************************************/
h1 {
    float: left;
}
h1>a:first-child { /* "Habitica" link in header */
    color: black;
    text-decoration: none;
}
h1>a:first-child:hover { /* "Habitica" link in header */
    text-decoration: underline;
}
h1 span {
    font-size: 0.5em;
}
h2 {
    margin-top: 30px;
}

#headerExtras .showHideToggle {
    white-space: nowrap;
}
#userNameDisplay {
    text-align: right;
    font-weight: bold;
    font-size: 2em;
    margin-bottom: 10px;
}

#explanationAndClearLinks {
    text-align: right;
}
#explanationAndClearLinks span {
    padding-left: 10px;
}


/*********************************************************************
****   Version History   *********************************************
*********************************************************************/

#versionChanges dl {
    margin-left: 30px;
}
#versionChanges dl dt {
    font-size: 1.15em;
    font-weight: bold;
}
#versionChanges dl dt .date {
    padding-left: 10px;
    font-size: 0.8em;
    font-weight: normal;
}
#versionChanges .showHideToggle {
    padding-bottom: 15px;
    margin-bottom: 10px;
}


/*********************************************************************
****   API Form and Documentation   **********************************
*********************************************************************/

#documentationAndForm > div {
    max-width: 700px;
}
#documentationAndForm #documentationAndFormClose {
    display: none;
    max-width: 100%;
}
#documentationAndForm div h2 {
    font-size: 1.3em;
}
#documentationAndForm li {
    margin-bottom: 10px;
}

#userApiDetailsForm {
    margin: 30px;
}
#userApiDetailsForm fieldset {
    max-width: 40em;
}
#userApiDetailsForm fieldset label,
#userApiDetailsForm fieldset input[type="submit"] {
    display: block;
    float: left;
    clear: left;
    margin: 10px 0;
}
#userApiDetailsForm fieldset label span {
    display: block;
    float: left;
    width: 6em;
}
#userApiDetailsForm fieldset label input {
    float: left;
    width: 30em;
}
#userApiDetailsForm fieldset p {
    clear: both;
}
#userApiDetailsForm legend .highlight {
    font-size: 1.3em;
}
#userApiDetailsForm fieldset li {
    margin-bottom: 7px;
}


/*********************************************************************
****   Specific Sections   *******************************************
*********************************************************************/
#MAIN > * {
    display: none; // all sections hidden by default
}


#taskOverviewSection .showHideToggle {
    margin-bottom: 1em;
}
#taskOverviewDeveloperDataToggle {
    float: right;
}
#taskOverviewSection table {
    TSTwidth: 100%;
    TSTtable-layout: fixed;
}
#taskOverviewSection table th,
#taskOverviewSection table td {
	border: 1px solid black;
	TSTdisplay: inline-block;
	TSTwhite-space: nowrap;
	TSTtext-overflow: ellipsis;
}
#taskOverviewSection table .columnTask {
	TSTdisplay: inline-block;
	TSTmax-width: 10em;
	TSTtext-overflow: ellipsis;
}
#taskOverviewSection table .columnType {
	padding-left:  0.5em;
	padding-right: 0.5em;
}
#taskOverviewSection table .columnTag {
	white-space:nowrap;
}
#taskOverviewSection table .columnTag.tagOn {
}
#taskOverviewSection table .columnTag.tagOff {
	opacity: 0.3;
}

/*
	#taskOverviewSection table .sorting_1,
	#taskOverviewSection table .sorting_2,
	#taskOverviewSection table .sorting_3,
	#taskOverviewSection table .even {
		background-color: #FAF9F9;
	}
	#taskOverviewSection table .odd  {
		background-color: #FEFEFF;
	}
	#taskOverviewSection input {
		width: 300px;
	}
	#taskOverviewSection table tr th:nth-child(3),
	#taskOverviewSection table tr td:nth-child(3) {
		max-width: 60px !important;
	}
	#taskOverviewSection h3 {
		margin-top: 3em;
	}
	#taskOverviewSection .taskAttributes {
		float: right;
	}
	#taskOverviewSection .taskAttributes .attributeOn {
		opacity: 1;
	}
	#taskOverviewSection .taskAttributes .attributeOff {
		opacity: 0.4;
	}
	#taskOverviewSection .taskAttributes.habit span,
	#taskOverviewSection .taskAttributes.daily span {
		border: solid 1px;
	}
	#taskOverviewSection .taskAttributes.habit span {
		padding: 0 4px;
	}
	#taskOverviewSection .taskAttributes.daily span {
		padding: 0 1px;
	}
*/


</style>
</head>
<body><div id="innerBody">

<h1><a href="https://habitica.com/">Habitica</a> Task Tagger Tool
    <span class="showHideToggle" data-target="versionChanges" data-closemainsections="true">(v0.01)</span></h1><!-- VERSION TOGGLE -->
<div id="headerExtras"></div>
<hr class="clear" />

<div id="loading">
    <div class="good hide">
        <p>Please wait. Fetching data from
        <span id="serverName">Habitica</span>...</p>
    </div>
    <div class="bad hide">
        <p>There was an error obtaining your data.</p>
        <ul class="padded">
            <li>Please reload the page and then check that your <a href="https://habitica.com/#/options/settings/api">User ID and API Token</a> are correct.</li>
            <li>If you're using Internet Explorer, try another browser. <a href="https://www.google.com/intl/en/chrome/browser/">Chrome</a> or <a href="https://www.mozilla.org/en-US/firefox/new/">Firefox</a> will be more reliable.</li>
            <li>If the page's URL starts with "http://" change it to start with "https://" (or just use <a href="https://oldgods.net/habitrpg/habitrpg_user_data_display.html">this correct link</a>).</li>
            <li>If neither of those help, contact me! See <strong>"Help and Contact Details"</strong> at the bottom of this page.</li>
        </ul>
    </div>
</div>

<div id="versionChanges" class="hide"><!-- VERSION SECTION -->
    <h2>Version History</h2>
    <dl>

        <dt>0.01 <span class="date">2015-08-15</span></dt>
        <dd><ul>
            <li>Features:
                <ul>
                    <li>First attempt.</li>
                </ul>
            </li>
            <li>Code:
                <ul>
                    <li>Yup, we have code.</li>
                </ul>
            </li>
            <li>Documentation:
                <ul>
                    <li>Nope.</li>
                </ul>
            </li>
        </ul></dd>
    </dl>
    <div class="showHideToggle closer" data-target="versionChanges" data-scrolltotop="true">close version history <span class="lowlight">(or click the version number again to close)</span></div>
    <hr />
</div><!-- end of div id="versionChanges" -->

<div id="MAIN"></div>


<div id="documentationAndForm">
   <!-- XXX purge below -->
   <p>This page shows you certain information from your <a
   href="https://habitica.com/">Habitica</a> account. You can read the
   full list below, or just enter your details and try it out.</p>

    <iframe src="null.htm" id="formPasswdSaveFix" name="formPasswdSaveFix" style="display:none"></iframe><!-- DAMN YOU CHROME!! DAMN YOU!!!! http://stackoverflow.com/a/9116737 -->
    <form id="userApiDetailsForm" method="POST" action="" target="formPasswdSaveFix">
        <fieldset>
            <legend><span class="highlight">Enter your Habitica API details</span>
            (from the <a href="https://habitica.com/#/options/settings/api">Settings
             -&gt; API page</a>)
            </legend>
            <label for="userId"><span>User ID</span>
                <input type="text" name="userId" id="userId" />
            </label>
            <label for="apiToken"><span>API Token</span>
                <input type="password" name="apiToken" id="apiToken" />
            </label>
            <input type="submit" value="Fetch My Data" />
            <p class="highlight">Privacy and security notes:</p>
            <ul>
            <li>If you access this page from the Data menu on the Habitica
            website, your User ID will be automatically added to the form
            above.</li>
            <li>Your API Token is a password - do not share it with anyone,
            not even the maintainer of this page if you are seeking help.</li>
            <li>When you enter your User ID and API Token here and click
            "Fetch My Data", your ID and Token are sent to Habitica's servers.
            They are not sent anywhere else.
            To confirm that, you can ask someone who knows the JavaScript
            programming language to examine the source of this page.</li>
            <li>This page does not save your User ID and API Token to any
            location, but your browser might, if it has been configured to
            save form and password information. If you are using this page
            on a shared computer, you should clear any data that the browser
            has saved.</li>
            <li>You cannot damage your Habitica account in any way by using
            this page. It fetches data from Habitica's servers but it
            does not make any other kind of request. Your account will not be
            changed by this.</li>
            <li>You cannot view anyone else's data by using this page.<!-- XXX_LATER:  add this if more party code is put in (and improve wording): "except the most basic details (e.g., name) that you can already see on the party page" --></li>
            <li>To clear your data, reload the page.</li>
            </ul>
        </fieldset>
    </form>


    <div>
       <h2>What's On This Page?</h2>
       <ul>
            <li><span class="subheading">Task Overview</span>: A table listing your Habits, Dailies, and To-Dos, with their <a href="http://habitica.wikia.com/wiki/Advanced_Options">attributes</a> and <a href="http://habitica.wikia.com/wiki/Task_Value">colours, values, and magnitudes</a> (value and magnitude are useful for choosing tasks to cast skills on). Completed To-Dos are not shown; completed Dailies are. At the bottom of this section, you will find one randomly-selected item from your To-Do list. Re-fetch your data to see a different random To-Do.</li>
            <li><span class="subheading">Task Statistics</span>: How many Habits, Dailies, To-Dos, and Rewards you have in total, and how many are assigned to each <a href="http://habitica.wikia.com/wiki/Advanced_Options">attribute</a>. If you have task-based <a href="http://habitica.wikia.com/wiki/Automatic_Allocation">auto-allocation</a> turned on, this section will also show your <span class="subheading">Training Points</span>.</li>
            <li><span class="subheading">Tasks Untagged</span>: If you have any Habits, Dailies, To-Dos, or Rewards that have not been <a href="http://habitica.wikia.com/wiki/Tags">tagged</a> they will be listed. This will be useful to you only if you prefer to tag all your tasks and are looking for any you have missed.</li>
            <li><span class="subheading">Habit Trends</span>: An interactive chart that provides a visual representation of the trends in your Habits. It gives you an idea of which Habits you are reinforcing, and which are being neglected.</li>
            <li><span class="subheading">Habit History</span>: This shows some of the dates and times you recently clicked on your Habits. But note the disclaimer you'll see at the top of the list! Most of your clicks can not be shown.</li>
            <li><span class="subheading">Dailies History</span>: A spreadsheet-like view showing the days on which you did and did not tick off your Dailies.</li>
            <li><span class="subheading">Dailies Incomplete</span>: A list of Dailies scheduled for today that you have not yet completed, and the estimated damage you will take from each one. It also has a separate list of <a href="http://habitica.wikia.com/wiki/Dailies#Grey_Dailies">Grey Dailies</a> that have not been completed (you don't need to do those today, but you might want to for extra rewards).</li>
            <li><span class="subheading">To-Dos with Dates</span>: A list of all To-Dos that have been given due dates, sorted by date. If there are any To-Dos due today or overdue, a red tile will appear in the dashboard to tell you how many there are.</li>
            <li><span class="subheading">To-Dos Completed</span>: A sortable, filterable table containing all of your completed To-Dos that Habitica has in its archive. The To-Dos' notes and completion dates are included.</li>
            <li><span class="subheading">Drops Received Today</span>: The number of <a href="http://habitica.wikia.com/wiki/Drops">drops</a> you have received so far today will be shown, along with your <a href="http://habitica.wikia.com/wiki/Drops#Drop-Cap">drop-cap</a>.</li>
            <li><span class="subheading">Quest Progress</span>: If you are on a boss or collection <a href="http://habitica.wikia.com/wiki/Quests">quest</a>, you'll see an estimate of how much progress you have made so far today, as well as the boss's HP (taken from your party's page, so this does not include any reduction from the damage you or other players have caused since the last time a party member's cron ran).</li>
            <li><span class="subheading">Damage from Dailies</span>: This <span class="highlight">estimates</span> the amount of damage you will take at the end of the day if you do not complete any more Dailies today. It includes additional damage from a <a href="http://habitica.wikia.com/wiki/Quests">quest</a> <a href="http://habitica.wikia.com/wiki/Boss">boss</a>. Be cautious about relying on these estimates if you are low on health! Please read the warning in that section (click its "show explanation" link).</li>
            <li><span class="subheading">Stats and Streaks Backup</span>: A plain-text view of information that you might need to <a href="http://habitica.wikia.com/wiki/Settings">restore your stats</a> and <a href="http://habitica.wikia.com/wiki/Streaks">your Dailies' streaks</a> if you die through no fault of your own. This information is available <span class="highlight">only before death</span>, so you might wish to copy the information every few days.</li>
            <li><span class="subheading">Missing Equipment</span>: If you have <a href="http://habitica.wikia.com/wiki/Death_Mechanics">died</a> and lost equipment, that equipment will be listed, along with the class that it belongs to. This is to help you buy it back, if you choose to do so.</li>
            <li><span class="subheading">Current Appearance and Gear</span>: This lists the <a href="http://habitica.wikia.com/wiki/Equipment">equipment</a> you are wearing (battle gear and costume), your <a href="http://habitica.wikia.com/wiki/Profile#Avatar">avatar's appearance settings</a> (skin colour, hair, etc), and your <a href="http://habitica.wikia.com/wiki/Pets">pet</a> and <a href="http://habitica.wikia.com/wiki/Mounts">mount</a>. This lets you easily record an appearance that you especially like or a set of battle gear that gives you useful stats (e.g., you could copy and paste this section to a text file).</li>
            <li><span class="subheading">Equipment Recommendations</span>: This displays your best equipment with features that help you choose the right gear for maximising specific attributes (for example, to maximise INT and CON before casting a healing spell).</li>
            <li><span class="subheading">Skills and Buffs</span>: A description of each of the spells for your class and the exact effect they will have if you cast them now. Also describes spells for other classes with estimates of their effects if you changed to that class while keeping similar character attributes.</li>
       </ul>
        <p>Those items will not be shown if they are not relevant to your account (e.g., if you have no untagged tasks, you will not see the untagged tasks section).</p>

       <h2>Possible Future Features</h2>
       <ul>
            <li>Display checklists and notes for tasks.</li>
            <li>For relevant Skills And Buffs, show how to increase the chance of a critical hit happening.</li>
            <li>Add percentages to Task Statistics.
<!--
<span class="subheading">Task Attributes Percentages</span>: percentage of tasks assigned to each of CON, INT, PER, STR (<a href="http://habitica.wikia.com/wiki/Advanced_Options#Attributes">wiki</a> <a href="http://habitica.wikia.com/wiki/Automatic_Allocation">links</a>)
-->
</li>
            <li>Hide information about drops for any players who have not yet had drops enabled.</li>
            <li>Show the potential damage you would do to a boss even when you are not on a quest (but don't display it in the dashboard). Would help people who are questioning whether or not they're ready for a boss fight.</li>
            <li>For Dailies History, improve the scrolling and the visibility and fixedness of the task names.</li>
            <li>For Task Overview, add an invisible column for emoji and allow drop-down menu filtering using that column.</li>
            <li>For Task Overview, show how much XP, GP, and MP you will gain from completing each task.</li>
            <li>Add tags to the Task Overview and possibly other sections.</li>
            <li>For Task Overview and the Dailies sections, show the dates that tasks were last completed to assist with keeping track of monthly and bi-weekly tasks.</li>
            <li>Modify the "Random To-Do" function to also display a random Daily from those that have not been completed.</li>
            <li>Create a "Random Task" button that displays a randomly-selected To-Do and Daily near the top of the page. Allow the button to be clicked to show different tasks without the whole page having to be refetched. Remove the random task currently shown at the bottom of the Task Overview section.</li>
            <li>For Habit History and Untagged Tasks, apply the "longContent" class if there are more than x number of items.</li>
            <li>Add <a href="http://medleyweb.com/web-dev/jquery-chart-and-graph-plugins/">Pie Charts</a> to Task Statistics: <a href="http://habitica.wikia.com/wiki/Thread:11457">join the discussion</a>
<!--
I dream of pie-charts for tracking my weekly and monthly process. Like x% healt-related tasks, x% mental-related tasks etc or: did more Habits then last week or: how many red/orange/yellow To-Dos are done this month etc. --lightsaber

@lightsaber Now those are some interesting ideas! Some I could add to my tool (anything that uses current data, or very recent data - basically any data available from the [API](https://habitica.com/static/api) ). Others could be created with a tool that also reads [exported historical data](https://habitica.com/#/options/settings/export), although the level of detail that you might want might not be stored permanently in that data. If only I had unlimited time....
-->
            </li>
            <li>Prevent fatal failures when unexpected conditions occur (try/catch or similar everywhere).</li>
            <li>Upgrade <a href="https://datatables.net/upgrade/1.10">Data Tables</a> to the latest version, adjust all calls to it as needed and test thoroughly.
<!--
- Use a CDN (https://datatables.net/manual/installation#CDN) instead of keeping a local copy. Remove the local copy from js-for-habitrpg_user_data_display.tar.gz
- Consider cookies to save state https://datatables.net/examples/basic_init/state_save.html
- (too slow?)  show/hide notes: https://datatables.net/examples/server_side/row_details.html
-->
</li>
            <li><span class="subheading">Other Stuff?</span>: Send me ideas! Contact details are below.</li>
       </ul>

       <h2>Known Bugs</h2>
       <p>Internet Explorer will produce odd results if you use the "Re-Fetch Data" button. Reloading the page will fix the problem. Avoid using that button. Avoiding Internet Explorer will also work.</p>
       <p>This page will not work correctly on old browsers because it uses modern website features and relies on compliance to standards (both can be lacking in old browsers). <a href="http://browsehappy.com/">Updating your browser is important for general safety on the internet!</a> If you have upgraded your browser to the latest version and are still having problems, please tell me! Contact details are below.</p>
       <p>Regardless of what bugs there might be, this page cannot damage your account. It does not contain any code that could result in any changes being made on Habitica.</p>

       <h2>Help and Contact Details</h2>
       <p>This page has been created by <a href="http://habitica.wikia.com/wiki/User:LadyAlys">Alys</a> (a.k.a. Alice Harris). If you have questions, problems, or suggestions, you're welcome to contact me, although I cannot guarantee that I'll always be able to spend a lot of time on this. Email to <a href="mailto:lady_alys@oldgods.net">lady_alys@oldgods.net</a> is the best way to reach me, or you can comment on <a href="http://habitica.wikia.com/wiki/User_blog:LadyAlys/HabitRPG_Unofficial_User_Data_Display">this wiki blog post</a>.</p>

        <p>If you have general questions about Habitica, post them to <a href="https://habitica.com/#/options/groups/tavern">Tavern Talk</a> or <a href="http://habitica.wikia.com/wiki/Board:The_Quarters_-_Q_%26_A">The Quarters - Q & A board</a>.</p>
    </div>

    <div id="documentationAndFormClose" class="showHideToggle closer" data-target="documentationAndForm" data-resettoggletext="documentationAndFormToggle">hide documentation</div>
</div><!-- end of div id="documentationAndForm" -->


</div><!-- end of div id="innerBody" -->
</body>
</html>
